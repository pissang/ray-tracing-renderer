{"version":3,"file":"RayTracingRenderer.es5.js","sources":["../node_modules/gl-matrix/esm/common.js","../node_modules/gl-matrix/esm/mat4.js","../node_modules/gl-matrix/esm/vec3.js","../src/scene/SceneNode.js","../src/scene/Camera.js","../src/scene/DirectionalLight.js","../src/scene/AmbientLight.js","../src/scene/EnvironmentLight.js","../src/scene/Mesh.js","../src/scene/StandardMaterial.js","../src/scene/Texture.js","../src/scene/Geometry.js","../src/renderer/glUtil.js","../src/renderer/Framebuffer.js","../src/renderer/glsl/fullscreenQuad.vert","../src/renderer/UniformSetter.js","../src/renderer/RenderPass.js","../src/renderer/FullscreenQuad.js","../src/renderer/glsl/gBuffer.vert","../src/renderer/glsl/chunks/constants.glsl","../src/renderer/glsl/chunks/materialBuffer.glsl","../src/renderer/glsl/gBuffer.frag","../src/renderer/GBufferPass.js","../src/constants.js","../src/renderer/UniformBuffer.js","../src/renderer/util.js","../src/renderer/Texture.js","../src/renderer/texturesFromMaterials.js","../src/renderer/MaterialBuffer.js","../src/renderer/mergeMeshesToGeometry.js","../src/renderer/bvhUtil.js","../src/renderer/bvhAccel.js","../src/renderer/rgbeToFloat.js","../src/renderer/envMapCreation.js","../src/renderer/envMapDistribution.js","../src/renderer/glslUtil.js","../src/renderer/glsl/chunks/rayTraceCore.glsl","../src/renderer/glsl/chunks/textureLinear.glsl","../src/renderer/glsl/chunks/intersect.glsl","../src/renderer/glsl/chunks/surfaceInteractionDirect.glsl","../src/renderer/glsl/chunks/random.glsl","../src/renderer/glsl/chunks/envMap.glsl","../src/renderer/glsl/chunks/bsdf.glsl","../src/renderer/glsl/chunks/sample.glsl","../src/renderer/glsl/chunks/sampleMaterial.glsl","../src/renderer/glsl/chunks/sampleShadowCatcher.glsl","../src/renderer/glsl/chunks/sampleGlassSpecular.glsl","../src/renderer/glsl/rayTrace.frag","../src/renderer/StratifiedSampler.js","../src/renderer/StratifiedSamplerCombined.js","../src/renderer/RayTracePass.js","../src/renderer/RenderSize.js","../src/renderer/glsl/reproject.frag","../src/renderer/ReprojectPass.js","../src/renderer/glsl/toneMap.frag","../src/renderer/ToneMapPass.js","../src/renderer/TileRender.js","../src/renderer/texture/noise.js","../src/renderer/RenderingPipeline.js","../src/RayTracingRenderer.js","../src/util/loadRGBE.js","../src/util/fromTHREE.js"],"sourcesContent":["/**\n * Common utilities\n * @module glMatrix\n */\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;\nexport var RANDOM = Math.random;\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\n\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\n\nexport function toRadian(a) {\n  return a * degree;\n}\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a The first number to test.\n * @param {Number} b The second number to test.\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\nif (!Math.hypot) Math.hypot = function () {\n  var y = 0,\n      i = arguments.length;\n\n  while (i--) {\n    y += arguments[i] * arguments[i];\n  }\n\n  return Math.sqrt(y);\n};","import * as glMatrix from \"./common.js\";\n/**\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\n * @module mat4\n */\n\n/**\n * Creates a new identity mat4\n *\n * @returns {mat4} a new 4x4 matrix\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(16);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n  }\n\n  out[0] = 1;\n  out[5] = 1;\n  out[10] = 1;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a new mat4 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat4} a matrix to clone\n * @returns {mat4} a new 4x4 matrix\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Copy the values from one mat4 to another\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Create a new mat4 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} A new mat4\n */\n\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\n * Set the components of a mat4 to the given values\n *\n * @param {mat4} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} out\n */\n\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\n * Set a mat4 to the identity matrix\n *\n * @param {mat4} out the receiving matrix\n * @returns {mat4} out\n */\n\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Transpose the values of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n        a02 = a[2],\n        a03 = a[3];\n    var a12 = a[6],\n        a13 = a[7];\n    var a23 = a[11];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a01;\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a02;\n    out[9] = a12;\n    out[11] = a[14];\n    out[12] = a03;\n    out[13] = a13;\n    out[14] = a23;\n  } else {\n    out[0] = a[0];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a[1];\n    out[5] = a[5];\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a[2];\n    out[9] = a[6];\n    out[10] = a[10];\n    out[11] = a[14];\n    out[12] = a[3];\n    out[13] = a[7];\n    out[14] = a[11];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\n * Inverts a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function invert(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  if (!det) {\n    return null;\n  }\n\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n  return out;\n}\n/**\n * Calculates the adjugate of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function adjoint(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  out[0] = a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22);\n  out[1] = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));\n  out[2] = a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12);\n  out[3] = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));\n  out[4] = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));\n  out[5] = a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22);\n  out[6] = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));\n  out[7] = a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12);\n  out[8] = a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21);\n  out[9] = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));\n  out[10] = a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11);\n  out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));\n  out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));\n  out[13] = a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21);\n  out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));\n  out[15] = a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11);\n  return out;\n}\n/**\n * Calculates the determinant of a mat4\n *\n * @param {ReadonlyMat4} a the source matrix\n * @returns {Number} determinant of a\n */\n\nexport function determinant(a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n}\n/**\n * Multiplies two mat4s\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15]; // Cache only the current line of the second matrix\n\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[4];\n  b1 = b[5];\n  b2 = b[6];\n  b3 = b[7];\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[8];\n  b1 = b[9];\n  b2 = b[10];\n  b3 = b[11];\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[12];\n  b1 = b[13];\n  b2 = b[14];\n  b3 = b[15];\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  return out;\n}\n/**\n * Translate a mat4 by the given vector\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to translate\n * @param {ReadonlyVec3} v vector to translate by\n * @returns {mat4} out\n */\n\nexport function translate(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n\n  if (a === out) {\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n  } else {\n    a00 = a[0];\n    a01 = a[1];\n    a02 = a[2];\n    a03 = a[3];\n    a10 = a[4];\n    a11 = a[5];\n    a12 = a[6];\n    a13 = a[7];\n    a20 = a[8];\n    a21 = a[9];\n    a22 = a[10];\n    a23 = a[11];\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a03;\n    out[4] = a10;\n    out[5] = a11;\n    out[6] = a12;\n    out[7] = a13;\n    out[8] = a20;\n    out[9] = a21;\n    out[10] = a22;\n    out[11] = a23;\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\n  }\n\n  return out;\n}\n/**\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {ReadonlyVec3} v the vec3 to scale the matrix by\n * @returns {mat4} out\n **/\n\nexport function scale(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  out[0] = a[0] * x;\n  out[1] = a[1] * x;\n  out[2] = a[2] * x;\n  out[3] = a[3] * x;\n  out[4] = a[4] * y;\n  out[5] = a[5] * y;\n  out[6] = a[6] * y;\n  out[7] = a[7] * y;\n  out[8] = a[8] * z;\n  out[9] = a[9] * z;\n  out[10] = a[10] * z;\n  out[11] = a[11] * z;\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Rotates a mat4 by the given angle around the given axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\n\nexport function rotate(out, a, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  var b00, b01, b02;\n  var b10, b11, b12;\n  var b20, b21, b22;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n  a00 = a[0];\n  a01 = a[1];\n  a02 = a[2];\n  a03 = a[3];\n  a10 = a[4];\n  a11 = a[5];\n  a12 = a[6];\n  a13 = a[7];\n  a20 = a[8];\n  a21 = a[9];\n  a22 = a[10];\n  a23 = a[11]; // Construct the elements of the rotation matrix\n\n  b00 = x * x * t + c;\n  b01 = y * x * t + z * s;\n  b02 = z * x * t - y * s;\n  b10 = x * y * t - z * s;\n  b11 = y * y * t + c;\n  b12 = z * y * t + x * s;\n  b20 = x * z * t + y * s;\n  b21 = y * z * t - x * s;\n  b22 = z * z * t + c; // Perform rotation-specific matrix multiplication\n\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the X axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateX(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[4] = a10 * c + a20 * s;\n  out[5] = a11 * c + a21 * s;\n  out[6] = a12 * c + a22 * s;\n  out[7] = a13 * c + a23 * s;\n  out[8] = a20 * c - a10 * s;\n  out[9] = a21 * c - a11 * s;\n  out[10] = a22 * c - a12 * s;\n  out[11] = a23 * c - a13 * s;\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the Y axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateY(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c - a20 * s;\n  out[1] = a01 * c - a21 * s;\n  out[2] = a02 * c - a22 * s;\n  out[3] = a03 * c - a23 * s;\n  out[8] = a00 * s + a20 * c;\n  out[9] = a01 * s + a21 * c;\n  out[10] = a02 * s + a22 * c;\n  out[11] = a03 * s + a23 * c;\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the Z axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateZ(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c + a10 * s;\n  out[1] = a01 * c + a11 * s;\n  out[2] = a02 * c + a12 * s;\n  out[3] = a03 * c + a13 * s;\n  out[4] = a10 * c - a00 * s;\n  out[5] = a11 * c - a01 * s;\n  out[6] = a12 * c - a02 * s;\n  out[7] = a13 * c - a03 * s;\n  return out;\n}\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\n\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.scale(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Scaling vector\n * @returns {mat4} out\n */\n\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = v[1];\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = v[2];\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a given angle around a given axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotate(dest, dest, rad, axis);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\n\nexport function fromRotation(out, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c; // Perform rotation-specific matrix multiplication\n\n  out[0] = x * x * t + c;\n  out[1] = y * x * t + z * s;\n  out[2] = z * x * t - y * s;\n  out[3] = 0;\n  out[4] = x * y * t - z * s;\n  out[5] = y * y * t + c;\n  out[6] = z * y * t + x * s;\n  out[7] = 0;\n  out[8] = x * z * t + y * s;\n  out[9] = y * z * t - x * s;\n  out[10] = z * z * t + c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the X axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateX(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromXRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = c;\n  out[6] = s;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = -s;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the Y axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateY(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromYRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = 0;\n  out[2] = -s;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = s;\n  out[9] = 0;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the Z axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateZ(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromZRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -s;\n  out[5] = c;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation and vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslation(out, q, v) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - (yy + zz);\n  out[1] = xy + wz;\n  out[2] = xz - wy;\n  out[3] = 0;\n  out[4] = xy - wz;\n  out[5] = 1 - (xx + zz);\n  out[6] = yz + wx;\n  out[7] = 0;\n  out[8] = xz + wy;\n  out[9] = yz - wx;\n  out[10] = 1 - (xx + yy);\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a new mat4 from a dual quat.\n *\n * @param {mat4} out Matrix\n * @param {ReadonlyQuat2} a Dual Quaternion\n * @returns {mat4} mat4 receiving operation result\n */\n\nexport function fromQuat2(out, a) {\n  var translation = new glMatrix.ARRAY_TYPE(3);\n  var bx = -a[0],\n      by = -a[1],\n      bz = -a[2],\n      bw = a[3],\n      ax = a[4],\n      ay = a[5],\n      az = a[6],\n      aw = a[7];\n  var magnitude = bx * bx + by * by + bz * bz + bw * bw; //Only scale if it makes sense\n\n  if (magnitude > 0) {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\n  } else {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n  }\n\n  fromRotationTranslation(out, a, translation);\n  return out;\n}\n/**\n * Returns the translation vector component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslation,\n *  the returned vector will be the same as the translation vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive translation component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\n\nexport function getTranslation(out, mat) {\n  out[0] = mat[12];\n  out[1] = mat[13];\n  out[2] = mat[14];\n  return out;\n}\n/**\n * Returns the scaling factor component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslationScale\n *  with a normalized Quaternion paramter, the returned vector will be\n *  the same as the scaling vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive scaling factor component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\n\nexport function getScaling(out, mat) {\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out[0] = Math.hypot(m11, m12, m13);\n  out[1] = Math.hypot(m21, m22, m23);\n  out[2] = Math.hypot(m31, m32, m33);\n  return out;\n}\n/**\n * Returns a quaternion representing the rotational component\n *  of a transformation matrix. If a matrix is built with\n *  fromRotationTranslation, the returned quaternion will be the\n *  same as the quaternion originally supplied.\n * @param {quat} out Quaternion to receive the rotation component\n * @param {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {quat} out\n */\n\nexport function getRotation(out, mat) {\n  var scaling = new glMatrix.ARRAY_TYPE(3);\n  getScaling(scaling, mat);\n  var is1 = 1 / scaling[0];\n  var is2 = 1 / scaling[1];\n  var is3 = 1 / scaling[2];\n  var sm11 = mat[0] * is1;\n  var sm12 = mat[1] * is2;\n  var sm13 = mat[2] * is3;\n  var sm21 = mat[4] * is1;\n  var sm22 = mat[5] * is2;\n  var sm23 = mat[6] * is3;\n  var sm31 = mat[8] * is1;\n  var sm32 = mat[9] * is2;\n  var sm33 = mat[10] * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out[3] = 0.25 * S;\n    out[0] = (sm23 - sm32) / S;\n    out[1] = (sm31 - sm13) / S;\n    out[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out[3] = (sm23 - sm32) / S;\n    out[0] = 0.25 * S;\n    out[1] = (sm12 + sm21) / S;\n    out[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out[3] = (sm31 - sm13) / S;\n    out[0] = (sm12 + sm21) / S;\n    out[1] = 0.25 * S;\n    out[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out[3] = (sm12 - sm21) / S;\n    out[0] = (sm31 + sm13) / S;\n    out[1] = (sm23 + sm32) / S;\n    out[2] = 0.25 * S;\n  }\n\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslationScale(out, q, v, s) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  out[0] = (1 - (yy + zz)) * sx;\n  out[1] = (xy + wz) * sx;\n  out[2] = (xz - wy) * sx;\n  out[3] = 0;\n  out[4] = (xy - wz) * sy;\n  out[5] = (1 - (xx + zz)) * sy;\n  out[6] = (yz + wx) * sy;\n  out[7] = 0;\n  out[8] = (xz + wy) * sz;\n  out[9] = (yz - wx) * sz;\n  out[10] = (1 - (xx + yy)) * sz;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     mat4.translate(dest, origin);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *     mat4.translate(dest, negativeOrigin);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @param {ReadonlyVec3} o The origin vector around which to scale and rotate\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  var ox = o[0];\n  var oy = o[1];\n  var oz = o[2];\n  var out0 = (1 - (yy + zz)) * sx;\n  var out1 = (xy + wz) * sx;\n  var out2 = (xz - wy) * sx;\n  var out4 = (xy - wz) * sy;\n  var out5 = (1 - (xx + zz)) * sy;\n  var out6 = (yz + wx) * sy;\n  var out8 = (xz + wy) * sz;\n  var out9 = (yz - wx) * sz;\n  var out10 = (1 - (xx + yy)) * sz;\n  out[0] = out0;\n  out[1] = out1;\n  out[2] = out2;\n  out[3] = 0;\n  out[4] = out4;\n  out[5] = out5;\n  out[6] = out6;\n  out[7] = 0;\n  out[8] = out8;\n  out[9] = out9;\n  out[10] = out10;\n  out[11] = 0;\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\n  out[15] = 1;\n  return out;\n}\n/**\n * Calculates a 4x4 matrix from the given quaternion\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat4} out\n */\n\nexport function fromQuat(out, q) {\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[1] = yx + wz;\n  out[2] = zx - wy;\n  out[3] = 0;\n  out[4] = yx - wz;\n  out[5] = 1 - xx - zz;\n  out[6] = zy + wx;\n  out[7] = 0;\n  out[8] = zx + wy;\n  out[9] = zy - wx;\n  out[10] = 1 - xx - yy;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a frustum matrix with the given bounds\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Number} left Left bound of the frustum\n * @param {Number} right Right bound of the frustum\n * @param {Number} bottom Bottom bound of the frustum\n * @param {Number} top Top bound of the frustum\n * @param {Number} near Near bound of the frustum\n * @param {Number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function frustum(out, left, right, bottom, top, near, far) {\n  var rl = 1 / (right - left);\n  var tb = 1 / (top - bottom);\n  var nf = 1 / (near - far);\n  out[0] = near * 2 * rl;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = near * 2 * tb;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = (right + left) * rl;\n  out[9] = (top + bottom) * tb;\n  out[10] = (far + near) * nf;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = far * near * 2 * nf;\n  out[15] = 0;\n  return out;\n}\n/**\n * Generates a perspective projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\n\nexport function perspectiveNO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = (far + near) * nf;\n    out[14] = 2 * far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -2 * near;\n  }\n\n  return out;\n}\n/**\n * Alias for {@link mat4.perspectiveNO}\n * @function\n */\n\nexport var perspective = perspectiveNO;\n/**\n * Generates a perspective projection matrix suitable for WebGPU with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\n\nexport function perspectiveZO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = far * nf;\n    out[14] = far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -near;\n  }\n\n  return out;\n}\n/**\n * Generates a perspective projection matrix with the given field of view.\n * This is primarily useful for generating projection matrices to be used\n * with the still experiemental WebVR API.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\n  var xScale = 2.0 / (leftTan + rightTan);\n  var yScale = 2.0 / (upTan + downTan);\n  out[0] = xScale;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  out[4] = 0.0;\n  out[5] = yScale;\n  out[6] = 0.0;\n  out[7] = 0.0;\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\n  out[9] = (upTan - downTan) * yScale * 0.5;\n  out[10] = far / (near - far);\n  out[11] = -1.0;\n  out[12] = 0.0;\n  out[13] = 0.0;\n  out[14] = far * near / (near - far);\n  out[15] = 0.0;\n  return out;\n}\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function orthoNO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n/**\n * Alias for {@link mat4.orthoNO}\n * @function\n */\n\nexport var ortho = orthoNO;\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function orthoZO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = near * nf;\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\n\nexport function lookAt(out, eye, center, up) {\n  var x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\n  var eyex = eye[0];\n  var eyey = eye[1];\n  var eyez = eye[2];\n  var upx = up[0];\n  var upy = up[1];\n  var upz = up[2];\n  var centerx = center[0];\n  var centery = center[1];\n  var centerz = center[2];\n\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON && Math.abs(eyey - centery) < glMatrix.EPSILON && Math.abs(eyez - centerz) < glMatrix.EPSILON) {\n    return identity(out);\n  }\n\n  z0 = eyex - centerx;\n  z1 = eyey - centery;\n  z2 = eyez - centerz;\n  len = 1 / Math.hypot(z0, z1, z2);\n  z0 *= len;\n  z1 *= len;\n  z2 *= len;\n  x0 = upy * z2 - upz * z1;\n  x1 = upz * z0 - upx * z2;\n  x2 = upx * z1 - upy * z0;\n  len = Math.hypot(x0, x1, x2);\n\n  if (!len) {\n    x0 = 0;\n    x1 = 0;\n    x2 = 0;\n  } else {\n    len = 1 / len;\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  y0 = z1 * x2 - z2 * x1;\n  y1 = z2 * x0 - z0 * x2;\n  y2 = z0 * x1 - z1 * x0;\n  len = Math.hypot(y0, y1, y2);\n\n  if (!len) {\n    y0 = 0;\n    y1 = 0;\n    y2 = 0;\n  } else {\n    len = 1 / len;\n    y0 *= len;\n    y1 *= len;\n    y2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = y0;\n  out[2] = z0;\n  out[3] = 0;\n  out[4] = x1;\n  out[5] = y1;\n  out[6] = z1;\n  out[7] = 0;\n  out[8] = x2;\n  out[9] = y2;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a matrix that makes something look at something else.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\n\nexport function targetTo(out, eye, target, up) {\n  var eyex = eye[0],\n      eyey = eye[1],\n      eyez = eye[2],\n      upx = up[0],\n      upy = up[1],\n      upz = up[2];\n  var z0 = eyex - target[0],\n      z1 = eyey - target[1],\n      z2 = eyez - target[2];\n  var len = z0 * z0 + z1 * z1 + z2 * z2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    z0 *= len;\n    z1 *= len;\n    z2 *= len;\n  }\n\n  var x0 = upy * z2 - upz * z1,\n      x1 = upz * z0 - upx * z2,\n      x2 = upx * z1 - upy * z0;\n  len = x0 * x0 + x1 * x1 + x2 * x2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = x1;\n  out[2] = x2;\n  out[3] = 0;\n  out[4] = z1 * x2 - z2 * x1;\n  out[5] = z2 * x0 - z0 * x2;\n  out[6] = z0 * x1 - z1 * x0;\n  out[7] = 0;\n  out[8] = z0;\n  out[9] = z1;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = eyex;\n  out[13] = eyey;\n  out[14] = eyez;\n  out[15] = 1;\n  return out;\n}\n/**\n * Returns a string representation of a mat4\n *\n * @param {ReadonlyMat4} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\n\nexport function str(a) {\n  return \"mat4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \", \" + a[9] + \", \" + a[10] + \", \" + a[11] + \", \" + a[12] + \", \" + a[13] + \", \" + a[14] + \", \" + a[15] + \")\";\n}\n/**\n * Returns Frobenius norm of a mat4\n *\n * @param {ReadonlyMat4} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\n\nexport function frob(a) {\n  return Math.hypot(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8], a[9], a[10], a[11], a[12], a[13], a[14], a[15]);\n}\n/**\n * Adds two mat4's\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  out[9] = a[9] + b[9];\n  out[10] = a[10] + b[10];\n  out[11] = a[11] + b[11];\n  out[12] = a[12] + b[12];\n  out[13] = a[13] + b[13];\n  out[14] = a[14] + b[14];\n  out[15] = a[15] + b[15];\n  return out;\n}\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  out[9] = a[9] - b[9];\n  out[10] = a[10] - b[10];\n  out[11] = a[11] - b[11];\n  out[12] = a[12] - b[12];\n  out[13] = a[13] - b[13];\n  out[14] = a[14] - b[14];\n  out[15] = a[15] - b[15];\n  return out;\n}\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat4} out\n */\n\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  out[9] = a[9] * b;\n  out[10] = a[10] * b;\n  out[11] = a[11] * b;\n  out[12] = a[12] * b;\n  out[13] = a[13] * b;\n  out[14] = a[14] * b;\n  out[15] = a[15] * b;\n  return out;\n}\n/**\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat4} out the receiving vector\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat4} out\n */\n\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  out[9] = a[9] + b[9] * scale;\n  out[10] = a[10] + b[10] * scale;\n  out[11] = a[11] + b[11] * scale;\n  out[12] = a[12] + b[12] * scale;\n  out[13] = a[13] + b[13] * scale;\n  out[14] = a[14] + b[14] * scale;\n  out[15] = a[15] + b[15] * scale;\n  return out;\n}\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\n}\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var a4 = a[4],\n      a5 = a[5],\n      a6 = a[6],\n      a7 = a[7];\n  var a8 = a[8],\n      a9 = a[9],\n      a10 = a[10],\n      a11 = a[11];\n  var a12 = a[12],\n      a13 = a[13],\n      a14 = a[14],\n      a15 = a[15];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  var b4 = b[4],\n      b5 = b[5],\n      b6 = b[6],\n      b7 = b[7];\n  var b8 = b[8],\n      b9 = b[9],\n      b10 = b[10],\n      b11 = b[11];\n  var b12 = b[12],\n      b13 = b[13],\n      b14 = b[14],\n      b15 = b[15];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15));\n}\n/**\n * Alias for {@link mat4.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link mat4.subtract}\n * @function\n */\n\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\n/**\n * 3 Dimensional Vector\n * @module vec3\n */\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(3);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {ReadonlyVec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Calculates the length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\n\nexport function fromValues(x, y, z) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the source vector\n * @returns {vec3} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\n\nexport function set(out, x, y, z) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to ceil\n * @returns {vec3} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  return out;\n}\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to floor\n * @returns {vec3} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  return out;\n}\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  return out;\n}\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  return out;\n}\n/**\n * Math.round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to round\n * @returns {vec3} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  return out;\n}\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  return out;\n}\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Calculates the squared length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to negate\n * @returns {vec3} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to invert\n * @returns {vec3} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  return out;\n}\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to normalize\n * @returns {vec3} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var len = x * x + y * y + z * z;\n\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  out[2] = a[2] * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function cross(out, a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2];\n  var bx = b[0],\n      by = b[1],\n      bz = b[2];\n  out[0] = ay * bz - az * by;\n  out[1] = az * bx - ax * bz;\n  out[2] = ax * by - ay * bx;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  return out;\n}\n/**\n * Performs a hermite interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function hermite(out, a, b, c, d, t) {\n  var factorTimes2 = t * t;\n  var factor1 = factorTimes2 * (2 * t - 3) + 1;\n  var factor2 = factorTimes2 * (t - 2) + t;\n  var factor3 = factorTimes2 * (t - 1);\n  var factor4 = factorTimes2 * (3 - 2 * t);\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Performs a bezier interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function bezier(out, a, b, c, d, t) {\n  var inverseFactor = 1 - t;\n  var inverseFactorTimesTwo = inverseFactor * inverseFactor;\n  var factorTimes2 = t * t;\n  var factor1 = inverseFactorTimesTwo * inverseFactor;\n  var factor2 = 3 * t * inverseFactorTimesTwo;\n  var factor3 = 3 * factorTimes2 * inverseFactor;\n  var factor4 = factorTimes2 * t;\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\n * @returns {vec3} out\n */\n\nexport function random(out, scale) {\n  scale = scale || 1.0;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  var z = glMatrix.RANDOM() * 2.0 - 1.0;\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\n  out[0] = Math.cos(r) * zScale;\n  out[1] = Math.sin(r) * zScale;\n  out[2] = z * scale;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  w = w || 1.0;\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat3} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  out[0] = x * m[0] + y * m[3] + z * m[6];\n  out[1] = x * m[1] + y * m[4] + z * m[7];\n  out[2] = x * m[2] + y * m[5] + z * m[8];\n  return out;\n}\n/**\n * Transforms the vec3 with a quat\n * Can also be used for dual quaternions. (Multiply it with the real part)\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyQuat} q quaternion to transform with\n * @returns {vec3} out\n */\n\nexport function transformQuat(out, a, q) {\n  // benchmarks: https://jsperf.com/quaternion-transform-vec3-implementations-fixed\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3];\n  var x = a[0],\n      y = a[1],\n      z = a[2]; // var qvec = [qx, qy, qz];\n  // var uv = vec3.cross([], qvec, a);\n\n  var uvx = qy * z - qz * y,\n      uvy = qz * x - qx * z,\n      uvz = qx * y - qy * x; // var uuv = vec3.cross([], qvec, uv);\n\n  var uuvx = qy * uvz - qz * uvy,\n      uuvy = qz * uvx - qx * uvz,\n      uuvz = qx * uvy - qy * uvx; // vec3.scale(uv, uv, 2 * w);\n\n  var w2 = qw * 2;\n  uvx *= w2;\n  uvy *= w2;\n  uvz *= w2; // vec3.scale(uuv, uuv, 2);\n\n  uuvx *= 2;\n  uuvy *= 2;\n  uuvz *= 2; // return vec3.add(out, a, vec3.add(out, uv, uuv));\n\n  out[0] = x + uvx + uuvx;\n  out[1] = y + uvy + uuvy;\n  out[2] = z + uvz + uuvz;\n  return out;\n}\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateX(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0];\n  r[1] = p[1] * Math.cos(rad) - p[2] * Math.sin(rad);\n  r[2] = p[1] * Math.sin(rad) + p[2] * Math.cos(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateY(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[2] * Math.sin(rad) + p[0] * Math.cos(rad);\n  r[1] = p[1];\n  r[2] = p[2] * Math.cos(rad) - p[0] * Math.sin(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateZ(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0] * Math.cos(rad) - p[1] * Math.sin(rad);\n  r[1] = p[0] * Math.sin(rad) + p[1] * Math.cos(rad);\n  r[2] = p[2]; //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Get the angle between two 3D vectors\n * @param {ReadonlyVec3} a The first operand\n * @param {ReadonlyVec3} b The second operand\n * @returns {Number} The angle in radians\n */\n\nexport function angle(a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      bx = b[0],\n      by = b[1],\n      bz = b[2],\n      mag1 = Math.sqrt(ax * ax + ay * ay + az * az),\n      mag2 = Math.sqrt(bx * bx + by * by + bz * bz),\n      mag = mag1 * mag2,\n      cosine = mag && dot(a, b) / mag;\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n/**\n * Set the components of a vec3 to zero\n *\n * @param {vec3} out the receiving vector\n * @returns {vec3} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec3} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \")\";\n}\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2));\n}\n/**\n * Alias for {@link vec3.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec3.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec3.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec3.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec3.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec3.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec3.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 3;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n    }\n\n    return a;\n  };\n}();","import {mat4} from 'gl-matrix';\n\nexport class SceneNode {\n  constructor() {\n    /**\n     * @property {Float32Array} matrixWorld World transform matrix..\n     */\n    this.matrixWorld = mat4.create();\n  }\n\n  get matrixWorldInverse() {\n    return mat4.invert([], this.matrixWorld);\n  }\n}","import { SceneNode } from './SceneNode';\nimport {mat4} from 'gl-matrix';\n\nexport class Camera extends SceneNode {\n\n  constructor(fov, aspect, near, far) {\n    super();\n\n    this.fov = fov != null ? fov : 50;\n    this.near = near != null ? near : 0.1;\n    this.far = far != null ? far : 2000;\n    this.aspect = aspect != null ? aspect : 1;\n\n    this.zoom = 1;\n    this.focus = 10;\n\n    this.aperture = 0.01;\n  }\n\n  get projectionMatrix() {\n    return mat4.perspective([], this.fov * Math.PI / 180, this.aspect, this.near, this.far);\n  }\n\n  copy(source) {\n    this.fov = source.fov;\n    this.near = source.near;\n    this.far = source.far;\n    this.aspect = source.aspect;\n    this.zoom = source.zoom;\n    this.focus = source.focus;\n    this.aperture = source.aperture;\n\n    mat4.copy(this.matrixWorld, source.matrixWorld);\n  }\n}","export class DirectionalLight {\n  constructor(direction, color, intensity, softness) {\n    this.direction = direction || [1, 1, 1];\n    this.color = color || [1, 1, 1];\n    this.intensity = intensity == null ? 1 : intensity;\n    this.softness = softness || 0;\n  }\n}","export class AmbientLight {\n  constructor(color, intensity) {\n    /**\n     * @property {number[]}\n     */\n    this.color = color || [1, 1, 1];\n\n    this.intensity = intensity == null ? 1 : intensity;\n  }\n}","export class EnvironmentLight {\n  constructor(map, intensity) {\n    /**\n     * @property {import('./Texture').Texture}\n     */\n    this.map = map;\n\n    this.intensity = intensity == null ? 1 : intensity;\n  }\n}","import {SceneNode} from './SceneNode';\n\nexport class Mesh extends SceneNode {\n\n  constructor(geometry, material) {\n    super();\n\n    /**\n     * @property {import('./Geometry').Geometry}\n     */\n    this.geometry = geometry;\n    /**\n     * @property {import('./StandardMaterial').StandardMaterial}\n     */\n    this.material = material;\n  }\n}","export class StandardMaterial {\n\n  constructor() {\n    /**\n     * @property {number[]}\n     */\n    this.color = null;\n    /**\n     * @property {number}\n     */\n    this.roughness = null;\n    /**\n     * @property {number}\n     */\n    this.metalness = null;\n\n    /**\n     * @property {import('./Texture').Texture}\n     */\n    this.map = null;\n\n    /**\n     * @property {number[]}\n     */\n    this.emissive = null;\n\n    /**\n     * @property {number}\n     */\n    this.emissiveIntensity = null;\n    /**\n     * @property {import('./Texture').Texture}\n     */\n    this.emissiveMap = null;\n\n    /**\n     * @property {import('./Texture').Texture}\n     */\n    this.normalMap = null;\n\n    /**\n     * @property {number[]}\n     */\n    this.normalScale = null;\n\n    /**\n     * @property {import('./Texture').Texture}\n     */\n    this.roughnessMap = null;\n    /**\n     * @property {import('./Texture').Texture}\n     */\n    this.metalnessMap = null;\n\n    /**\n     * @property {boolean}\n     */\n    this.transparent = false;\n\n    this.solid = true;\n    this.shadowCaster = true;\n  }\n}","export class Texture {\n\n  constructor(image) {\n    this.image = image;\n\n    this.flipY = false;\n  }\n}","export class Attribute {\n  constructor(array, itemSize) {\n    this.array = array;\n    this.itemSize = itemSize;\n  }\n\n  getItem(out, vertexIndex) {\n    const array = this.array;\n    const itemSize = this.itemSize;\n    const offset = vertexIndex * itemSize;\n    for (let i = 0; i < itemSize; i++) {\n      out[i] = array[offset + i];\n    }\n  }\n\n  get count() {\n    return this.array.length / this.itemSize;\n  }\n}\n\nexport class Geometry {\n  constructor(data) {\n    data = data || {};\n\n    /**\n     * @property {Attribute} position Position of geometry\n     */\n    this.position = data.position;\n    /**\n     * @property {Attribute} normal Normal of geometry\n     */\n    this.normal = data.normal;\n    /**\n     * @property {Attribute} uv Uv of geometry\n     */\n    this.uv = data.uv;\n    /**\n     * @property {Attribute} position Indices of geometry\n     */\n    this.indices = data.indices;\n\n    /**\n     * @property {Attribute} materialMeshIndex Material index of merged geometry.\n     */\n    this.materialMeshIndex;\n  }\n\n}","export function loadExtensions(gl, extensions) {\n  const supported = {};\n  for (const name of extensions) {\n    supported[name] = gl.getExtension(name);\n  }\n  return supported;\n}\n\nexport function compileShader(gl, type, source) {\n  const shader = gl.createShader(type);\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n  const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n\n  if (success) {\n    return shader;\n  }\n\n  const output = source.split('\\n').map((x, i) => `${i + 1}: ${x}`).join('\\n');\n  console.log(output);\n\n  throw gl.getShaderInfoLog(shader);\n}\n\nexport function createProgram(gl, vertexShader, fragmentShader, transformVaryings, transformBufferMode) {\n  const program = gl.createProgram();\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n\n  if (transformVaryings) {\n    gl.transformFeedbackVaryings(program, transformVaryings, transformBufferMode);\n  }\n\n  gl.linkProgram(program);\n\n  gl.detachShader(program, vertexShader);\n  gl.detachShader(program, fragmentShader);\n\n  const success = gl.getProgramParameter(program, gl.LINK_STATUS);\n\n  if (success) {\n    return program;\n  }\n\n  throw gl.getProgramInfoLog(program);\n}\n\nexport function getUniforms(gl, program) {\n  const uniforms = {};\n\n  const count = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n  for (let i = 0; i < count; i++) {\n    const { name, type } = gl.getActiveUniform(program, i);\n    const location = gl.getUniformLocation(program, name);\n    if (location) {\n      uniforms[name] = {\n        type, location\n      };\n    }\n  }\n\n  return uniforms;\n}\n\nexport function getAttributes(gl, program) {\n  const attributes = {};\n\n  const count = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n  for (let i = 0; i < count; i++) {\n    const { name } = gl.getActiveAttrib(program, i);\n    if (name) {\n      attributes[name] = gl.getAttribLocation(program, name);\n    }\n  }\n\n  return attributes;\n}\n","export function makeFramebuffer(gl, { color, depth }) {\n\n  const framebuffer = gl.createFramebuffer();\n\n  function bind() {\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n  }\n\n  function unbind() {\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  }\n\n  function init() {\n    bind();\n\n    const drawBuffers = [];\n\n    for (let location in color) {\n      location = Number(location);\n\n      if (location === undefined) {\n        console.error('invalid location');\n      }\n\n      const tex = color[location];\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0 + location, tex.target, tex.texture, 0);\n      drawBuffers.push(gl.COLOR_ATTACHMENT0 + location);\n    }\n\n    gl.drawBuffers(drawBuffers);\n\n    if (depth) {\n      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, depth.target, depth.texture);\n    }\n\n    unbind();\n  }\n\n  init();\n\n  return {\n    color,\n    bind,\n    unbind\n  };\n}\n","export default {\nsource: `\n  layout(location = 0) in vec2 a_position;\n\n  out vec2 vCoord;\n\n  void main() {\n    vCoord = a_position;\n    gl_Position = vec4(2. * a_position - 1., 0, 1);\n  }\n`\n}\n","import { getUniforms } from './glUtil';\n\nlet typeMap;\n\nexport function makeUniformSetter(gl, program) {\n  const uniformInfo = getUniforms(gl, program);\n  const uniforms = {};\n  const needsUpload = [];\n\n  for (let name in uniformInfo) {\n    const { type, location } = uniformInfo[name];\n\n    const uniform = {\n      type,\n      location,\n      v0: 0,\n      v1: 0,\n      v2: 0,\n      v3: 0\n    };\n\n    uniforms[name] = uniform;\n  }\n\n  const failedUnis = new Set();\n\n  function setUniform(name, v0, v1, v2, v3) {\n    // v0 - v4 are the values to be passed to the uniform\n    // v0 can either be a number or an array, and v1-v3 are optional\n    const uni = uniforms[name];\n\n    if (!uni) {\n      if (!failedUnis.has(name)) {\n        console.warn(`Uniform \"${name}\" does not exist in shader`);\n        failedUnis.add(name);\n      }\n\n      return;\n    }\n\n    uni.v0 = v0;\n    uni.v1 = v1;\n    uni.v2 = v2;\n    uni.v3 = v3;\n    needsUpload.push(uni);\n  }\n\n  typeMap = typeMap || initTypeMap(gl);\n\n  function upload() {\n    while (needsUpload.length > 0) {\n\n      const { type, location, v0, v1, v2, v3 } = needsUpload.pop();\n      const glMethod = typeMap[type];\n\n      if (v0.length) {\n        if (glMethod.matrix) {\n          const array = v0;\n          const transpose = v1 || false;\n          gl[glMethod.matrix](location, transpose, array);\n        } else {\n          gl[glMethod.array](location, v0);\n        }\n      } else {\n        gl[glMethod.values](location, v0, v1, v2, v3);\n      }\n    }\n  }\n\n  return {\n    setUniform,\n    upload,\n  };\n}\n\nfunction initTypeMap(gl) {\n  return {\n    [gl.FLOAT]: glName(1, 'f'),\n    [gl.FLOAT_VEC2]: glName(2, 'f'),\n    [gl.FLOAT_VEC3]: glName(3, 'f'),\n    [gl.FLOAT_VEC4]: glName(4, 'f'),\n    [gl.INT]: glName(1, 'i'),\n    [gl.INT_VEC2]: glName(2, 'i'),\n    [gl.INT_VEC3]: glName(3, 'i'),\n    [gl.INT_VEC4]: glName(4, 'i'),\n    [gl.SAMPLER_2D]: glName(1, 'i'),\n    [gl.SAMPLER_2D_ARRAY]: glName(1, 'i'),\n    [gl.FLOAT_MAT2]: glNameMatrix(2, 2),\n    [gl.FLOAT_MAT3]: glNameMatrix(3, 3),\n    [gl.FLOAT_MAT4]: glNameMatrix(4, 4)\n  };\n}\n\nfunction glName(numComponents, type) {\n  return {\n    values: `uniform${numComponents}${type}`,\n    array: `uniform${numComponents}${type}v`\n  };\n}\n\nfunction glNameMatrix(rows, columns) {\n  return {\n    matrix: rows === columns ?\n      `uniformMatrix${rows}fv` :\n      `uniformMatrix${rows}x${columns}fv`\n  };\n}\n","import { compileShader, createProgram, getAttributes } from './glUtil';\nimport { makeUniformSetter } from './UniformSetter';\n\nexport function makeRenderPass(gl, params) {\n  const {\n    fragment,\n    vertex,\n  } = params;\n\n  const vertexCompiled = vertex instanceof WebGLShader ? vertex : makeVertexShader(gl, params);\n\n  const fragmentCompiled = fragment instanceof WebGLShader ? fragment : makeFragmentShader(gl, params);\n\n  const program = createProgram(gl, vertexCompiled, fragmentCompiled);\n\n  return {\n    ...makeRenderPassFromProgram(gl, program),\n    outputLocs: fragment.outputs ? getOutputLocations(fragment.outputs) : {}\n  };\n}\n\nexport function makeVertexShader(gl, { defines, vertex }) {\n  return makeShaderStage(gl, gl.VERTEX_SHADER, vertex, defines);\n}\n\nexport function makeFragmentShader(gl, { defines, fragment }) {\n  return makeShaderStage(gl, gl.FRAGMENT_SHADER, fragment, defines);\n}\n\nfunction makeRenderPassFromProgram(gl, program) {\n\n  const uniformSetter = makeUniformSetter(gl, program);\n\n  const textures = {};\n\n  let nextTexUnit = 1;\n\n  function setTexture(name, texture) {\n    if (!texture) {\n      return;\n    }\n\n    if (!textures[name]) {\n      const unit = nextTexUnit++;\n\n      uniformSetter.setUniform(name, unit);\n\n      textures[name] = {\n        unit,\n        tex: texture\n      };\n    } else {\n      textures[name].tex = texture;\n    }\n  }\n\n  function bindTextures() {\n    for (let name in textures) {\n      const { tex, unit } = textures[name];\n      gl.activeTexture(gl.TEXTURE0 + unit);\n      gl.bindTexture(tex.target, tex.texture);\n    }\n  }\n\n  function useProgram(autoBindTextures = true) {\n    gl.useProgram(program);\n    uniformSetter.upload();\n    if (autoBindTextures) {\n      bindTextures();\n    }\n  }\n\n  return {\n    attribLocs: getAttributes(gl, program),\n    bindTextures,\n    program,\n    setTexture,\n    setUniform: uniformSetter.setUniform,\n    textures,\n    useProgram,\n  };\n}\n\nfunction makeShaderStage(gl, type, shader, defines) {\n  let str = '#version 300 es\\nprecision mediump float;\\nprecision mediump int;\\n';\n\n  if (defines) {\n    str += addDefines(defines);\n  }\n\n  if (type === gl.FRAGMENT_SHADER && shader.outputs) {\n    str += addOutputs(shader.outputs);\n  }\n\n  if (shader.includes) {\n    str += addIncludes(shader.includes, defines);\n  }\n\n  if (typeof shader.source === 'function') {\n    str += shader.source(defines);\n  } else {\n    str += shader.source;\n  }\n\n  return compileShader(gl, type, str);\n}\n\nfunction addDefines(defines) {\n  let str = '';\n\n  for (const name in defines) {\n    const value = defines[name];\n\n    // don't define falsy values such as false, 0, and ''.\n    // this adds support for #ifdef on falsy values\n    if (value) {\n      str += `#define ${name} ${value}\\n`;\n    }\n  }\n\n  return str;\n}\n\nfunction addOutputs(outputs) {\n  let str = '';\n\n  const locations = getOutputLocations(outputs);\n\n  for (let name in locations) {\n    const location = locations[name];\n    str += `layout(location = ${location}) out vec4 out_${name};\\n`;\n  }\n\n  return str;\n}\n\nfunction addIncludes(includes, defines) {\n  let str = '';\n\n  for (let include of includes) {\n    if (typeof include === 'function') {\n      str += include(defines);\n    } else {\n      str += include;\n    }\n  }\n\n  return str;\n}\n\nfunction getOutputLocations(outputs) {\n  let locations = {};\n\n  for (let i = 0; i < outputs.length; i++) {\n    locations[outputs[i]] = i;\n  }\n\n  return locations;\n}\n","import vertex from './glsl/fullscreenQuad.vert';\nimport { makeVertexShader } from './RenderPass';\n\nexport function makeFullscreenQuad(gl) {\n  const vao = gl.createVertexArray();\n\n  gl.bindVertexArray(vao);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\n\n  // vertex shader should set layout(location = 0) on position attribute\n  const posLoc = 0;\n\n  gl.enableVertexAttribArray(posLoc);\n  gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);\n\n  gl.bindVertexArray(null);\n\n  const vertexShader = makeVertexShader(gl, { vertex });\n\n  function draw() {\n    gl.bindVertexArray(vao);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n\n  return {\n    draw,\n    vertexShader\n  };\n}\n","export default {\n\nsource: `\n  in vec3 aPosition;\n  in vec3 aNormal;\n  in vec2 aUv;\n  in ivec2 aMaterialMeshIndex;\n\n  uniform mat4 projView;\n\n  out vec3 vPosition;\n  out vec3 vNormal;\n  out vec2 vUv;\n  flat out ivec2 vMaterialMeshIndex;\n\n  void main() {\n    vPosition = aPosition;\n    vNormal = aNormal;\n    vUv = aUv;\n    vMaterialMeshIndex = aMaterialMeshIndex;\n    gl_Position = projView * vec4(aPosition, 1);\n  }\n`\n}\n","export default `\n  #define PI 3.14159265359\n  #define TWOPI 6.28318530718\n  #define INVPI 0.31830988618\n  #define INVPI2 0.10132118364\n  #define EPS 0.0005\n  #define INF 1.0e999\n\n  #define ROUGHNESS_MIN 0.03\n`\n","export default `\n\nuniform Materials {\n  vec4 colorAndMaterialType[NUM_MATERIALS];\n  vec4 roughnessMetalnessNormalScale[NUM_MATERIALS];\n\n  #if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS) || defined(NUM_PBR_MAPS)\n    ivec4 diffuseNormalRoughnessMetalnessMapIndex[NUM_MATERIALS];\n  #endif\n\n  #if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS)\n    vec4 diffuseNormalMapSize[NUM_DIFFUSE_NORMAL_MAPS];\n  #endif\n\n  #if defined(NUM_PBR_MAPS)\n    vec2 pbrMapSize[NUM_PBR_MAPS];\n  #endif\n} materials;\n\n#ifdef NUM_DIFFUSE_MAPS\n  uniform mediump sampler2DArray diffuseMap;\n#endif\n\n#ifdef NUM_NORMAL_MAPS\n  uniform mediump sampler2DArray normalMap;\n#endif\n\n#ifdef NUM_PBR_MAPS\n  uniform mediump sampler2DArray pbrMap;\n#endif\n\nfloat getMatType(int materialIndex) {\n  return materials.colorAndMaterialType[materialIndex].w;\n}\n\nvec3 getMatColor(int materialIndex, vec2 uv) {\n  vec3 color = materials.colorAndMaterialType[materialIndex].rgb;\n\n  #ifdef NUM_DIFFUSE_MAPS\n    int diffuseMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].x;\n    if (diffuseMapIndex >= 0) {\n      color *= texture(diffuseMap, vec3(uv * materials.diffuseNormalMapSize[diffuseMapIndex].xy, diffuseMapIndex)).rgb;\n    }\n  #endif\n\n  return color;\n}\n\nfloat getMatRoughness(int materialIndex, vec2 uv) {\n  float roughness = materials.roughnessMetalnessNormalScale[materialIndex].x;\n\n  #ifdef NUM_PBR_MAPS\n    int roughnessMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].z;\n    if (roughnessMapIndex >= 0) {\n      roughness *= texture(pbrMap, vec3(uv * materials.pbrMapSize[roughnessMapIndex].xy, roughnessMapIndex)).g;\n    }\n  #endif\n\n  return roughness;\n}\n\nfloat getMatMetalness(int materialIndex, vec2 uv) {\n  float metalness = materials.roughnessMetalnessNormalScale[materialIndex].y;\n\n  #ifdef NUM_PBR_MAPS\n    int metalnessMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].w;\n    if (metalnessMapIndex >= 0) {\n      metalness *= texture(pbrMap, vec3(uv * materials.pbrMapSize[metalnessMapIndex].xy, metalnessMapIndex)).b;\n    }\n  #endif\n\n  return metalness;\n}\n\n#ifdef NUM_NORMAL_MAPS\nvec3 getMatNormal(int materialIndex, vec2 uv, vec3 normal, vec3 dp1, vec3 dp2, vec2 duv1, vec2 duv2) {\n  int normalMapIndex = materials.diffuseNormalRoughnessMetalnessMapIndex[materialIndex].y;\n  if (normalMapIndex >= 0) {\n    // http://www.thetenthplanet.de/archives/1180\n    // Compute co-tangent and co-bitangent vectors\n    vec3 dp2perp = cross(dp2, normal);\n    vec3 dp1perp = cross(normal, dp1);\n    vec3 dpdu = dp2perp * duv1.x + dp1perp * duv2.x;\n    vec3 dpdv = dp2perp * duv1.y + dp1perp * duv2.y;\n    float invmax = inversesqrt(max(dot(dpdu, dpdu), dot(dpdv, dpdv)));\n    dpdu *= invmax;\n    dpdv *= invmax;\n\n    vec3 n = 2.0 * texture(normalMap, vec3(uv * materials.diffuseNormalMapSize[normalMapIndex].zw, normalMapIndex)).rgb - 1.0;\n    n.xy *= materials.roughnessMetalnessNormalScale[materialIndex].zw;\n\n    mat3 tbn = mat3(dpdu, dpdv, normal);\n\n    return normalize(tbn * n);\n  } else {\n    return normal;\n  }\n}\n#endif\n`;\n","import constants from './chunks/constants.glsl';\nimport materialBuffer from './chunks/materialBuffer.glsl';\n\nexport default {\n\noutputs: ['position', 'normal', 'faceNormal', 'color', 'matProps'],\nincludes: [\n  constants,\n  materialBuffer,\n],\nsource: `\n  in vec3 vPosition;\n  in vec3 vNormal;\n  in vec2 vUv;\n  flat in ivec2 vMaterialMeshIndex;\n\n  vec3 faceNormals(vec3 pos) {\n    vec3 fdx = dFdx(pos);\n    vec3 fdy = dFdy(pos);\n    return cross(fdx, fdy);\n  }\n\n  void main() {\n    int materialIndex = vMaterialMeshIndex.x;\n    int meshIndex = vMaterialMeshIndex.y;\n\n    vec2 uv = fract(vUv);\n\n    vec3 color = getMatColor(materialIndex, uv);\n    float roughness = getMatRoughness(materialIndex, uv);\n    float metalness = getMatMetalness(materialIndex, uv);\n    float materialType = getMatType(materialIndex);\n\n    roughness = clamp(roughness, ROUGHNESS_MIN, 1.0);\n    metalness = clamp(metalness, 0.0, 1.0);\n\n    vec3 normal = normalize(vNormal);\n    vec3 faceNormal = normalize(faceNormals(vPosition));\n    normal *= sign(dot(normal, faceNormal));\n\n    #ifdef NUM_NORMAL_MAPS\n      vec3 dp1 = dFdx(vPosition);\n      vec3 dp2 = dFdy(vPosition);\n      vec2 duv1 = dFdx(vUv);\n      vec2 duv2 = dFdy(vUv);\n      normal = getMatNormal(materialIndex, uv, normal, dp1, dp2, duv1, duv2);\n    #endif\n\n    out_position = vec4(vPosition, float(meshIndex) + EPS);\n    out_normal = vec4(normal, materialType);\n    out_faceNormal = vec4(faceNormal, 0);\n    out_color = vec4(color, 0);\n    out_matProps = vec4(roughness, metalness, 0, 0);\n  }\n`\n\n}\n","import { makeRenderPass } from './RenderPass';\nimport vertex from './glsl/gBuffer.vert';\nimport fragment from './glsl/gBuffer.frag';\nimport {mat4} from 'gl-matrix';\n\nexport function makeGBufferPass(gl, { materialBuffer, mergedMesh }) {\n  const renderPass = makeRenderPass(gl, {\n    defines: materialBuffer.defines,\n    vertex,\n    fragment\n  });\n\n  renderPass.setTexture('diffuseMap', materialBuffer.textures.diffuseMap);\n  renderPass.setTexture('normalMap', materialBuffer.textures.normalMap);\n  renderPass.setTexture('pbrMap', materialBuffer.textures.pbrMap);\n\n  const geometry = mergedMesh.geometry;\n\n  const elementCount = geometry.indices.count;\n\n  const vao = gl.createVertexArray();\n\n  gl.bindVertexArray(vao);\n  uploadAttributes(gl, renderPass, geometry);\n  gl.bindVertexArray(null);\n\n  let jitterX = 0;\n  let jitterY = 0;\n  function setJitter(x, y) {\n    jitterX = x;\n    jitterY = y;\n  }\n\n  let currentCamera;\n  function setCamera(camera) {\n    currentCamera = camera;\n  }\n\n  function calcCamera() {\n    const projView = currentCamera.projectionMatrix;\n\n    projView[8] += 2 * jitterX;\n    projView[9] += 2 * jitterY;\n\n    mat4.mul(projView, projView, currentCamera.matrixWorldInverse);\n\n    renderPass.setUniform('projView', projView);\n  }\n\n  function draw() {\n    calcCamera();\n    gl.bindVertexArray(vao);\n    renderPass.useProgram();\n    gl.enable(gl.DEPTH_TEST);\n    gl.drawElements(gl.TRIANGLES, elementCount, gl.UNSIGNED_INT, 0);\n    gl.disable(gl.DEPTH_TEST);\n  }\n\n  return {\n    draw,\n    outputLocs: renderPass.outputLocs,\n    setCamera,\n    setJitter\n  };\n}\n\nfunction uploadAttributes(gl, renderPass, geometry) {\n  setAttribute(gl, renderPass.attribLocs.aPosition, geometry.position);\n  setAttribute(gl, renderPass.attribLocs.aNormal, geometry.normal);\n  setAttribute(gl, renderPass.attribLocs.aUv, geometry.uv);\n  setAttribute(gl, renderPass.attribLocs.aMaterialMeshIndex, geometry.materialMeshIndex);\n\n  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.createBuffer());\n  gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, geometry.indices.array, gl.STATIC_DRAW);\n}\n\nfunction setAttribute(gl, location, bufferAttribute) {\n  if (location === undefined) {\n    return;\n  }\n\n  const { itemSize, array } = bufferAttribute;\n\n  gl.enableVertexAttribArray(location);\n  gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\n  gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\n\n  if (array instanceof Float32Array) {\n    gl.vertexAttribPointer(location, itemSize, gl.FLOAT, false, 0, 0);\n  } else if (array instanceof Int32Array) {\n    gl.vertexAttribIPointer(location, itemSize, gl.INT, 0, 0);\n  } else {\n    throw 'Unsupported buffer type';\n  }\n}\n","export const ThinMaterial = 1;\nexport const ThickMaterial = 2;\nexport const ShadowCatcherMaterial = 3;\n\nexport const LinearToneMapping = 4;\nexport const ReinhardToneMapping = 5;\nexport const Uncharted2ToneMapping = 6;\nexport const CineonToneMapping = 7;\nexport const ACESFilmicToneMapping = 8;","export function makeUniformBuffer(gl, program, blockName) {\n  const blockIndex = gl.getUniformBlockIndex(program, blockName);\n  const blockSize = gl.getActiveUniformBlockParameter(program, blockIndex, gl.UNIFORM_BLOCK_DATA_SIZE);\n\n  const uniforms = getUniformBlockInfo(gl, program, blockIndex);\n\n  const buffer = gl.createBuffer();\n  gl.bindBuffer(gl.UNIFORM_BUFFER, buffer);\n  gl.bufferData(gl.UNIFORM_BUFFER, blockSize, gl.STATIC_DRAW);\n\n  const data = new DataView(new ArrayBuffer(blockSize));\n\n  function set(name, value) {\n    if (!uniforms[name]) {\n      // console.warn('No uniform property with name ', name);\n      return;\n    }\n\n    const { type, size, offset, stride } = uniforms[name];\n\n    switch(type) {\n      case gl.FLOAT:\n        setData(data, 'setFloat32', size, offset, stride, 1, value);\n        break;\n      case gl.FLOAT_VEC2:\n        setData(data, 'setFloat32', size, offset, stride, 2, value);\n        break;\n      case gl.FLOAT_VEC3:\n        setData(data, 'setFloat32', size, offset, stride, 3, value);\n        break;\n      case gl.FLOAT_VEC4:\n        setData(data, 'setFloat32', size, offset, stride, 4, value);\n        break;\n      case gl.INT:\n        setData(data, 'setInt32', size, offset, stride, 1, value);\n        break;\n      case gl.INT_VEC2:\n        setData(data, 'setInt32', size, offset, stride, 2, value);\n        break;\n      case gl.INT_VEC3:\n        setData(data, 'setInt32', size, offset, stride, 3, value);\n        break;\n      case gl.INT_VEC4:\n        setData(data, 'setInt32', size, offset, stride, 4, value);\n        break;\n      case gl.BOOL:\n        setData(data, 'setUint32', size, offset, stride, 1, value);\n        break;\n      default:\n        console.warn('UniformBuffer: Unsupported type');\n    }\n  }\n\n  function bind(index) {\n    gl.bindBuffer(gl.UNIFORM_BUFFER, buffer);\n    gl.bufferSubData(gl.UNIFORM_BUFFER, 0, data);\n    gl.bindBufferBase(gl.UNIFORM_BUFFER, index, buffer);\n  }\n\n  return {\n    set,\n    bind\n  };\n}\n\nfunction getUniformBlockInfo(gl, program, blockIndex) {\n  const indices = gl.getActiveUniformBlockParameter(program, blockIndex, gl.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES);\n  const offset = gl.getActiveUniforms(program, indices, gl.UNIFORM_OFFSET);\n  const stride = gl.getActiveUniforms(program, indices, gl.UNIFORM_ARRAY_STRIDE);\n\n  const uniforms = {};\n  for (let i = 0; i < indices.length; i++) {\n    const { name, type, size } = gl.getActiveUniform(program, indices[i]);\n    uniforms[name] = {\n      type,\n      size,\n      offset: offset[i],\n      stride: stride[i]\n    };\n  }\n\n  return uniforms;\n}\n\nfunction setData(dataView, setter, size, offset, stride, components, value) {\n  const l = Math.min(value.length / components, size);\n  for (let i = 0; i < l; i++) {\n    for (let k = 0; k < components; k++) {\n      dataView[setter](offset + i * stride + k * 4, value[components * i + k], true);\n    }\n  }\n}\n","export function clamp(x, min, max) {\n  return Math.min(Math.max(x, min), max);\n}\n\nexport function shuffle(arr) {\n  for (let i = arr.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    const x = arr[i];\n    arr[i] = arr[j];\n    arr[j] = x;\n  }\n  return arr;\n}\n\nexport function numberArraysEqual(a, b, eps = 1e-4) {\n  for (let i = 0; i < a.length; i++) {\n    if (Math.abs(a[i] - b[i]) > eps) {\n      return false;\n    }\n  }\n\n  return true;\n}\n","import { clamp } from './util';\n\nexport function makeTexture(gl, params) {\n  let {\n    width = null,\n    height = null,\n\n    // A single HTMLImageElement, ImageData, or TypedArray,\n    // Or an array of any of these objects. In this case an Array Texture will be created\n    data = null,\n\n    // If greater than 1, create an Array Texture of this length\n    length = 1,\n\n    // Number of channels, [1-4]. If left blank, the the function will decide the number of channels automatically from the data\n    channels = null,\n\n    // Either 'byte' or 'float'\n    // If left empty, the function will decide the format automatically from the data\n    storage = null,\n\n    // Reverse the texture across the y-axis.\n    flipY = false,\n\n    // sampling properties\n    gammaCorrection = false,\n    wrapS = gl.CLAMP_TO_EDGE,\n    wrapT = gl.CLAMP_TO_EDGE,\n    minFilter = gl.NEAREST,\n    magFilter = gl.NEAREST,\n  } = params;\n\n  width = width || data.width || 0;\n  height = height || data.height || 0;\n\n  const texture = gl.createTexture();\n\n  let target;\n  let dataArray;\n\n  // if data is a JS array but not a TypedArray, assume data is an array of images and create a GL Array Texture\n  if (Array.isArray(data)) {\n    dataArray = data;\n    data = dataArray[0];\n  }\n\n  target = dataArray || length > 1 ? gl.TEXTURE_2D_ARRAY : gl.TEXTURE_2D;\n\n  gl.activeTexture(gl.TEXTURE0);\n  gl.bindTexture(target, texture);\n\n  gl.texParameteri(target, gl.TEXTURE_WRAP_S, wrapS);\n  gl.texParameteri(target, gl.TEXTURE_WRAP_T, wrapT);\n  gl.texParameteri(target, gl.TEXTURE_MIN_FILTER, minFilter);\n  gl.texParameteri(target, gl.TEXTURE_MAG_FILTER, magFilter);\n\n  if (!channels) {\n    if (data && data.length) {\n      channels = data.length / (width * height); // infer number of channels from data size\n    } else {\n      channels = 4;\n    }\n  }\n\n  channels = clamp(channels, 1, 4);\n\n  const { type, format, internalFormat } = getTextureFormat(gl, channels, storage, data, gammaCorrection);\n\n  if (dataArray) {\n    gl.texStorage3D(target, 1, internalFormat, width, height, dataArray.length);\n    for (let i = 0; i < dataArray.length; i++) {\n      // if layer is an HTMLImageElement, use the .width and .height properties of each layer\n      // otherwise use the max size of the array texture\n      const layerWidth = dataArray[i].width || width;\n      const layerHeight = dataArray[i].height || height;\n\n      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, Array.isArray(flipY) ? flipY[i] : flipY);\n\n      gl.texSubImage3D(target, 0, 0, 0, i, layerWidth, layerHeight, 1, format, type, dataArray[i]);\n    }\n  } else if (length > 1) {\n    // create empty array texture\n    gl.texStorage3D(target, 1, internalFormat, width, height, length);\n  } else {\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);\n    gl.texStorage2D(target, 1, internalFormat, width, height);\n    if (data) {\n      gl.texSubImage2D(target, 0, 0, 0, width, height, format, type, data);\n    }\n  }\n\n  // return state to default\n  gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n\n  return {\n    target,\n    texture\n  };\n}\n\nexport function makeDepthTarget(gl, width, height) {\n  const texture = gl.createRenderbuffer();\n  const target = gl.RENDERBUFFER;\n\n  gl.bindRenderbuffer(target, texture);\n  gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT24, width, height);\n  gl.bindRenderbuffer(target, null);\n\n  return {\n    target,\n    texture\n  };\n}\n\nfunction getFormat(gl, channels) {\n  const map = {\n    1: gl.RED,\n    2: gl.RG,\n    3: gl.RGB,\n    4: gl.RGBA\n  };\n  return map[channels];\n}\n\nfunction getTextureFormat(gl, channels, storage, data, gammaCorrection) {\n  let type;\n  let internalFormat;\n\n  const isByteArray =\n    data instanceof Uint8Array ||\n    data instanceof HTMLImageElement ||\n    data instanceof HTMLCanvasElement ||\n    data instanceof ImageData;\n\n  const isFloatArray = data instanceof Float32Array;\n\n  if (storage === 'byte' || (!storage && isByteArray)) {\n    internalFormat = {\n      1: gl.R8,\n      2: gl.RG8,\n      3: gammaCorrection ? gl.SRGB8 : gl.RGB8,\n      4: gammaCorrection ? gl.SRGB8_ALPHA8 : gl.RGBA8\n    }[channels];\n\n    type = gl.UNSIGNED_BYTE;\n  } else if (storage === 'float' || (!storage && isFloatArray)) {\n    internalFormat = {\n      1: gl.R32F,\n      2: gl.RG32F,\n      3: gl.RGB32F,\n      4: gl.RGBA32F\n    }[channels];\n\n    type = gl.FLOAT;\n  } else if (storage === 'halfFloat') {\n    internalFormat = {\n      1: gl.R16F,\n      2: gl.RG16F,\n      3: gl.RGB16F,\n      4: gl.RGBA16F\n    }[channels];\n\n    type = gl.FLOAT;\n  } else if (storage === 'snorm') {\n    internalFormat = {\n      1: gl.R8_SNORM,\n      2: gl.RG8_SNORM,\n      3: gl.RGB8_SNORM,\n      4: gl.RGBA8_SNORM,\n    }[channels];\n\n    type = gl.UNSIGNED_BYTE;\n  }\n\n  const format = getFormat(gl, channels);\n\n  return {\n    format,\n    internalFormat,\n    type\n  };\n}\n","// retrieve textures used by meshes, grouping textures from meshes shared by *the same* mesh property\nexport function getTexturesFromMaterials(meshes, textureNames) {\n  const textureMap = {};\n\n  for (const name of textureNames) {\n    const textures = [];\n    textureMap[name] = {\n      indices: texturesFromMaterials(meshes, name, textures),\n      textures\n    };\n  }\n\n  return textureMap;\n}\n\n// retrieve textures used by meshes, grouping textures from meshes shared *across all* mesh properties\nexport function mergeTexturesFromMaterials(meshes, textureNames) {\n  const textureMap = {\n    textures: [],\n    indices: {}\n  };\n\n  for (const name of textureNames) {\n    textureMap.indices[name] = texturesFromMaterials(meshes, name, textureMap.textures);\n  }\n\n  return textureMap;\n}\n\nfunction texturesFromMaterials(materials, textureName, textures) {\n  const indices = [];\n\n  for (const material of materials) {\n    const isTextureLoaded = material[textureName] && material[textureName].image;\n\n    if (!isTextureLoaded) {\n      indices.push(-1);\n    } else {\n      let index = textures.length;\n      for (let i = 0; i < textures.length; i++) {\n        if (textures[i] === material[textureName]) {\n          // Reuse existing duplicate texture.\n          index = i;\n          break;\n        }\n      }\n      if (index === textures.length) {\n        // New texture. Add texture to list.\n        textures.push(material[textureName]);\n      }\n      indices.push(index);\n    }\n  }\n\n  return indices;\n}\n","import { ThinMaterial, ThickMaterial, ShadowCatcherMaterial } from '../constants';\nimport materialBufferChunk from './glsl/chunks/materialBuffer.glsl';\nimport { makeUniformBuffer } from './UniformBuffer';\nimport { makeRenderPass } from \"./RenderPass\";\nimport { makeTexture } from './Texture';\nimport { getTexturesFromMaterials, mergeTexturesFromMaterials } from './texturesFromMaterials';\n\nexport function makeMaterialBuffer(gl, materials) {\n  const maps = getTexturesFromMaterials(materials, ['map', 'normalMap']);\n  const pbrMap = mergeTexturesFromMaterials(materials, ['roughnessMap', 'metalnessMap']);\n\n  const textures = {};\n\n  const bufferData = {};\n\n  bufferData.color = materials.map(m => m.color.slice(0, 3));\n  bufferData.roughness = materials.map(m => m.roughness);\n  bufferData.metalness = materials.map(m => m.metalness);\n  bufferData.normalScale = materials.map(m => m.normalScale);\n\n  bufferData.type = materials.map(m => {\n    if (m.shadowCatcher) {\n      return ShadowCatcherMaterial;\n    }\n    if (m.transparent) {\n      return m.solid ? ThickMaterial : ThinMaterial;\n    }\n  });\n\n  if (maps.map.textures.length > 0) {\n    const { relativeSizes, texture } = makeTextureArray(gl, maps.map.textures, true);\n    textures.diffuseMap = texture;\n    bufferData.diffuseMapSize = relativeSizes;\n    bufferData.diffuseMapIndex = maps.map.indices;\n  }\n\n  if (maps.normalMap.textures.length > 0) {\n    const { relativeSizes, texture } = makeTextureArray(gl, maps.normalMap.textures, false);\n    textures.normalMap = texture;\n    bufferData.normalMapSize = relativeSizes;\n    bufferData.normalMapIndex = maps.normalMap.indices;\n  }\n\n  if (pbrMap.textures.length > 0) {\n    const { relativeSizes, texture } = makeTextureArray(gl, pbrMap.textures, false);\n    textures.pbrMap = texture;\n    bufferData.pbrMapSize = relativeSizes;\n    bufferData.roughnessMapIndex = pbrMap.indices.roughnessMap;\n    bufferData.metalnessMapIndex = pbrMap.indices.metalnessMap;\n  }\n\n  const defines = {\n    NUM_MATERIALS: materials.length,\n    NUM_DIFFUSE_MAPS: maps.map.textures.length,\n    NUM_NORMAL_MAPS: maps.normalMap.textures.length,\n    NUM_DIFFUSE_NORMAL_MAPS: Math.max(maps.map.textures.length, maps.normalMap.textures.length),\n    NUM_PBR_MAPS: pbrMap.textures.length,\n  };\n\n  // create temporary shader program including the Material uniform buffer\n  // used to query the compiled structure of the uniform buffer\n  const renderPass = makeRenderPass(gl, {\n    vertex: {\n      source: `void main() {}`\n    },\n    fragment: {\n      includes: [ materialBufferChunk ],\n      source: `void main() {}`\n    },\n    defines\n  });\n\n  uploadToUniformBuffer(gl, renderPass.program, bufferData);\n\n  return { defines, textures };\n}\n\nfunction makeTextureArray(gl, textures, gammaCorrection = false) {\n  const images = textures.map(t => t.image);\n  const flipY = textures.map(t => t.flipY);\n  const { maxSize, relativeSizes } = maxImageSize(images);\n\n  // create GL Array Texture from individual textures\n  const texture = makeTexture(gl, {\n    width: maxSize.width,\n    height: maxSize.height,\n    gammaCorrection,\n    data: images,\n    flipY,\n    channels: 3,\n    minFilter: gl.LINEAR,\n    magFilter: gl.LINEAR,\n  });\n\n  return {\n   texture,\n   relativeSizes\n  };\n}\n\nfunction maxImageSize(images) {\n  const maxSize = {\n    width: 0,\n    height: 0\n  };\n\n  for (const image of images) {\n    maxSize.width = Math.max(maxSize.width, image.width);\n    maxSize.height = Math.max(maxSize.height, image.height);\n  }\n\n  const relativeSizes = [];\n  for (const image of images) {\n    relativeSizes.push(image.width / maxSize.width);\n    relativeSizes.push(image.height / maxSize.height);\n  }\n\n  return { maxSize, relativeSizes };\n}\n\n\n// Upload arrays to uniform buffer objects\n// Packs different arrays into vec4's to take advantage of GLSL's std140 memory layout\n\nfunction uploadToUniformBuffer(gl, program, bufferData) {\n  const materialBuffer = makeUniformBuffer(gl, program, 'Materials');\n\n  materialBuffer.set('Materials.colorAndMaterialType[0]', interleave(\n    { data: [].concat(...bufferData.color), channels: 3 },\n    { data: bufferData.type, channels: 1}\n  ));\n\n  materialBuffer.set('Materials.roughnessMetalnessNormalScale[0]', interleave(\n    { data: bufferData.roughness, channels: 1 },\n    { data: bufferData.metalness, channels: 1 },\n    { data: [].concat(...bufferData.normalScale), channels: 2 }\n  ));\n\n  materialBuffer.set('Materials.diffuseNormalRoughnessMetalnessMapIndex[0]', interleave(\n    { data: bufferData.diffuseMapIndex, channels: 1 },\n    { data: bufferData.normalMapIndex, channels: 1 },\n    { data: bufferData.roughnessMapIndex, channels: 1 },\n    { data: bufferData.metalnessMapIndex, channels: 1 }\n  ));\n\n  materialBuffer.set('Materials.diffuseNormalMapSize[0]', interleave(\n    { data: bufferData.diffuseMapSize, channels: 2 },\n    { data: bufferData.normalMapSize, channels: 2 }\n  ));\n\n  materialBuffer.set('Materials.pbrMapSize[0]', bufferData.pbrMapSize);\n\n  materialBuffer.bind(0);\n}\n\nfunction interleave(...arrays) {\n  let maxLength = 0;\n  for (let i = 0; i < arrays.length; i++) {\n    const a = arrays[i];\n    const l = a.data ? a.data.length / a.channels : 0;\n    maxLength = Math.max(maxLength, l);\n  }\n\n  const interleaved = [];\n  for (let i = 0; i < maxLength; i++) {\n    for (let j = 0; j < arrays.length; j++) {\n      const { data = [], channels } = arrays[j];\n      for (let c = 0; c < channels; c++) {\n        interleaved.push(data[i * channels + c]);\n      }\n    }\n  }\n\n  return interleaved;\n}\n","import { Attribute, Geometry } from '../scene/Geometry';\nimport {mat4, vec3} from 'gl-matrix';\n\nexport function mergeMeshesToGeometry(meshes) {\n\n  let vertexCount = 0;\n  let indexCount = 0;\n\n  const geometryAndMaterialIndex = [];\n  const materialIndexMap = new Map();\n\n  for (const mesh of meshes) {\n    let geometry = mesh.geometry;\n\n    const index = geometry.indices;\n    if (!index) {\n      addFlatGeometryIndices(geometry);\n    }\n\n    geometry = transformGeometry(geometry, mesh.matrixWorld);\n\n    if (!geometry.normal) {\n      computeGeometryNormals(geometry);\n    }\n    else {\n      vec3.forEach(geometry.normal.array, 3, 0, undefined, vec3.normalize);\n    }\n\n    vertexCount += geometry.position.count;\n    indexCount += geometry.indices.count;\n\n    const material = mesh.material;\n    let materialIndex = materialIndexMap.get(material);\n    if (materialIndex === undefined) {\n      materialIndex = materialIndexMap.size;\n      materialIndexMap.set(material, materialIndex);\n    }\n\n    geometryAndMaterialIndex.push({\n      geometry,\n      materialIndex\n    });\n  }\n\n  const geometry = mergeGeometry(geometryAndMaterialIndex, vertexCount, indexCount);\n\n  return {\n    geometry,\n    materials: Array.from(materialIndexMap.keys())\n  };\n}\n\nfunction mergeGeometry(geometryAndMaterialIndex, vertexCount, indexCount) {\n  const positionAttrib = new Attribute(new Float32Array(3 * vertexCount), 3);\n  const normalAttrib = new Attribute(new Float32Array(3 * vertexCount), 3);\n  const uvAttrib = new Attribute(new Float32Array(2 * vertexCount), 2);\n  const indexAttrib = new Attribute(new Uint32Array(indexCount), 1);\n\n  const materialMeshIndexAttrib = new Attribute(new Int32Array(2 * vertexCount), 2);\n\n  const mergedGeometry = new Geometry({\n    position: positionAttrib,\n    normal: normalAttrib,\n    uv: uvAttrib,\n    indices: indexAttrib\n  });\n  mergedGeometry.materialMeshIndex = materialMeshIndexAttrib;\n\n  let currentVertex = 0;\n  let currentIndex = 0;\n  let currentMesh = 1;\n\n  for (const { geometry, materialIndex } of geometryAndMaterialIndex) {\n    const vertexCount = geometry.position.count;\n\n    ['position', 'normal', 'uv'].forEach(function (attr) {\n      mergedGeometry[attr].array.set(geometry[attr].array, currentVertex * geometry[attr].itemSize);\n    });\n\n    const meshIndices = geometry.indices.array;\n    for (let i = 0; i < meshIndices.length; i++) {\n      indexAttrib.array[currentIndex + i] = currentVertex + meshIndices[i];\n    }\n\n    for (let i = 0; i < vertexCount * 2;) {\n      materialMeshIndexAttrib.array[currentVertex * 2 + i++] = materialIndex;\n      materialMeshIndexAttrib.array[currentVertex * 2 + i++] = currentMesh;\n    }\n\n    currentVertex += vertexCount;\n    currentIndex += meshIndices.length;\n    currentMesh++;\n  }\n\n  return mergedGeometry;\n}\n\nfunction addFlatGeometryIndices(geometry) {\n  const position = geometry.position;\n\n  if (!position) {\n    console.warn('No position attribute');\n    return;\n  }\n\n  const index = new Uint32Array(position.count);\n\n  for (let i = 0; i < index.length; i++) {\n    index[i] = i;\n  }\n\n  geometry.indices = new Attribute(index, 1, false);\n\n  return geometry;\n}\n\nfunction transformGeometry(geometry, matrix) {\n  const newGeometry = new Geometry({\n    position: new Attribute(geometry.position.array.slice(), geometry.position.itemSize),\n    normal: geometry.normal && new Attribute(geometry.normal.array.slice(), geometry.normal.itemSize),\n    // No need to clone uv\n    uv: geometry.uv && new Attribute(geometry.uv.array, geometry.uv.itemSize),\n    indices: geometry.indices && new Attribute(geometry.indices.array, geometry.indices.itemSize),\n  });\n\n  // Normal Matrix\n  const inverseTransposeMatrix = mat4.create();\n  mat4.invert(inverseTransposeMatrix, matrix);\n  mat4.transpose(inverseTransposeMatrix, inverseTransposeMatrix);\n\n  vec3.forEach(newGeometry.position.array, 3, 0, null, vec3.transformMat4, matrix);\n  if (newGeometry.normal) {\n      vec3.forEach(newGeometry.normal.array, 3, 0, null, vec3.transformMat4, inverseTransposeMatrix);\n  }\n  return newGeometry;\n}\n\nfunction computeGeometryNormals(geometry) {\n  const indices = geometry.indices;\n  const positions = geometry.position.array;\n  geometry.normal = new Attribute(new Float32Array(positions.length), 3);\n  const normals = geometry.normal.array;\n\n  const p1 = vec3.create();\n  const p2 = vec3.create();\n  const p3 = vec3.create();\n\n  const v21 = vec3.create();\n  const v32 = vec3.create();\n\n  const n = vec3.create();\n\n  const len = indices ? indices.length : this.vertexCount;\n  let i1, i2, i3;\n  for (let f = 0; f < len;) {\n      if (indices) {\n          i1 = indices[f++];\n          i2 = indices[f++];\n          i3 = indices[f++];\n      }\n      else {\n          i1 = f++;\n          i2 = f++;\n          i3 = f++;\n      }\n\n      vec3.set(p1, positions[i1*3], positions[i1*3+1], positions[i1*3+2]);\n      vec3.set(p2, positions[i2*3], positions[i2*3+1], positions[i2*3+2]);\n      vec3.set(p3, positions[i3*3], positions[i3*3+1], positions[i3*3+2]);\n\n      vec3.sub(v21, p1, p2);\n      vec3.sub(v32, p2, p3);\n      vec3.cross(n, v21, v32);\n      // Already be weighted by the triangle area\n      for (let i = 0; i < 3; i++) {\n          normals[i1*3+i] = normals[i1*3+i] + n[i];\n          normals[i2*3+i] = normals[i2*3+i] + n[i];\n          normals[i3*3+i] = normals[i3*3+i] + n[i];\n      }\n  }\n\n  for (let i = 0; i < normals.length;) {\n      vec3.set(n, normals[i], normals[i+1], normals[i+2]);\n      vec3.normalize(n, n);\n      normals[i++] = n[0];\n      normals[i++] = n[1];\n      normals[i++] = n[2];\n  }\n}","// Reorders the elements in the range [first, last) in such a way that\n// all elements for which the comparator c returns true\n// precede the elements for which comparator c returns false.\nexport function partition(array, compare, left = 0, right = array.length) {\n  while (left !== right) {\n    while (compare(array[left])) {\n      left++;\n      if (left === right) {\n        return left;\n      }\n    }\n    do {\n      right--;\n      if (left === right) {\n        return left;\n      }\n    } while (!compare(array[right]));\n\n    swap(array, left, right);\n    left++;\n  }\n\n  return left;\n}\n\n// nth_element is a partial sorting algorithm that rearranges elements in [first, last) such that:\n// The element pointed at by nth is changed to whatever element would occur in that position if [first, last) were sorted.\n// All of the elements before this new nth element compare to true with elements after the nth element\nexport function nthElement(array, compare, left = 0, right = array.length, k = Math.floor((left + right) / 2)) {\n  for (let i = left; i <= k; i++) {\n    let minIndex = i;\n    let minValue = array[i];\n    for (let j = i + 1; j < right; j++) {\n      if (!compare(minValue, array[j])) {\n        minIndex = j;\n        minValue = array[j];\n        swap(array, i, minIndex);\n      }\n    }\n  }\n}\n\nfunction swap(array, a, b) {\n  const x = array[b];\n  array[b] = array[a];\n  array[a] = x;\n}\n","// Create a bounding volume hierarchy of scene geometry\n// Uses the surface area heuristic (SAH) algorithm for efficient partitioning\n// http://www.pbr-book.org/3ed-2018/Primitives_and_Intersection_Acceleration/Bounding_Volume_Hierarchies.html\n\nimport { partition, nthElement } from './bvhUtil';\nimport {vec3} from 'gl-matrix';\n\n\nclass Box3 {\n  constructor() {\n    this.min = [Infinity, Infinity, Infinity];\n    this.max = [-Infinity, -Infinity, -Infinity];\n  }\n\n  union(target) {\n    vec3.min(this.min, this.min, target.min);\n    vec3.max(this.max, this.max, target.max);\n    return this;\n  }\n}\n\nexport function bvhAccel(geometry) {\n  const primitiveInfo = makePrimitiveInfo(geometry);\n  const node = recursiveBuild(primitiveInfo, 0, primitiveInfo.length);\n\n  return node;\n}\n\nexport function flattenBvh(bvh) {\n  const flat = [];\n  const isBounds = [];\n\n  const splitAxisMap = {\n    x: 0,\n    y: 1,\n    z: 2\n  };\n\n  let maxDepth = 1;\n  const traverse = (node, depth = 1) => {\n\n    maxDepth = Math.max(depth, maxDepth);\n\n    if (node.primitives) {\n      for (let i = 0; i < node.primitives.length; i++) {\n        const p = node.primitives[i];\n        flat.push(\n          p.indices[0], p.indices[1], p.indices[2], node.primitives.length,\n          p.faceNormal[0], p.faceNormal[1], p.faceNormal[2], p.materialIndex\n        );\n        isBounds.push(false);\n      }\n    } else {\n      const bounds = node.bounds;\n\n      flat.push(\n        bounds.min[0], bounds.min[1], bounds.min[2], splitAxisMap[node.splitAxis],\n        bounds.max[0], bounds.max[1], bounds.max[2], null // pointer to second shild\n      );\n\n      const i = flat.length - 1;\n      isBounds.push(true);\n\n      traverse(node.child0, depth + 1);\n      flat[i] = flat.length / 4; // pointer to second child\n      traverse(node.child1, depth + 1);\n    }\n  };\n\n  traverse(bvh);\n\n  const buffer = new ArrayBuffer(4 * flat.length);\n  const floatView = new Float32Array(buffer);\n  const intView = new Int32Array(buffer);\n\n  for (let i = 0; i < isBounds.length; i++) {\n    let k = 8 * i;\n\n    if (isBounds[i]) {\n      floatView[k] = flat[k];\n      floatView[k + 1] = flat[k + 1];\n      floatView[k + 2] = flat[k + 2];\n      intView[k + 3] = flat[k + 3];\n    } else {\n      intView[k] = flat[k];\n      intView[k + 1] = flat[k + 1];\n      intView[k + 2] = flat[k + 2];\n      intView[k + 3] = -flat[k + 3]; // negative signals to shader that this node is a triangle\n    }\n\n    floatView[k + 4] = flat[k + 4];\n    floatView[k + 5] = flat[k + 5];\n    floatView[k + 6] = flat[k + 6];\n    intView[k + 7] = flat[k + 7];\n  }\n\n  return {\n    maxDepth,\n    count: flat.length / 4,\n    buffer: floatView\n  };\n}\n\nfunction makePrimitiveInfo(geometry) {\n  const primitiveInfo = [];\n  const indices = geometry.indices.array;\n  const position = geometry.position;\n  const materialMeshIndex = geometry.materialMeshIndex;\n\n  const v0 = [0, 0, 0];\n  const v1 = [0, 0, 0];\n  const v2 = [0, 0, 0];\n  const e0 = [0, 0, 0];\n  const e1 = [0, 0, 0];\n\n  for (let i = 0; i < indices.length; i += 3) {\n    const i0 = indices[i];\n    const i1 = indices[i + 1];\n    const i2 = indices[i + 2];\n\n    const bounds = new Box3();\n    const min = bounds.min;\n    const max = bounds.max;\n\n    position.getItem(v0, i0);\n    position.getItem(v1, i1);\n    position.getItem(v2, i2);\n\n    vec3.sub(e0, v2, v0);\n    vec3.sub(e1, v1, v0);\n\n    vec3.min(min, min, v0);\n    vec3.min(min, min, v1);\n    vec3.min(min, min, v2);\n    vec3.max(max, max, v0);\n    vec3.max(max, max, v1);\n    vec3.max(max, max, v2);\n\n    const faceNormal = [];\n    const info = {\n      bounds: bounds,\n      center: [\n        (min[0] + max[0]) / 2,\n        (min[1] + max[1]) / 2,\n        (min[2] + max[2]) / 2\n      ],\n      indices: [i0, i1, i2],\n      faceNormal: vec3.normalize(faceNormal, vec3.cross(faceNormal, e1, e0)),\n      materialIndex: materialMeshIndex.array[i0 * 2]\n    };\n\n    primitiveInfo.push(info);\n  }\n\n  return primitiveInfo;\n}\n\nfunction recursiveBuild(primitiveInfo, start, end) {\n  const bounds = new Box3();\n  for (let i = start; i < end; i++) {\n    bounds.union(primitiveInfo[i].bounds);\n  }\n\n  const nPrimitives = end - start;\n\n  if (nPrimitives === 1) {\n    return makeLeafNode(primitiveInfo.slice(start, end), bounds);\n  } else {\n    const centroidBounds = new Box3();\n    for (let i = start; i < end; i++) {\n      vec3.min(centroidBounds.min, centroidBounds.min, primitiveInfo[i].center);\n      vec3.max(centroidBounds.max, centroidBounds.max, primitiveInfo[i].center);\n    }\n    const dim = maximumExtent(centroidBounds);\n\n    let mid = Math.floor((start + end) / 2);\n\n    // middle split method\n    // const dimMid = (centroidBounds.max[dim] + centroidBounds.min[dim]) / 2;\n    // mid = partition(primitiveInfo, p => p.center[dim] < dimMid, start, end);\n\n    // if (mid === start || mid === end) {\n    //   mid = Math.floor((start + end) / 2);\n    //   nthElement(primitiveInfo, (a, b) => a.center[dim] < b.center[dim], start, end, mid);\n    // }\n\n    // surface area heuristic method\n    if (nPrimitives <= 4) {\n      nthElement(primitiveInfo, (a, b) => a.center[dim] < b.center[dim], start, end, mid);\n    } else if (centroidBounds.max[dim] === centroidBounds.min[dim]) {\n      // can't split primitives based on centroid bounds. terminate.\n      return makeLeafNode(primitiveInfo.slice(start, end), bounds);\n    } else {\n\n      const buckets = [];\n      for (let i = 0; i < 12; i++) {\n        buckets.push({\n          bounds: new Box3(),\n          count: 0,\n        });\n      }\n\n      for (let i = start; i < end; i++) {\n        let b = Math.floor(buckets.length * boxOffset(centroidBounds, dim, primitiveInfo[i].center));\n        if (b === buckets.length) {\n          b = buckets.length - 1;\n        }\n        buckets[b].count++;\n        buckets[b].bounds.union(primitiveInfo[i].bounds);\n      }\n\n      const cost = [];\n\n      for (let i = 0; i < buckets.length - 1; i++) {\n        const b0 = new Box3();\n        const b1 = new Box3();\n        let count0 = 0;\n        let count1 = 0;\n        for (let j = 0; j <= i; j++) {\n          b0.union(buckets[j].bounds);\n          count0 += buckets[j].count;\n        }\n        for (let j = i + 1; j < buckets.length; j++) {\n          b1.union(buckets[j].bounds);\n          count1 += buckets[j].count;\n        }\n        cost.push(0.1 + (count0 * surfaceArea(b0) + count1 * surfaceArea(b1)) / surfaceArea(bounds));\n      }\n\n      let minCost = cost[0];\n      let minCostSplitBucket = 0;\n      for (let i = 1; i < cost.length; i++) {\n        if (cost[i] < minCost) {\n          minCost = cost[i];\n          minCostSplitBucket = i;\n        }\n      }\n\n      mid = partition(primitiveInfo, p => {\n        let b = Math.floor(buckets.length * boxOffset(centroidBounds, dim, p.center));\n        if (b === buckets.length) {\n          b = buckets.length - 1;\n        }\n        return b <= minCostSplitBucket;\n      }, start, end);\n    }\n\n    return makeInteriorNode(\n      dim,\n      recursiveBuild(primitiveInfo, start, mid),\n      recursiveBuild(primitiveInfo, mid, end),\n    );\n  }\n}\n\nfunction makeLeafNode(primitives, bounds) {\n  return {\n    primitives,\n    bounds\n  };\n}\n\nfunction makeInteriorNode(splitAxis, child0, child1) {\n  return {\n    child0,\n    child1,\n    bounds: new Box3().union(child0.bounds).union(child1.bounds),\n    splitAxis,\n  };\n}\nconst size = [0, 0, 0];\n\nfunction maximumExtent(box3) {\n  vec3.sub(size, box3.max, box3.min);\n  if (size[0] > size[2]) {\n    return size[0] > size[1] ? '0' : '1';\n  } else {\n    return size[2] > size[1] ? '2' : '1';\n  }\n}\n\nfunction boxOffset(box3, dim, v) {\n  let offset = v[dim] - box3.min[dim];\n\n  if (box3.max[dim] > box3.min[dim]){\n    offset /= box3.max[dim] - box3.min[dim];\n  }\n\n  return offset;\n}\n\nfunction surfaceArea(box3) {\n  vec3.sub(size, box3.max, box3.min);\n  return 2 * (size[0] * size[2] + size[0] * size[1] + size[2] * size[1]);\n}\n","// Convert image data from the RGBE format to a 32-bit floating point format\n// See https://www.cg.tuwien.ac.at/research/theses/matkovic/node84.html for a description of the RGBE format\n// Optional multiplier argument for performance optimization\nexport function rgbeToFloat(buffer, intensity = 1) {\n  const texels = buffer.length / 4;\n  const floatBuffer = new Float32Array(texels * 3);\n\n  const expTable = [];\n  for (let i = 0; i < 255; i++) {\n    expTable[i] = intensity * Math.pow(2, i - 128) / 255;\n  }\n\n  for (let i = 0; i < texels; i++) {\n\n    const r = buffer[4 * i];\n    const g = buffer[4 * i + 1];\n    const b = buffer[4 * i + 2];\n    const a = buffer[4 * i + 3];\n    const e = expTable[a];\n\n    floatBuffer[3 * i] = r * e;\n    floatBuffer[3 * i + 1] = g * e;\n    floatBuffer[3 * i + 2] = b * e;\n  }\n\n  return floatBuffer;\n}\n","// Convert image data from the RGBE format to a 32-bit floating point format\n// See https://www.cg.tuwien.ac.at/research/theses/matkovic/node84.html for a description of the RGBE format\n\nimport { rgbeToFloat } from './rgbeToFloat';\nimport { clamp } from './util';\nimport {vec3} from 'gl-matrix';\n\nconst DEFAULT_MAP_RESOLUTION = {\n  width: 2048,\n  height: 1024,\n};\n\n// Tools for generating and modify env maps for lighting from scene component data\n\nexport function generateBackgroundMapFromSceneBackground(background) {\n  let backgroundImage;\n\n  // Is [r,g,b,a] color\n  if (Array.isArray(background)) {\n    backgroundImage = generateSolidMap(1, 1, background);\n  } else if (background.image && background.image.data) { // Is rgbe data\n      backgroundImage = {\n        width: background.image.width,\n        height: background.image.height,\n        data: background.image.data,\n      };\n      backgroundImage.data = rgbeToFloat(backgroundImage.data);\n  }\n  return backgroundImage;\n}\n\nexport function generateEnvMapFromSceneComponents(directionalLights, ambientLights, environmentLights) {\n  let envImage = initializeEnvMap(environmentLights);\n  ambientLights.forEach( light => { addAmbientLightToEnvMap(light, envImage); });\n  directionalLights.forEach( light => { envImage.data = addDirectionalLightToEnvMap(light, envImage); });\n\n  return envImage;\n}\n\nexport function initializeEnvMap(environmentLights) {\n  let envImage;\n\n  // Initialize map from environment light if present\n  if (environmentLights.length > 0) {\n    // TODO: support multiple environment lights (what if they have different resolutions?)\n    const environmentLight = environmentLights[0];\n    envImage = {\n      width: environmentLight.map.image.width,\n      height: environmentLight.map.image.height,\n      data: environmentLight.map.image.data,\n    };\n    envImage.data = rgbeToFloat(envImage.data, environmentLight.intensity);\n  } else {\n    // initialize blank map\n    envImage = generateSolidMap(DEFAULT_MAP_RESOLUTION.width, DEFAULT_MAP_RESOLUTION.height);\n  }\n\n  return envImage;\n}\n\nexport function generateSolidMap(width, height, color, intensity) {\n  const texels = width * height;\n  const floatBuffer = new Float32Array(texels * 3);\n  if (color && Array.isArray(color)) {\n    setBufferToColor(floatBuffer, color, intensity);\n  }\n  return {\n    width: width,\n    height: height,\n    data: floatBuffer,\n  };\n}\n\nfunction setBufferToColor(buffer, color, intensity = 1) {\n  buffer.forEach(function(part, index) {\n    const component = index % 3;\n    if (component === 0) {\n      buffer[index] = color[0] * intensity;\n    }\n    else if (component === 1) {\n      buffer[index] = color[1] * intensity;\n    }\n    else if (component === 2) {\n      buffer[index] = color[2] * intensity;\n    }\n  });\n  return buffer;\n}\n\nexport function addAmbientLightToEnvMap(light, image) {\n  const color = light.color;\n  image.data.forEach(function(part, index) {\n    const component = index % 3;\n    if (component === 0) {\n      image.data[index] += color[0] * light.intensity;\n    }\n    else if (component === 1) {\n      image.data[index] += color[1] * light.intensity;\n    }\n    else if (component === 2) {\n      image.data[index] += color[2] * light.intensity;\n    }\n  });\n}\n\nexport function addDirectionalLightToEnvMap(light, image) {\n  const lightDirection = light.direction;\n  const sphericalCoords = eulerToSpherical(lightDirection[0], lightDirection[1], lightDirection[2]);\n\n  sphericalCoords.theta = (Math.PI * 3 / 2) - sphericalCoords.theta;\n  // make safe\n  var EPS = 0.000001;\n  sphericalCoords.phi = Math.max(EPS, Math.min(Math.PI - EPS, sphericalCoords.phi));\n\n  return addLightAtCoordinates(light, image, sphericalCoords);\n}\n\n// Perform modifications on env map to match input scene\nfunction addLightAtCoordinates(light, image, originCoords) {\n  const floatBuffer = image.data;\n  const width = image.width;\n  const height = image.height;\n  const xTexels = floatBuffer.length / (3 * height);\n  const yTexels = floatBuffer.length / (3 * width);\n\n  // default softness for standard directional lights is 0.01, i.e. a hard shadow\n  const softness = light.softness || 0.01;\n\n  // angle from center of light at which no more contributions are projected\n  const threshold = findThreshold(softness);\n\n  // if too few texels are rejected by the threshold then the time to evaluate it is no longer worth it\n  const useThreshold = threshold < Math.PI / 5;\n\n  // functional trick to keep the conditional check out of the main loop\n  const intensityFromAngleFunction = useThreshold ? getIntensityFromAngleDifferentialThresholded : getIntensityFromAngleDifferential;\n\n  let begunAddingContributions = false;\n  let currentCoords = {\n    radius: 1\n  };\n\n  // Iterates over each row from top to bottom\n  for (let i = 0; i < xTexels; i++) {\n    let encounteredInThisRow = false;\n\n    // Iterates over each texel in row\n    for (let j = 0; j < yTexels; j++) {\n      const bufferIndex = j * width + i;\n      currentCoords = equirectangularToSpherical(i, j, width, height, currentCoords);\n      const falloff = intensityFromAngleFunction(originCoords, currentCoords, softness, threshold);\n\n      if(falloff > 0) {\n        encounteredInThisRow = true;\n        begunAddingContributions = true;\n      }\n\n      const intensity = light.intensity * falloff;\n\n      floatBuffer[bufferIndex * 3] += intensity * light.color[0];\n      floatBuffer[bufferIndex * 3 + 1] += intensity * light.color[1];\n      floatBuffer[bufferIndex * 3 + 2] += intensity * light.color[2];\n    }\n\n    // First row to not add a contribution since adding began\n    // This means the entire light has been added and we can exit early\n    if(!encounteredInThisRow && begunAddingContributions) {\n      return floatBuffer;\n    }\n  }\n\n  return floatBuffer;\n}\n\nfunction findThreshold(softness) {\n  const step = Math.PI / 128;\n  const maxSteps = (2.0 * Math.PI) / step;\n\n  for (let i = 0; i < maxSteps; i++) {\n    const angle = i * step;\n    const falloff = getFalloffAtAngle(angle, softness);\n    if (falloff <= 0.0001) {\n      return angle;\n    }\n  }\n}\n\nfunction getIntensityFromAngleDifferentialThresholded(originCoords, currentCoords, softness, threshold) {\n  const deltaPhi = getAngleDelta(originCoords.phi, currentCoords.phi);\n  const deltaTheta = getAngleDelta(originCoords.theta, currentCoords.theta);\n\n  if(deltaTheta > threshold && deltaPhi > threshold) {\n    return 0;\n  }\n\n  const angle = angleBetweenSphericals(originCoords, currentCoords);\n  return getFalloffAtAngle(angle, softness);\n}\n\nfunction getIntensityFromAngleDifferential(originCoords, currentCoords, softness) {\n  const angle = angleBetweenSphericals(originCoords, currentCoords);\n  return getFalloffAtAngle(angle, softness);\n}\n\nexport function getAngleDelta(angleA, angleB) {\n  const diff = Math.abs(angleA - angleB) % (2 * Math.PI);\n  return diff > Math.PI ? (2 * Math.PI - diff) : diff;\n}\n\nconst angleBetweenSphericals = function() {\n  let originVector = [];\n  let currentVector = [];\n  return (originCoords, currentCoords) => {\n    sphericalToEuler(originVector, originCoords.theta, originCoords.phi, originCoords.radius);\n    sphericalToEuler(currentVector, currentCoords.theta, currentCoords.phi, currentCoords.radius);\n\n    const theta = vec3.dot(currentVector, currentVector) / Math.sqrt(vec3.sqrLen(originVector) * vec3.sqrLen(currentVector));\n\t\t// clamp, to handle numerical problems\n\t\treturn Math.acos(Math.min(Math.max(theta, -1), 1));\n  };\n}();\n\n  // TODO: possibly clean this up and optimize it\n  //\n  // This function was arrived at through experimentation, it provides good\n  // looking results with percieved softness that scale relatively linearly with\n  //  the softness value in the 0 - 1 range\n  //\n  // For now it doesn't incur too much of a performance penalty because for most of our use cases (lights without too much softness)\n  // the threshold cutoff in getIntensityFromAngleDifferential stops us from running it too many times\nfunction getFalloffAtAngle(angle, softness) {\n  const softnessCoefficient = Math.pow(2, 14.5 * Math.max(0.001, 1.0 - clamp(softness, 0.0, 1.0)));\n  const falloff = Math.pow(softnessCoefficient, 1.1) * Math.pow(8, -softnessCoefficient * Math.pow(angle, 1.8));\n  return falloff;\n}\n\nexport function equirectangularToSpherical(x, y, width, height, target) {\n  target.phi = (Math.PI * y) / height;\n  target.theta = (2.0 * Math.PI * x) / width;\n  return target;\n}\n\nfunction eulerToSpherical(x, y, z) {\n\n  const radius = Math.sqrt(x * x + y * y + z * z);\n\n  if (radius === 0 ) {\n    return {\n      radius: 0,\n      theta: 0,\n      phi: 0\n    };\n  } else {\n    return {\n      theta: Math.atan2(x, z),\n      phi: Math.acos(Math.min(Math.max(y / radius, -1), 1)),\n      radius\n    };\n  }\n}\n\nfunction sphericalToEuler(out, theta, phi, radius) {\n  const sinPhiRadius = Math.sin(phi) * radius;\n  out[0] = sinPhiRadius * Math.sin(theta);\n  out[1] = Math.cos(phi) * radius;\n  out[2] = sinPhiRadius * Math.cos(theta);\n}","// Create a piecewise 2D cumulative distribution function of light intensity from an env map\n// http://www.pbr-book.org/3ed-2018/Monte_Carlo_Integration/2D_Sampling_with_Multidimensional_Transformations.html#Piecewise-Constant2DDistributions\n\nexport function envMapDistribution(image) {\n  const data = image.data;\n\n  const cdfImage = {\n    width: image.width + 2,\n    height: image.height + 1\n  };\n\n  const cdf = makeTextureArray(cdfImage.width, cdfImage.height, 2);\n\n  for (let y = 0; y < image.height; y++) {\n    const sinTheta = Math.sin(Math.PI * (y + 0.5) / image.height);\n    for (let x = 0; x < image.width; x++) {\n      const i = 3 * (y * image.width + x);\n      let r = data[i];\n      let g = data[i + 1];\n      let b = data[i + 2];\n      let luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n      luminance *= sinTheta;\n      cdf.set(x + 2, y, 0, cdf.get(x + 1, y, 0) + luminance / image.width);\n      cdf.set(x + 1, y, 1, luminance);\n    }\n\n    const rowIntegral = cdf.get(cdfImage.width - 1, y, 0);\n\n    for (let x = 1; x < cdf.width; x++) {\n      cdf.set(x, y, 0, cdf.get(x, y, 0) / rowIntegral);\n      cdf.set(x, y, 1, cdf.get(x, y, 1) / rowIntegral);\n    }\n\n    cdf.set(0, y + 1, 0, cdf.get(0, y, 0) + rowIntegral / image.height);\n    cdf.set(0, y, 1, rowIntegral);\n  }\n\n  const integral = cdf.get(0, cdf.height - 1, 0);\n\n  for (let y = 0; y < cdf.height; y++) {\n    cdf.set(0, y, 0, cdf.get(0, y, 0) / integral);\n    cdf.set(0, y, 1, cdf.get(0, y, 1) / integral);\n  }\n  cdfImage.data = cdf.array;\n\n  return cdfImage;\n}\n\n\nfunction makeTextureArray(width, height, channels) {\n  const array = new Float32Array(channels * width * height);\n\n  return {\n    set(x, y, channel, val) {\n      array[channels * (y * width + x) + channel] = val;\n    },\n    get(x, y, channel) {\n      return array[channels * (y * width + x) + channel];\n    },\n    width,\n    height,\n    channels,\n    array\n  };\n}\n","export function unrollLoop(indexName, start, limit, step, code) {\n  let unrolled = `int ${indexName};\\n`;\n\n  for (let i = start; (step > 0 && i < limit) || (step < 0 && i > limit); i += step) {\n    unrolled += `${indexName} = ${i};\\n`;\n    unrolled += code;\n  }\n\n  return unrolled;\n}\n","export default `\n  #define STANDARD 0\n  #define THIN_GLASS 1\n  #define THICK_GLASS 2\n  #define SHADOW_CATCHER 3\n\n  const float IOR = 1.5;\n  const float INV_IOR = 1.0 / IOR;\n\n  const float IOR_THIN = 1.015;\n  const float INV_IOR_THIN = 1.0 / IOR_THIN;\n\n  const float R0 = (1.0 - IOR) * (1.0 - IOR)  / ((1.0 + IOR) * (1.0 + IOR));\n\n  // https://www.w3.org/WAI/GL/wiki/Relative_luminance\n  const vec3 luminance = vec3(0.2126, 0.7152, 0.0722);\n\n  #define RAY_MAX_DISTANCE 9999.0\n\n  struct Ray {\n    vec3 o;\n    vec3 d;\n    vec3 invD;\n    float tMax;\n  };\n\n  struct SurfaceInteraction {\n    bool hit;\n    vec3 position;\n    vec3 normal; // smoothed normal from the three triangle vertices\n    vec3 faceNormal; // normal of the triangle\n    vec3 color;\n    float roughness;\n    float metalness;\n    int materialType;\n  };\n\n  struct Camera {\n    mat4 transform;\n    float aspect;\n    float fov;\n    float focus;\n    float aperture;\n  };\n\n  void initRay(inout Ray ray, vec3 origin, vec3 direction) {\n    ray.o = origin;\n    ray.d = direction;\n    ray.invD = 1.0 / ray.d;\n    ray.tMax = RAY_MAX_DISTANCE;\n  }\n\n  // given the index from a 1D array, retrieve corresponding position from packed 2D texture\n  ivec2 unpackTexel(int i, int columnsLog2) {\n    ivec2 u;\n    u.y = i >> columnsLog2; // equivalent to (i / 2^columnsLog2)\n    u.x = i - (u.y << columnsLog2); // equivalent to (i % 2^columnsLog2)\n    return u;\n  }\n\n  vec4 fetchData(sampler2D s, int i, int columnsLog2) {\n    return texelFetch(s, unpackTexel(i, columnsLog2), 0);\n  }\n\n  ivec4 fetchData(highp isampler2D s, int i, int columnsLog2) {\n    return texelFetch(s, unpackTexel(i, columnsLog2), 0);\n  }\n\n  struct Path {\n    Ray ray;\n    vec3 li;\n    float alpha;\n    vec3 beta;\n    bool specularBounce;\n    bool abort;\n    float misWeight;\n  };\n\n  uniform Camera camera;\n  uniform vec2 pixelSize; // 1 / screenResolution\n  uniform vec2 jitter;\n\n  in vec2 vCoord;\n`;\n","// Manually performs linear filtering if the extension OES_texture_float_linear is not supported\n\nexport default `\nvec4 textureLinear(sampler2D map, vec2 uv) {\n  #ifdef OES_texture_float_linear\n    return texture(map, uv);\n  #else\n    vec2 size = vec2(textureSize(map, 0));\n    vec2 texelSize = 1.0 / size;\n\n    uv = uv * size - 0.5;\n    vec2 f = fract(uv);\n    uv = floor(uv) + 0.5;\n\n    vec4 s1 = texture(map, (uv + vec2(0, 0)) * texelSize);\n    vec4 s2 = texture(map, (uv + vec2(1, 0)) * texelSize);\n    vec4 s3 = texture(map, (uv + vec2(0, 1)) * texelSize);\n    vec4 s4 = texture(map, (uv + vec2(1, 1)) * texelSize);\n\n    return mix(mix(s1, s2, f.x), mix(s3, s4, f.x), f.y);\n  #endif\n}\n`;\n","export default `\n\nuniform sampler2D positionBuffer;\nuniform sampler2D normalBuffer;\nuniform sampler2D uvBuffer;\nuniform sampler2D bvhBuffer;\n\nstruct Triangle {\n  vec3 p0;\n  vec3 p1;\n  vec3 p2;\n};\n\nvoid surfaceInteractionFromBVH(inout SurfaceInteraction si, Triangle tri, vec3 barycentric, ivec3 index, vec3 faceNormal, int materialIndex) {\n  si.hit = true;\n  si.faceNormal = faceNormal;\n  si.position = barycentric.x * tri.p0 + barycentric.y * tri.p1 + barycentric.z * tri.p2;\n  ivec2 i0 = unpackTexel(index.x, VERTEX_COLUMNS);\n  ivec2 i1 = unpackTexel(index.y, VERTEX_COLUMNS);\n  ivec2 i2 = unpackTexel(index.z, VERTEX_COLUMNS);\n\n  vec3 n0 = texelFetch(normalBuffer, i0, 0).xyz;\n  vec3 n1 = texelFetch(normalBuffer, i1, 0).xyz;\n  vec3 n2 = texelFetch(normalBuffer, i2, 0).xyz;\n  vec3 normal = normalize(barycentric.x * n0 + barycentric.y * n1 + barycentric.z * n2);\n\n  #if defined(NUM_DIFFUSE_MAPS) || defined(NUM_NORMAL_MAPS) || defined(NUM_PBR_MAPS)\n    vec2 uv0 = texelFetch(uvBuffer, i0, 0).xy;\n    vec2 uv1 = texelFetch(uvBuffer, i1, 0).xy;\n    vec2 uv2 = texelFetch(uvBuffer, i2, 0).xy;\n    vec2 uv = fract(barycentric.x * uv0 + barycentric.y * uv1 + barycentric.z * uv2);\n  #else\n    vec2 uv = vec2(0.0);\n  #endif\n\n  si.materialType = int(getMatType(materialIndex));\n  si.color = getMatColor(materialIndex, uv);\n  si.roughness = getMatRoughness(materialIndex, uv);\n  si.metalness = getMatMetalness(materialIndex, uv);\n\n  #ifdef NUM_NORMAL_MAPS\n    vec3 dp1 = tri.p0 - tri.p2;\n    vec3 dp2 = tri.p1 - tri.p2;\n    vec2 duv1 = uv0 - uv2;\n    vec2 duv2 = uv1 - uv2;\n    si.normal = getMatNormal(materialIndex, uv, normal, dp1, dp2, duv1, duv2);\n  #else\n    si.normal = normal;\n  #endif\n}\n\nstruct TriangleIntersect {\n  float t;\n  vec3 barycentric;\n};\n\n// Triangle-ray intersection\n// Faster than the classic MllerTrumbore intersection algorithm\n// http://www.pbr-book.org/3ed-2018/Shapes/Triangle_Meshes.html#TriangleIntersection\nTriangleIntersect intersectTriangle(Ray r, Triangle tri, int maxDim, vec3 shear) {\n  TriangleIntersect ti;\n  vec3 d = r.d;\n\n  // translate vertices based on ray origin\n  vec3 p0t = tri.p0 - r.o;\n  vec3 p1t = tri.p1 - r.o;\n  vec3 p2t = tri.p2 - r.o;\n\n  // permute components of triangle vertices\n  if (maxDim == 0) {\n    p0t = p0t.yzx;\n    p1t = p1t.yzx;\n    p2t = p2t.yzx;\n  } else if (maxDim == 1) {\n    p0t = p0t.zxy;\n    p1t = p1t.zxy;\n    p2t = p2t.zxy;\n  }\n\n  // apply shear transformation to translated vertex positions\n  p0t.xy += shear.xy * p0t.z;\n  p1t.xy += shear.xy * p1t.z;\n  p2t.xy += shear.xy * p2t.z;\n\n  // compute edge function coefficients\n  vec3 e = vec3(\n    p1t.x * p2t.y - p1t.y * p2t.x,\n    p2t.x * p0t.y - p2t.y * p0t.x,\n    p0t.x * p1t.y - p0t.y * p1t.x\n  );\n\n  // check if intersection is inside triangle\n  if (any(lessThan(e, vec3(0))) && any(greaterThan(e, vec3(0)))) {\n    return ti;\n  }\n\n  float det = e.x + e.y + e.z;\n\n  // not needed?\n  // if (det == 0.) {\n  //   return ti;\n  // }\n\n  p0t.z *= shear.z;\n  p1t.z *= shear.z;\n  p2t.z *= shear.z;\n  float tScaled = (e.x * p0t.z + e.y * p1t.z + e.z * p2t.z);\n\n  // not needed?\n  // if (sign(det) != sign(tScaled)) {\n  //   return ti;\n  // }\n\n  // check if closer intersection already exists\n  if (abs(tScaled) > abs(r.tMax * det)) {\n    return ti;\n  }\n\n  float invDet = 1. / det;\n  ti.t = tScaled * invDet;\n  ti.barycentric = e * invDet;\n\n  return ti;\n}\n\nstruct Box {\n  vec3 min;\n  vec3 max;\n};\n\n// Branchless ray/box intersection\n// https://tavianator.com/fast-branchless-raybounding-box-intersections/\nfloat intersectBox(Ray r, Box b) {\n  vec3 tBot = (b.min - r.o) * r.invD;\n  vec3 tTop = (b.max - r.o) * r.invD;\n  vec3 tNear = min(tBot, tTop);\n  vec3 tFar = max(tBot, tTop);\n  float t0 = max(tNear.x, max(tNear.y, tNear.z));\n  float t1 = min(tFar.x, min(tFar.y, tFar.z));\n\n  return (t0 > t1 || t0 > r.tMax) ? -1.0 : (t0 > 0.0 ? t0 : t1);\n}\n\nint maxDimension(vec3 v) {\n  return v.x > v.y ? (v.x > v.z ? 0 : 2) : (v.y > v.z ? 1 : 2);\n}\n\n// Traverse BVH, find closest triangle intersection, and return surface information\nvoid intersectScene(inout Ray ray, inout SurfaceInteraction si) {\n  si.hit = false;\n\n  int maxDim = maxDimension(abs(ray.d));\n\n  // Permute space so that the z dimension is the one where the absolute value of the ray's direction is largest.\n  // Then create a shear transformation that aligns ray direction with the +z axis\n  vec3 shear;\n  if (maxDim == 0) {\n    shear = vec3(-ray.d.y, -ray.d.z, 1.0) * ray.invD.x;\n  } else if (maxDim == 1) {\n    shear = vec3(-ray.d.z, -ray.d.x, 1.0) * ray.invD.y;\n  } else {\n    shear = vec3(-ray.d.x, -ray.d.y, 1.0) * ray.invD.z;\n  }\n\n  int nodesToVisit[STACK_SIZE];\n  int stack = 0;\n\n  nodesToVisit[0] = 0;\n\n  while(stack >= 0) {\n    int i = nodesToVisit[stack--];\n\n    vec4 r1 = fetchData(bvhBuffer, i, BVH_COLUMNS);\n    vec4 r2 = fetchData(bvhBuffer, i + 1, BVH_COLUMNS);\n\n    int splitAxisOrNumPrimitives = floatBitsToInt(r1.w);\n\n    if (splitAxisOrNumPrimitives >= 0) {\n      // Intersection is a bounding box. Test for box intersection and keep traversing BVH\n      int splitAxis = splitAxisOrNumPrimitives;\n\n      Box bbox = Box(r1.xyz, r2.xyz);\n\n      if (intersectBox(ray, bbox) > 0.0) {\n        // traverse near node to ray first, and far node to ray last\n        if (ray.d[splitAxis] > 0.0) {\n          nodesToVisit[++stack] = floatBitsToInt(r2.w);\n          nodesToVisit[++stack] = i + 2;\n        } else {\n          nodesToVisit[++stack] = i + 2;\n          nodesToVisit[++stack] = floatBitsToInt(r2.w);\n        }\n      }\n    } else {\n      ivec3 index = floatBitsToInt(r1.xyz);\n      Triangle tri = Triangle(\n        fetchData(positionBuffer, index.x, VERTEX_COLUMNS).xyz,\n        fetchData(positionBuffer, index.y, VERTEX_COLUMNS).xyz,\n        fetchData(positionBuffer, index.z, VERTEX_COLUMNS).xyz\n      );\n      TriangleIntersect hit = intersectTriangle(ray, tri, maxDim, shear);\n\n      if (hit.t > 0.0) {\n        ray.tMax = hit.t;\n        int materialIndex = floatBitsToInt(r2.w);\n        vec3 faceNormal = r2.xyz;\n        surfaceInteractionFromBVH(si, tri, hit.barycentric, index, faceNormal, materialIndex);\n      }\n    }\n  }\n\n  // Values must be clamped outside of intersection loop. Clamping inside the loop produces incorrect numbers on some devices.\n  si.roughness = clamp(si.roughness, ROUGHNESS_MIN, 1.0);\n  si.metalness = clamp(si.metalness, 0.0, 1.0);\n}\n\nbool intersectSceneShadow(inout Ray ray) {\n  int maxDim = maxDimension(abs(ray.d));\n\n  // Permute space so that the z dimension is the one where the absolute value of the ray's direction is largest.\n  // Then create a shear transformation that aligns ray direction with the +z axis\n  vec3 shear;\n  if (maxDim == 0) {\n    shear = vec3(-ray.d.y, -ray.d.z, 1.0) * ray.invD.x;\n  } else if (maxDim == 1) {\n    shear = vec3(-ray.d.z, -ray.d.x, 1.0) * ray.invD.y;\n  } else {\n    shear = vec3(-ray.d.x, -ray.d.y, 1.0) * ray.invD.z;\n  }\n\n  int nodesToVisit[STACK_SIZE];\n  int stack = 0;\n\n  nodesToVisit[0] = 0;\n\n  while(stack >= 0) {\n    int i = nodesToVisit[stack--];\n\n    vec4 r1 = fetchData(bvhBuffer, i, BVH_COLUMNS);\n    vec4 r2 = fetchData(bvhBuffer, i + 1, BVH_COLUMNS);\n\n    int splitAxisOrNumPrimitives = floatBitsToInt(r1.w);\n\n    if (splitAxisOrNumPrimitives >= 0) {\n      int splitAxis = splitAxisOrNumPrimitives;\n\n      Box bbox = Box(r1.xyz, r2.xyz);\n\n      if (intersectBox(ray, bbox) > 0.0) {\n        if (ray.d[splitAxis] > 0.0) {\n          nodesToVisit[++stack] = floatBitsToInt(r2.w);\n          nodesToVisit[++stack] = i + 2;\n        } else {\n          nodesToVisit[++stack] = i + 2;\n          nodesToVisit[++stack] = floatBitsToInt(r2.w);\n        }\n      }\n    } else {\n      ivec3 index = floatBitsToInt(r1.xyz);\n      Triangle tri = Triangle(\n        fetchData(positionBuffer, index.x, VERTEX_COLUMNS).xyz,\n        fetchData(positionBuffer, index.y, VERTEX_COLUMNS).xyz,\n        fetchData(positionBuffer, index.z, VERTEX_COLUMNS).xyz\n      );\n\n      if (intersectTriangle(ray, tri, maxDim, shear).t > 0.0) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n}\n\n`;\n","export default `\n\n  uniform sampler2D gPosition;\n  uniform sampler2D gNormal;\n  uniform sampler2D gFaceNormal;\n  uniform sampler2D gColor;\n  uniform sampler2D gMatProps;\n\n  void surfaceInteractionDirect(vec2 coord, inout SurfaceInteraction si) {\n    vec4 positionAndMeshIndex = texture(gPosition, coord);\n\n    si.position = positionAndMeshIndex.xyz;\n\n    float meshIndex = positionAndMeshIndex.w;\n\n    vec4 normalMaterialType = texture(gNormal, coord);\n\n    si.normal = normalize(normalMaterialType.xyz);\n    si.materialType = int(normalMaterialType.w);\n\n    si.faceNormal = normalize(texture(gFaceNormal, coord).xyz);\n\n    si.color = texture(gColor, coord).rgb;\n\n    vec4 matProps = texture(gMatProps, coord);\n    si.roughness = matProps.x;\n    si.metalness = matProps.y;\n\n    si.hit = meshIndex > 0.0 ? true : false;\n  }\n`;\n","export default `\n\n// Noise texture used to generate a different random number for each pixel.\n// We use blue noise in particular, but any type of noise will work.\nuniform sampler2D noiseTex;\n\nuniform float stratifiedSamples[SAMPLING_DIMENSIONS];\nuniform float strataSize;\n\n// Every time we call randomSample() in the shader, and for every call to render,\n// we want that specific bit of the shader to fetch a sample from the same position in stratifiedSamples\n// This allows us to use stratified sampling for each random variable in our path tracing\nint sampleIndex = 0;\n\nfloat pixelSeed;\n\nvoid initRandom() {\n  vec2 noiseSize = vec2(textureSize(noiseTex, 0));\n\n  // tile the small noise texture across the entire screen\n  pixelSeed = texture(noiseTex, vCoord / (pixelSize * noiseSize)).r;\n}\n\nfloat randomSample() {\n  float stratifiedSample = stratifiedSamples[sampleIndex++];\n\n  float random = fract((stratifiedSample + pixelSeed) * strataSize); // blue noise + stratified samples\n\n  // transform random number between [0, 1] to (0, 1)\n  return EPS + (1.0 - 2.0 * EPS) * random;\n}\n\nvec2 randomSampleVec2() {\n  return vec2(randomSample(), randomSample());\n}\n\nstruct MaterialSamples {\n  vec2 s1;\n  vec2 s2;\n  vec2 s3;\n};\n\nMaterialSamples getRandomMaterialSamples() {\n  MaterialSamples samples;\n\n  samples.s1 = randomSampleVec2();\n  samples.s2 = randomSampleVec2();\n  samples.s3 = randomSampleVec2();\n\n  return samples;\n}\n`;\n","// Sample the environment map using a cumulative distribution function as described in\n// http://www.pbr-book.org/3ed-2018/Light_Transport_I_Surface_Reflection/Sampling_Light_Sources.html#InfiniteAreaLights\n\nexport default `\n\nuniform sampler2D envMap;\nuniform sampler2D envMapDistribution;\nuniform sampler2D backgroundMap;\n\nvec2 cartesianToEquirect(vec3 pointOnSphere) {\n  float phi = mod(atan(-pointOnSphere.z, -pointOnSphere.x), TWOPI);\n  float theta = acos(pointOnSphere.y);\n  return vec2(phi * 0.5 * INVPI, theta * INVPI);\n}\n\nfloat getEnvmapV(float u, out int vOffset, out float pdf) {\n  ivec2 size = textureSize(envMap, 0);\n\n  int left = 0;\n  int right = size.y + 1; // cdf length is the length of the env map + 1\n  while (left < right) {\n    int mid = (left + right) >> 1;\n    float s = texelFetch(envMapDistribution, ivec2(0, mid), 0).x;\n    if (s <= u) {\n      left = mid + 1;\n    } else {\n      right = mid;\n    }\n  }\n  vOffset = left - 1;\n\n  // x channel is cumulative distribution of env map luminance\n  // y channel is partial probability density of env map luminance\n  vec2 s0 = texelFetch(envMapDistribution, ivec2(0, vOffset), 0).xy;\n  vec2 s1 = texelFetch(envMapDistribution, ivec2(0, vOffset + 1), 0).xy;\n\n  pdf = s0.y;\n\n  return (float(vOffset) +  (u - s0.x) / (s1.x - s0.x)) / float(size.y);\n}\n\nfloat getEnvmapU(float u, int vOffset, out float pdf) {\n  ivec2 size = textureSize(envMap, 0);\n\n  int left = 0;\n  int right = size.x + 1; // cdf length is the length of the env map + 1\n  while (left < right) {\n    int mid = (left + right) >> 1;\n    float s = texelFetch(envMapDistribution, ivec2(1 + mid, vOffset), 0).x;\n    if (s <= u) {\n      left = mid + 1;\n    } else {\n      right = mid;\n    }\n  }\n  int uOffset = left - 1;\n\n  // x channel is cumulative distribution of env map luminance\n  // y channel is partial probability density of env map luminance\n  vec2 s0 = texelFetch(envMapDistribution, ivec2(1 + uOffset, vOffset), 0).xy;\n  vec2 s1 = texelFetch(envMapDistribution, ivec2(1 + uOffset + 1, vOffset), 0).xy;\n\n  pdf = s0.y;\n\n  return (float(uOffset) + (u - s0.x) / (s1.x - s0.x)) / float(size.x);\n}\n\n// Perform two binary searches to find light direction.\nvec3 sampleEnvmap(vec2 random, out vec2 uv, out float pdf) {\n  vec2 partialPdf;\n  int vOffset;\n\n  uv.y = getEnvmapV(random.x, vOffset, partialPdf.y);\n  uv.x = getEnvmapU(random.y, vOffset, partialPdf.x);\n\n  float phi = uv.x * TWOPI;\n  float theta = uv.y * PI;\n  float cosTheta = cos(theta);\n  float sinTheta = sin(theta);\n  float cosPhi = cos(phi);\n  float sinPhi = sin(phi);\n\n  vec3 dir = vec3(-sinTheta * cosPhi, cosTheta, -sinTheta * sinPhi);\n\n  pdf = partialPdf.x * partialPdf.y * INVPI2 / (2.0 * sinTheta);\n\n  return dir;\n}\n\nfloat envMapPdf(vec2 uv) {\n  vec2 size = vec2(textureSize(envMap, 0));\n\n  float sinTheta = sin(uv.y * PI);\n\n  uv *= size;\n\n  float partialX = texelFetch(envMapDistribution, ivec2(1.0 + uv.x, uv.y), 0).y;\n  float partialY = texelFetch(envMapDistribution, ivec2(0, uv.y), 0).y;\n\n  return partialX * partialY * INVPI2 / (2.0 * sinTheta);\n}\n\nvec3 sampleEnvmapFromDirection(vec3 d) {\n  vec2 uv = cartesianToEquirect(d);\n  return textureLinear(envMap, uv).rgb;\n}\n\nvec3 sampleBackgroundFromDirection(vec3 d) {\n  vec2 uv = cartesianToEquirect(d);\n  return textureLinear(backgroundMap, uv).rgb;\n}\n\n`;\n","export default `\n\n// Computes the exact value of the Fresnel factor\n// https://seblagarde.wordpress.com/2013/04/29/memo-on-fresnel-equations/\nfloat fresnel(float cosTheta, float eta, float invEta) {\n  eta = cosTheta > 0.0 ? eta : invEta;\n  cosTheta = abs(cosTheta);\n\n  float gSquared = eta * eta + cosTheta * cosTheta - 1.0;\n\n  if (gSquared < 0.0) {\n    return 1.0;\n  }\n\n  float g = sqrt(gSquared);\n\n  float a = (g - cosTheta) / (g + cosTheta);\n  float b = (cosTheta * (g + cosTheta) - 1.0) / (cosTheta * (g - cosTheta) + 1.0);\n\n  return 0.5 * a * a * (1.0 + b * b);\n}\n\nfloat fresnelSchlickWeight(float cosTheta) {\n  float w = 1.0 - cosTheta;\n  return (w * w) * (w * w) * w;\n}\n\n// Computes Schlick's approximation of the Fresnel factor\n// Assumes ray is moving from a less dense to a more dense medium\nfloat fresnelSchlick(float cosTheta, float r0) {\n  return mix(fresnelSchlickWeight(cosTheta), 1.0, r0);\n}\n\n// Computes Schlick's approximation of Fresnel factor\n// Accounts for total internal reflection if ray is moving from a more dense to a less dense medium\nfloat fresnelSchlickTIR(float cosTheta, float r0, float ni) {\n\n  // moving from a more dense to a less dense medium\n  if (cosTheta < 0.0) {\n    float inv_eta = ni;\n    float SinT2 = inv_eta * inv_eta * (1.0f - cosTheta * cosTheta);\n    if (SinT2 > 1.0) {\n        return 1.0; // total internal reflection\n    }\n    cosTheta = sqrt(1.0f - SinT2);\n  }\n\n  return mix(fresnelSchlickWeight(cosTheta), 1.0, r0);\n}\n\nfloat trowbridgeReitzD(float cosTheta, float alpha2) {\n  float e = cosTheta * cosTheta * (alpha2 - 1.0) + 1.0;\n  return alpha2 / (PI * e * e);\n}\n\nfloat trowbridgeReitzLambda(float cosTheta, float alpha2) {\n  float cos2Theta = cosTheta * cosTheta;\n  float tan2Theta = (1.0 - cos2Theta) / cos2Theta;\n  return 0.5 * (-1.0 + sqrt(1.0 + alpha2 * tan2Theta));\n}\n\n// An implementation of Disney's principled BRDF\n// https://disney-animation.s3.amazonaws.com/library/s2012_pbs_disney_brdf_notes_v2.pdf\nvec3 materialBrdf(SurfaceInteraction si, vec3 viewDir, vec3 lightDir, float cosThetaL, float diffuseWeight, out float pdf) {\n  vec3 halfVector = normalize(viewDir + lightDir);\n\n  cosThetaL = abs(cosThetaL);\n  float cosThetaV = abs(dot(si.normal, viewDir));\n  float cosThetaH = abs(dot(si.normal, halfVector));\n  float cosThetaD = abs(dot(lightDir, halfVector));\n\n  float alpha2 = (si.roughness * si.roughness) * (si.roughness * si.roughness);\n\n  float F = fresnelSchlick(cosThetaD, mix(R0, 0.6, si.metalness));\n  float D = trowbridgeReitzD(cosThetaH, alpha2);\n\n  float roughnessRemapped = 0.5 + 0.5 * si.roughness;\n  float alpha2Remapped = (roughnessRemapped * roughnessRemapped) * (roughnessRemapped * roughnessRemapped);\n\n  float G = 1.0 / (1.0 + trowbridgeReitzLambda(cosThetaV, alpha2Remapped) + trowbridgeReitzLambda(cosThetaL, alpha2Remapped));\n\n  float specular = F * D * G / (4.0 * cosThetaV * cosThetaL);\n  float specularPdf = D * cosThetaH / (4.0 * cosThetaD);\n\n  float f = -0.5 + 2.0 * cosThetaD * cosThetaD * si.roughness;\n  float diffuse = diffuseWeight * INVPI * (1.0 + f * fresnelSchlickWeight(cosThetaL)) * (1.0 + f * fresnelSchlickWeight(cosThetaV));\n  float diffusePdf = cosThetaL * INVPI;\n\n  pdf = mix(0.5 * (specularPdf + diffusePdf), specularPdf, si.metalness);\n\n  return mix(si.color * diffuse + specular, si.color * specular, si.metalness);\n}\n\n`;\n","export default `\n\n// https://graphics.pixar.com/library/OrthonormalB/paper.pdf\nmat3 orthonormalBasis(vec3 n) {\n  float zsign = n.z >= 0.0 ? 1.0 : -1.0;\n  float a = -1.0 / (zsign + n.z);\n  float b = n.x * n.y * a;\n  vec3 s = vec3(1.0 + zsign * n.x * n.x * a, zsign * b, -zsign * n.x);\n  vec3 t = vec3(b, zsign + n.y * n.y * a, -n.y);\n  return mat3(s, t, n);\n}\n\n// http://www.pbr-book.org/3ed-2018/Monte_Carlo_Integration/2D_Sampling_with_Multidimensional_Transformations.html#SamplingaUnitDisk\nvec2 sampleCircle(vec2 p) {\n  p = 2.0 * p - 1.0;\n\n  bool greater = abs(p.x) > abs(p.y);\n\n  float r = greater ? p.x : p.y;\n  float theta = greater ? 0.25 * PI * p.y / p.x : PI * (0.5 - 0.25 * p.x / p.y);\n\n  return r * vec2(cos(theta), sin(theta));\n}\n\n// http://www.pbr-book.org/3ed-2018/Monte_Carlo_Integration/2D_Sampling_with_Multidimensional_Transformations.html#Cosine-WeightedHemisphereSampling\nvec3 cosineSampleHemisphere(vec2 p) {\n  vec2 h = sampleCircle(p);\n  float z = sqrt(max(0.0, 1.0 - h.x * h.x - h.y * h.y));\n  return vec3(h, z);\n}\n\n\n// http://www.pbr-book.org/3ed-2018/Light_Transport_I_Surface_Reflection/Sampling_Reflection_Functions.html#MicrofacetBxDFs\n// Instead of Beckmann distrubtion, we use the GTR2 (GGX) distrubtion as covered in Disney's Principled BRDF paper\nvec3 lightDirSpecular(vec3 faceNormal, vec3 viewDir, mat3 basis, float roughness, vec2 random) {\n  float phi = TWOPI * random.y;\n  float alpha = roughness * roughness;\n  float cosTheta = sqrt((1.0 - random.x) / (1.0 + (alpha * alpha - 1.0) * random.x));\n  float sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\n  vec3 halfVector = basis * sign(dot(faceNormal, viewDir)) * vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\n\n  vec3 lightDir = reflect(-viewDir, halfVector);\n\n  return lightDir;\n}\n\nvec3 lightDirDiffuse(vec3 faceNormal, vec3 viewDir, mat3 basis, vec2 random) {\n  return basis * sign(dot(faceNormal, viewDir)) * cosineSampleHemisphere(random);\n}\n\nfloat powerHeuristic(float f, float g) {\n  return (f * f) / (f * f + g * g);\n}\n\n`;\n","// Estimate the direct lighting integral using multiple importance sampling\n// http://www.pbr-book.org/3ed-2018/Light_Transport_I_Surface_Reflection/Direct_Lighting.html#EstimatingtheDirectLightingIntegral\n\nexport default `\n\nvoid sampleMaterial(SurfaceInteraction si, int bounce, inout Path path) {\n  bool lastBounce = bounce == BOUNCES;\n  mat3 basis = orthonormalBasis(si.normal);\n  vec3 viewDir = -path.ray.d;\n\n  MaterialSamples samples = getRandomMaterialSamples();\n\n  vec2 diffuseOrSpecular = samples.s1;\n  vec2 lightDirSample = samples.s2;\n  vec2 bounceDirSample = samples.s3;\n\n  // Step 1: Add direct illumination of the light source (the hdr map)\n  // On every bounce but the last, importance sample the light source\n  // On the last bounce, multiple importance sample the brdf AND the light source, determined by random var\n\n  vec3 lightDir;\n  vec2 uv;\n  float lightPdf;\n  bool brdfSample = false;\n\n  if (lastBounce && diffuseOrSpecular.x < 0.5) {\n    // reuse this sample by multiplying by 2 to bring sample from [0, 0.5), to [0, 1)\n    lightDir = 2.0 * diffuseOrSpecular.x < mix(0.5, 0.0, si.metalness) ?\n      lightDirDiffuse(si.faceNormal, viewDir, basis, lightDirSample) :\n      lightDirSpecular(si.faceNormal, viewDir, basis, si.roughness, lightDirSample);\n\n    uv = cartesianToEquirect(lightDir);\n    lightPdf = envMapPdf(uv);\n    brdfSample = true;\n  } else {\n    lightDir = sampleEnvmap(lightDirSample, uv, lightPdf);\n  }\n\n  float cosThetaL = dot(si.normal, lightDir);\n\n  float occluded = 1.0;\n\n  float orientation = dot(si.faceNormal, viewDir) * cosThetaL;\n  if (orientation < 0.0) {\n    // light dir points towards surface. invalid dir.\n    occluded = 0.0;\n  }\n\n  float diffuseWeight = 1.0;\n\n  initRay(path.ray, si.position + EPS * lightDir, lightDir);\n  if (intersectSceneShadow(path.ray)) {\n    if (lastBounce) {\n      diffuseWeight = 0.0;\n    } else {\n      occluded = 0.0;\n    }\n  }\n\n  vec3 irr = textureLinear(envMap, uv).rgb;\n\n  float scatteringPdf;\n  vec3 brdf = materialBrdf(si, viewDir, lightDir, cosThetaL, diffuseWeight, scatteringPdf);\n\n  float weight;\n  if (lastBounce) {\n    weight = brdfSample ?\n      2.0 * powerHeuristic(scatteringPdf, lightPdf) / scatteringPdf :\n      2.0 * powerHeuristic(lightPdf, scatteringPdf) / lightPdf;\n  } else {\n    weight = powerHeuristic(lightPdf, scatteringPdf) / lightPdf;\n  }\n\n  path.li += path.beta * occluded * brdf * irr * abs(cosThetaL) * weight;;\n\n  // Step 2: Setup ray direction for next bounce by importance sampling the BRDF\n\n  if (lastBounce) {\n    return;\n  }\n\n  lightDir = diffuseOrSpecular.y < mix(0.5, 0.0, si.metalness) ?\n    lightDirDiffuse(si.faceNormal, viewDir, basis, bounceDirSample) :\n    lightDirSpecular(si.faceNormal, viewDir, basis, si.roughness, bounceDirSample);\n\n  cosThetaL = dot(si.normal, lightDir);\n\n  orientation = dot(si.faceNormal, viewDir) * cosThetaL;\n  path.abort = orientation < 0.0;\n\n  if (path.abort) {\n    return;\n  }\n\n  brdf = materialBrdf(si, viewDir, lightDir, cosThetaL, 1.0, scatteringPdf);\n\n  uv = cartesianToEquirect(lightDir);\n  lightPdf = envMapPdf(uv);\n\n  path.misWeight = powerHeuristic(scatteringPdf, lightPdf);\n\n  path.beta *= abs(cosThetaL) * brdf / scatteringPdf;\n\n  path.specularBounce = false;\n\n  initRay(path.ray, si.position + EPS * lightDir, lightDir);\n}\n`;\n","export default `\n\n#ifdef USE_SHADOW_CATCHER\n\nvoid sampleShadowCatcher(SurfaceInteraction si, int bounce, inout Path path) {\n  bool lastBounce = bounce == BOUNCES;\n  mat3 basis = orthonormalBasis(si.normal);\n  vec3 viewDir = -path.ray.d;\n  vec3 color = bounce == 1  || path.specularBounce ? sampleBackgroundFromDirection(-viewDir) : sampleEnvmapFromDirection(-viewDir);\n\n  si.color = vec3(1, 1, 1);\n\n  MaterialSamples samples = getRandomMaterialSamples();\n\n  vec2 diffuseOrSpecular = samples.s1;\n  vec2 lightDirSample = samples.s2;\n  vec2 bounceDirSample = samples.s3;\n\n  vec3 lightDir;\n  vec2 uv;\n  float lightPdf;\n  bool brdfSample = false;\n\n  if (diffuseOrSpecular.x < 0.5) {\n    lightDir = 2.0 * diffuseOrSpecular.x < mix(0.5, 0.0, si.metalness) ?\n      lightDirDiffuse(si.faceNormal, viewDir, basis, lightDirSample) :\n      lightDirSpecular(si.faceNormal, viewDir, basis, si.roughness, lightDirSample);\n    uv = cartesianToEquirect(lightDir);\n    lightPdf = envMapPdf(uv);\n    brdfSample = true;\n  } else {\n    lightDir = sampleEnvmap(lightDirSample, uv, lightPdf);\n  }\n\n  float cosThetaL = dot(si.normal, lightDir);\n\n  float liContrib = 1.0;\n\n  float orientation = dot(si.faceNormal, viewDir) * cosThetaL;\n  if (orientation < 0.0) {\n    liContrib = 0.0;\n  }\n\n  float occluded = 1.0;\n  initRay(path.ray, si.position + EPS * lightDir, lightDir);\n  if (intersectSceneShadow(path.ray)) {\n    occluded = 0.0;\n  }\n\n  float irr = dot(luminance, textureLinear(envMap, uv).rgb);\n\n  float scatteringPdf;\n  vec3 brdf = materialBrdf(si, viewDir, lightDir, cosThetaL, 1.0, scatteringPdf);\n\n  float weight = brdfSample ?\n    2.0 * powerHeuristic(scatteringPdf, lightPdf) / scatteringPdf :\n    2.0 * powerHeuristic(lightPdf, scatteringPdf) / lightPdf;\n\n  float liEq = liContrib * brdf.r * irr * abs(cosThetaL) * weight;\n\n  float alpha = liEq;\n  path.alpha *= alpha;\n  path.li *= alpha;\n\n  path.li += occluded * path.beta * color * liEq;\n\n  if (lastBounce) {\n    return;\n  }\n\n  lightDir = diffuseOrSpecular.y < mix(0.5, 0.0, si.metalness) ?\n    lightDirDiffuse(si.faceNormal, viewDir, basis, bounceDirSample) :\n    lightDirSpecular(si.faceNormal, viewDir, basis, si.roughness, bounceDirSample);\n\n  cosThetaL = dot(si.normal, lightDir);\n\n  orientation = dot(si.faceNormal, viewDir) * cosThetaL;\n  path.abort = orientation < 0.0;\n\n  if (path.abort) {\n    return;\n  }\n\n  brdf = materialBrdf(si, viewDir, lightDir, cosThetaL, 1.0, scatteringPdf);\n\n  uv = cartesianToEquirect(lightDir);\n  lightPdf = envMapPdf(uv);\n\n  path.misWeight = 0.0;\n\n  path.beta = color * abs(cosThetaL) * brdf.r / scatteringPdf;\n\n  path.specularBounce = false;\n\n  initRay(path.ray, si.position + EPS * lightDir, lightDir);\n}\n\n#endif\n\n`;\n","export default `\n\n#ifdef USE_GLASS\n\nvoid sampleGlassSpecular(SurfaceInteraction si, int bounce, inout Path path) {\n  bool lastBounce = bounce == BOUNCES;\n  vec3 viewDir = -path.ray.d;\n  float cosTheta = dot(si.normal, viewDir);\n\n  MaterialSamples samples = getRandomMaterialSamples();\n\n  float reflectionOrRefraction = samples.s1.x;\n\n  float F = si.materialType == THIN_GLASS ?\n    fresnelSchlick(abs(cosTheta), R0) : // thin glass\n    fresnelSchlickTIR(cosTheta, R0, IOR); // thick glass\n\n  vec3 lightDir;\n\n  if (reflectionOrRefraction < F) {\n    lightDir = reflect(-viewDir, si.normal);\n  } else {\n    lightDir = si.materialType == THIN_GLASS ?\n      refract(-viewDir, sign(cosTheta) * si.normal, INV_IOR_THIN) : // thin glass\n      refract(-viewDir, sign(cosTheta) * si.normal, cosTheta < 0.0 ? IOR : INV_IOR); // thick glass\n    path.beta *= si.color;\n  }\n\n  path.misWeight = 1.0;\n\n  initRay(path.ray, si.position + EPS * lightDir, lightDir);\n\n  path.li += lastBounce ? path.beta * sampleBackgroundFromDirection(lightDir) : vec3(0.0);\n\n  path.specularBounce = true;\n}\n\n#endif\n\n`;\n","import { unrollLoop } from '../glslUtil';\nimport constants from './chunks/constants.glsl';\nimport rayTraceCore from './chunks/rayTraceCore.glsl';\nimport textureLinear from './chunks/textureLinear.glsl';\nimport materialBuffer from './chunks/materialBuffer.glsl';\nimport intersect from './chunks/intersect.glsl';\nimport surfaceInteractionDirect from './chunks/surfaceInteractionDirect.glsl';\nimport random from './chunks/random.glsl';\nimport envMap from './chunks/envMap.glsl';\nimport bsdf from './chunks/bsdf.glsl';\nimport sample from './chunks/sample.glsl';\nimport sampleMaterial from './chunks/sampleMaterial.glsl';\nimport sampleShadowCatcher from './chunks/sampleShadowCatcher.glsl';\nimport sampleGlass from './chunks/sampleGlassSpecular.glsl';\n\nexport default {\nincludes: [\n  constants,\n  rayTraceCore,\n  textureLinear,\n  materialBuffer,\n  intersect,\n  surfaceInteractionDirect,\n  random,\n  envMap,\n  bsdf,\n  sample,\n  sampleMaterial,\n  sampleGlass,\n  sampleShadowCatcher,\n],\noutputs: ['light'],\nsource: (defines) => `\n  void bounce(inout Path path, int i, inout SurfaceInteraction si) {\n\n    if (!si.hit) {\n      vec3 irr = path.specularBounce ? sampleBackgroundFromDirection(path.ray.d) : sampleEnvmapFromDirection(path.ray.d);\n\n      // hit a light source (the hdr map)\n      // add contribution from light source\n      // path.misWeight is the multiple importance sampled weight of this light source\n      path.li += path.misWeight * path.beta * irr;\n      path.abort = true;\n      return;\n    }\n\n    #ifdef USE_GLASS\n      if (si.materialType == THIN_GLASS || si.materialType == THICK_GLASS) {\n        sampleGlassSpecular(si, i, path);\n      }\n    #endif\n    #ifdef USE_SHADOW_CATCHER\n      if (si.materialType == SHADOW_CATCHER) {\n        sampleShadowCatcher(si, i, path);\n      }\n    #endif\n    if (si.materialType == STANDARD) {\n      sampleMaterial(si, i, path);\n    }\n\n    // Russian Roulette sampling\n    if (i >= 2) {\n      float q = 1.0 - dot(path.beta, luminance);\n      if (randomSample() < q) {\n        path.abort = true;\n      }\n      path.beta /= 1.0 - q;\n    }\n\n  }\n\n  // Path tracing integrator as described in\n  // http://www.pbr-book.org/3ed-2018/Light_Transport_I_Surface_Reflection/Path_Tracing.html#\n  vec4 integrator(inout Ray ray) {\n    Path path;\n    path.ray = ray;\n    path.li = vec3(0);\n    path.alpha = 1.0;\n    path.beta = vec3(1.0);\n    path.specularBounce = true;\n    path.abort = false;\n    path.misWeight = 1.0;\n\n    SurfaceInteraction si;\n\n    // first surface interaction from g-buffer\n    surfaceInteractionDirect(vCoord, si);\n\n    // first surface interaction from ray interesction\n    // intersectScene(path.ray, si);\n\n    bounce(path, 1, si);\n\n    // Manually unroll for loop.\n    // Some hardware fails to iterate over a GLSL loop, so we provide this workaround\n    // for (int i = 1; i < defines.bounces + 1, i += 1)\n    // equivelant to\n    ${unrollLoop('i', 2, defines.BOUNCES + 1, 1, `\n      if (path.abort) {\n        return vec4(path.li, path.alpha);\n      }\n      intersectScene(path.ray, si);\n      bounce(path, i, si);\n    `)}\n\n    return vec4(path.li, path.alpha);\n  }\n\n  void main() {\n    initRandom();\n\n    vec2 vCoordAntiAlias = vCoord + jitter;\n\n    vec3 direction = normalize(vec3(vCoordAntiAlias - 0.5, -1.0) * vec3(camera.aspect, 1.0, camera.fov));\n\n    // Thin lens model with depth-of-field\n    // http://www.pbr-book.org/3ed-2018/Camera_Models/Projective_Camera_Models.html#TheThinLensModelandDepthofField\n    // vec2 lensPoint = camera.aperture * sampleCircle(randomSampleVec2());\n    // vec3 focusPoint = -direction * camera.focus / direction.z; // intersect ray direction with focus plane\n\n    // vec3 origin = vec3(lensPoint, 0.0);\n    // direction = normalize(focusPoint - origin);\n\n    // origin = vec3(camera.transform * vec4(origin, 1.0));\n    // direction = mat3(camera.transform) * direction;\n\n    vec3 origin = camera.transform[3].xyz;\n    direction = mat3(camera.transform) * direction;\n\n    Ray cam;\n    initRay(cam, origin, direction);\n\n    vec4 liAndAlpha = integrator(cam);\n\n    if (!(liAndAlpha.x < INF && liAndAlpha.x > -EPS)) {\n      liAndAlpha = vec4(0, 0, 0, 1);\n    }\n\n    out_light = liAndAlpha;\n\n    // Stratified Sampling Sample Count Test\n    // ---------------\n    // Uncomment the following code\n    // Then observe the colors of the image\n    // If:\n    // * The resulting image is pure black\n    //   Extra samples are being passed to the shader that aren't being used.\n    // * The resulting image contains red\n    //   Not enough samples are being passed to the shader\n    // * The resulting image contains only white with some black\n    //   All samples are used by the shader. Correct result!\n\n    // out_light = vec4(0, 0, 0, 1);\n    // if (sampleIndex == SAMPLING_DIMENSIONS) {\n    //   out_light = vec4(1, 1, 1, 1);\n    // } else if (sampleIndex > SAMPLING_DIMENSIONS) {\n    //   out_light = vec4(1, 0, 0, 1);\n    // }\n}\n`\n}\n","/*\nStratified Sampling\nhttp://www.pbr-book.org/3ed-2018/Sampling_and_Reconstruction/Stratified_Sampling.html\n\nRepeatedly sampling random numbers between [0, 1) has the effect of producing numbers that are coincidentally clustered together,\ninstead of being evenly spaced across the domain.\nThis produces low quality results for the path tracer since clustered samples send too many rays in similar directions.\n\nWe can reduce the amount of clustering of random numbers by using stratified sampling.\nStratification divides the [0, 1) range into partitions, or stratum, of equal size.\nEach invocation of the stratified sampler draws one uniform random number from one stratum from a shuffled sequence of stratums.\nWhen every stratum has been sampled once, this sequence is shuffled again and the process repeats.\n\nThe returned sample ranges between [0, numberOfStratum).\nThe integer part ideintifies the stratum (the first stratum being 0).\nThe fractional part is the random number.\n\nTo obtain the stratified sample between [0, 1), divide the returned sample by the stratum count.\n*/\n\nimport { shuffle } from \"./util\";\n\nexport function makeStratifiedSampler(strataCount, dimensions) {\n  const strata = [];\n  const l = strataCount ** dimensions;\n  for (let i = 0; i < l; i++) {\n    strata[i] = i;\n  }\n\n  let index = strata.length;\n\n  const sample = [];\n\n  function restart() {\n    index = 0;\n  }\n\n  function next() {\n    if (index >= strata.length) {\n      shuffle(strata);\n      restart();\n    }\n    let stratum = strata[index++];\n\n    for (let i = 0; i < dimensions; i++) {\n      sample[i] = stratum % strataCount + Math.random();\n      stratum = Math.floor(stratum / strataCount);\n    }\n\n    return sample;\n  }\n\n  return {\n    next,\n    restart,\n    strataCount\n  };\n}\n","/*\nStratified Sampling\nhttp://www.pbr-book.org/3ed-2018/Sampling_and_Reconstruction/Stratified_Sampling.html\n\nIt is computationally unfeasible to compute stratified sampling for large dimensions (>2)\nInstead, we can compute stratified sampling for lower dimensional patterns that sum to the high dimension\ne.g. instead of sampling a 6D domain, we sample a 2D + 2D + 2D domain.\nThis reaps many benefits of stratification while still allowing for small strata sizes.\n*/\n\nimport { makeStratifiedSampler } from \"./StratifiedSampler\";\n\nexport function makeStratifiedSamplerCombined(strataCount, listOfDimensions) {\n  const strataObjs = [];\n\n  for (const dim of listOfDimensions) {\n    strataObjs.push(makeStratifiedSampler(strataCount, dim));\n  }\n\n  const combined = [];\n\n  function next() {\n    let i = 0;\n\n    for (const strata of strataObjs) {\n      const nums = strata.next();\n\n      for (const num of nums) {\n        combined[i++] = num;\n      }\n    }\n\n    return combined;\n  }\n\n  function restart() {\n    for (const strata of strataObjs) {\n      strata.restart();\n    }\n  }\n\n  return {\n    next,\n    restart,\n    strataCount\n  };\n}\n","import { bvhAccel, flattenBvh } from './bvhAccel';\nimport { generateEnvMapFromSceneComponents, generateBackgroundMapFromSceneBackground } from './envMapCreation';\nimport { envMapDistribution } from './envMapDistribution';\nimport fragment from './glsl/rayTrace.frag';\nimport { makeRenderPass } from './RenderPass';\nimport { makeStratifiedSamplerCombined } from './StratifiedSamplerCombined';\nimport { makeTexture } from './Texture';\nimport { clamp } from './util';\n\nexport function makeRayTracePass(gl, {\n    bounces, // number of global illumination bounces\n    decomposedScene,\n    fullscreenQuad,\n    materialBuffer,\n    mergedMesh,\n    optionalExtensions,\n  }) {\n\n  bounces = clamp(bounces, 1, 6);\n\n  const samplingDimensions = [];\n\n  for (let i = 1; i <= bounces; i++) {\n    // specular or diffuse reflection, light importance sampling, next path direction\n    samplingDimensions.push(2, 2, 2);\n    if (i >= 2) {\n      // russian roulette sampling\n      // this step is skipped on the first bounce\n      samplingDimensions.push(1);\n    }\n  }\n\n  let samples;\n\n  const renderPass = makeRenderPassFromScene({\n    bounces, decomposedScene, fullscreenQuad, gl, materialBuffer, mergedMesh, optionalExtensions, samplingDimensions,\n  });\n\n  function setSize(width, height) {\n    renderPass.setUniform('pixelSize', 1 / width, 1 / height);\n  }\n\n  // noiseImage is a 32-bit PNG image\n  function setNoise(noiseImage) {\n    renderPass.setTexture('noiseTex', makeTexture(gl, {\n      data: noiseImage,\n      wrapS: gl.REPEAT,\n      wrapT: gl.REPEAT,\n      storage: 'halfFloat',\n    }));\n  }\n\n  function setCamera(camera) {\n    renderPass.setUniform('camera.transform', camera.matrixWorld);\n    renderPass.setUniform('camera.aspect', camera.aspect);\n    renderPass.setUniform('camera.fov', 0.5 / Math.tan(0.5 * Math.PI * camera.fov / 180));\n  }\n\n  function setJitter(x, y) {\n    renderPass.setUniform('jitter', x, y);\n  }\n\n  function setGBuffers({ position, normal, faceNormal, color, matProps }) {\n    renderPass.setTexture('gPosition', position);\n    renderPass.setTexture('gNormal', normal);\n    renderPass.setTexture('gFaceNormal', faceNormal);\n    renderPass.setTexture('gColor', color);\n    renderPass.setTexture('gMatProps', matProps);\n  }\n\n  function nextSeed() {\n    renderPass.setUniform('stratifiedSamples[0]', samples.next());\n  }\n\n  function setStrataCount(strataCount) {\n    if (strataCount > 1 && strataCount !== samples.strataCount) {\n      // reinitailizing random has a performance cost. we can skip it if\n      // * strataCount is 1, since a strataCount of 1 works with any sized StratifiedRandomCombined\n      // * random already has the same strata count as desired\n      samples = makeStratifiedSamplerCombined(strataCount, samplingDimensions);\n    } else {\n      samples.restart();\n    }\n\n    renderPass.setUniform('strataSize', 1.0 / strataCount);\n    nextSeed();\n  }\n\n  function bindTextures() {\n    renderPass.bindTextures();\n  }\n\n  function draw() {\n    renderPass.useProgram(false);\n    fullscreenQuad.draw();\n  }\n\n  samples = makeStratifiedSamplerCombined(1, samplingDimensions);\n\n  return {\n    bindTextures,\n    draw,\n    nextSeed,\n    outputLocs: renderPass.outputLocs,\n    setCamera,\n    setJitter,\n    setGBuffers,\n    setNoise,\n    setSize,\n    setStrataCount,\n  };\n}\nfunction makeRenderPassFromScene({\n    bounces,\n    decomposedScene,\n    fullscreenQuad,\n    gl,\n    materialBuffer,\n    mergedMesh,\n    optionalExtensions,\n    samplingDimensions,\n  }) {\n  const { OES_texture_float_linear } = optionalExtensions;\n\n  const { background, directionalLights, ambientLights, environmentLights } = decomposedScene;\n\n  const { geometry, materials, materialIndices } = mergedMesh;\n\n  // create bounding volume hierarchy from a static scene\n  const bvh = bvhAccel(geometry, materialIndices);\n  const flattenedBvh = flattenBvh(bvh);\n  const numTris = geometry.indices.count / 3;\n\n  const renderPass = makeRenderPass(gl, {\n    defines: {\n      OES_texture_float_linear,\n      BVH_COLUMNS: textureDimensionsFromArray(flattenedBvh.count).columnsLog,\n      INDEX_COLUMNS: textureDimensionsFromArray(numTris).columnsLog,\n      VERTEX_COLUMNS: textureDimensionsFromArray(geometry.position.count).columnsLog,\n      STACK_SIZE: flattenedBvh.maxDepth,\n      BOUNCES: bounces,\n      USE_GLASS: materials.some(m => m.transparent),\n      USE_SHADOW_CATCHER: materials.some(m => m.shadowCatcher),\n      SAMPLING_DIMENSIONS: samplingDimensions.reduce((a, b) => a + b),\n      ...materialBuffer.defines\n    },\n    fragment,\n    vertex: fullscreenQuad.vertexShader\n  });\n\n  renderPass.setTexture('diffuseMap', materialBuffer.textures.diffuseMap);\n  renderPass.setTexture('normalMap', materialBuffer.textures.normalMap);\n  renderPass.setTexture('pbrMap', materialBuffer.textures.pbrMap);\n\n  renderPass.setTexture('positionBuffer', makeDataTexture(gl, geometry.position.array, 3));\n\n  renderPass.setTexture('normalBuffer', makeDataTexture(gl, geometry.normal.array, 3));\n\n  renderPass.setTexture('uvBuffer', makeDataTexture(gl, geometry.uv.array, 2));\n\n  renderPass.setTexture('bvhBuffer', makeDataTexture(gl, flattenedBvh.buffer, 4));\n\n  const envImage = generateEnvMapFromSceneComponents(directionalLights, ambientLights, environmentLights);\n  const envImageTextureObject = makeTexture(gl, {\n    data: envImage.data,\n    storage: 'halfFloat',\n    minFilter: OES_texture_float_linear ? gl.LINEAR : gl.NEAREST,\n    magFilter: OES_texture_float_linear ? gl.LINEAR : gl.NEAREST,\n    width: envImage.width,\n    height: envImage.height,\n  });\n\n  renderPass.setTexture('envMap', envImageTextureObject);\n\n  let backgroundImageTextureObject;\n  if (background) {\n    const backgroundImage = generateBackgroundMapFromSceneBackground(background);\n    backgroundImageTextureObject = makeTexture(gl, {\n      data: backgroundImage.data,\n      storage: 'halfFloat',\n      minFilter: OES_texture_float_linear ? gl.LINEAR : gl.NEAREST,\n      magFilter: OES_texture_float_linear ? gl.LINEAR : gl.NEAREST,\n      width: backgroundImage.width,\n      height: backgroundImage.height,\n    });\n  } else {\n    backgroundImageTextureObject = envImageTextureObject;\n  }\n\n  renderPass.setTexture('backgroundMap', backgroundImageTextureObject);\n\n  const distribution = envMapDistribution(envImage);\n\n  renderPass.setTexture('envMapDistribution', makeTexture(gl, {\n    data: distribution.data,\n    storage: 'halfFloat',\n    width: distribution.width,\n    height: distribution.height,\n  }));\n\n  return renderPass;\n}\n\nfunction textureDimensionsFromArray(count) {\n  const columnsLog = Math.round(Math.log2(Math.sqrt(count)));\n  const columns = 2 ** columnsLog;\n  const rows = Math.ceil(count / columns);\n  return {\n    columnsLog,\n    columns,\n    rows,\n    size: rows * columns,\n  };\n}\n\nfunction makeDataTexture(gl, dataArray, channels) {\n  const textureDim = textureDimensionsFromArray(dataArray.length / channels);\n  return makeTexture(gl, {\n    data: padArray(dataArray, channels * textureDim.size),\n    width: textureDim.columns,\n    height: textureDim.rows,\n  });\n}\n\n// expand array to the given length\nfunction padArray(typedArray, length) {\n  const newArray = new typedArray.constructor(length);\n  newArray.set(typedArray);\n  return newArray;\n}\n","import { clamp } from './util';\n\nexport function makeRenderSize(gl) {\n  const desiredMsPerFrame = 20;\n\n  let fullWidth;\n  let fullHeight;\n\n  let renderWidth;\n  let renderHeight;\n  let scale = { x: 1, y: 1};\n\n  let pixelsPerFrame = pixelsPerFrameEstimate(gl);\n\n  function setSize(w, h) {\n    fullWidth = w;\n    fullHeight = h;\n    calcDimensions();\n  }\n\n  function calcDimensions() {\n    const aspectRatio = fullWidth / fullHeight;\n    renderWidth = Math.round(clamp(Math.sqrt(pixelsPerFrame * aspectRatio), 1, fullWidth));\n    renderHeight = Math.round(clamp(renderWidth / aspectRatio, 1, fullHeight));\n    scale.x = renderWidth / fullWidth\n    scale.y = renderHeight / fullHeight;\n  }\n\n  function adjustSize(elapsedFrameMs) {\n    if (!elapsedFrameMs) {\n      return;\n    }\n\n     // tweak to find balance. higher = faster convergence, lower = less fluctuations to microstutters\n    const strength = 600;\n\n    const error = desiredMsPerFrame - elapsedFrameMs;\n\n    pixelsPerFrame += strength * error;\n    pixelsPerFrame = clamp(pixelsPerFrame, 8192, fullWidth * fullHeight);\n    calcDimensions();\n  }\n\n  return {\n    adjustSize,\n    setSize,\n    scale,\n    get width() {\n      return renderWidth;\n    },\n    get height() {\n      return renderHeight;\n    }\n  };\n}\n\nfunction pixelsPerFrameEstimate(gl) {\n  const maxRenderbufferSize = gl.getParameter(gl.MAX_RENDERBUFFER_SIZE);\n\n  if (maxRenderbufferSize <= 8192) {\n    return 80000;\n  } else if (maxRenderbufferSize === 16384) {\n    return 150000;\n  } else if (maxRenderbufferSize >= 32768) {\n    return 400000;\n  }\n}\n","import textureLinear from './chunks/textureLinear.glsl';\n\nexport default {\noutputs: ['light'],\nincludes: [textureLinear],\nsource: `\n  in vec2 vCoord;\n\n  uniform mediump sampler2D lightTex;\n  uniform mediump sampler2D positionTex;\n  uniform vec2 lightScale;\n  uniform vec2 previousLightScale;\n\n  uniform mediump sampler2D previousLightTex;\n  uniform mediump sampler2D previousPositionTex;\n\n  uniform mat4 historyCamera;\n  uniform float blendAmount;\n  uniform vec2 jitter;\n\n  vec2 reproject(vec3 position) {\n    vec4 historyCoord = historyCamera * vec4(position, 1.0);\n    return 0.5 * historyCoord.xy / historyCoord.w + 0.5;\n  }\n\n  float getMeshId(sampler2D meshIdTex, vec2 vCoord) {\n    return floor(texture(meshIdTex, vCoord).w);\n  }\n\n  void main() {\n    vec3 currentPosition = textureLinear(positionTex, vCoord).xyz;\n    float currentMeshId = getMeshId(positionTex, vCoord);\n\n    vec4 currentLight = texture(lightTex, lightScale * vCoord);\n\n    if (currentMeshId == 0.0) {\n      out_light = currentLight;\n      return;\n    }\n\n    vec2 hCoord = reproject(currentPosition) - jitter;\n\n    vec2 hSizef = previousLightScale * vec2(textureSize(previousLightTex, 0));\n    vec2 hSizeInv = 1.0 / hSizef;\n    ivec2 hSize = ivec2(hSizef);\n\n    vec2 hTexelf = hCoord * hSizef - 0.5;\n    ivec2 hTexel = ivec2(hTexelf);\n    vec2 f = fract(hTexelf);\n\n    ivec2 texel[] = ivec2[](\n      hTexel + ivec2(0, 0),\n      hTexel + ivec2(1, 0),\n      hTexel + ivec2(0, 1),\n      hTexel + ivec2(1, 1)\n    );\n\n    float weights[] = float[](\n      (1.0 - f.x) * (1.0 - f.y),\n      f.x * (1.0 - f.y),\n      (1.0 - f.x) * f.y,\n      f.x * f.y\n    );\n\n    vec4 history;\n    float sum;\n\n    // bilinear sampling, rejecting samples that don't have a matching mesh id\n    for (int i = 0; i < 4; i++) {\n      vec2 gCoord = (vec2(texel[i]) + 0.5) * hSizeInv;\n\n      float histMeshId = getMeshId(previousPositionTex, gCoord);\n\n      float isValid = histMeshId != currentMeshId || any(greaterThanEqual(texel[i], hSize)) ? 0.0 : 1.0;\n\n      float weight = isValid * weights[i];\n      history += weight * texelFetch(previousLightTex, texel[i], 0);\n      sum += weight;\n    }\n\n    if (sum > 0.0) {\n      history /= sum;\n    } else {\n      // If all samples of bilinear fail, try a 3x3 box filter\n      hTexel = ivec2(hTexelf + 0.5);\n\n      for (int x = -1; x <= 1; x++) {\n        for (int y = -1; y <= 1; y++) {\n          ivec2 texel = hTexel + ivec2(x, y);\n          vec2 gCoord = (vec2(texel) + 0.5) * hSizeInv;\n\n          float histMeshId = getMeshId(previousPositionTex, gCoord);\n\n          float isValid = histMeshId != currentMeshId || any(greaterThanEqual(texel, hSize)) ? 0.0 : 1.0;\n\n          float weight = isValid;\n          vec4 h = texelFetch(previousLightTex, texel, 0);\n          history += weight * h;\n          sum += weight;\n        }\n      }\n      history = sum > 0.0 ? history / sum : history;\n    }\n\n    if (history.w > MAX_SAMPLES) {\n      history.xyz *= MAX_SAMPLES / history.w;\n      history.w = MAX_SAMPLES;\n    }\n\n    out_light = blendAmount * history + currentLight;\n  }\n`\n}\n","import fragment from './glsl/reproject.frag';\nimport { makeRenderPass } from './RenderPass';\nimport {mat4} from 'gl-matrix';\n\nexport function makeReprojectPass(gl, params) {\n  const {\n    fullscreenQuad,\n    maxReprojectedSamples,\n  } = params;\n\n  const renderPass = makeRenderPass(gl, {\n      defines: {\n        MAX_SAMPLES: maxReprojectedSamples.toFixed(1)\n      },\n      vertex: fullscreenQuad.vertexShader,\n      fragment\n    });\n\n  function setPreviousCamera(previousCamera) {\n    const matrix = mat4.mul([], previousCamera.projectionMatrix, previousCamera.matrixWorldInverse);\n    renderPass.setUniform('historyCamera', matrix);\n  }\n\n  function setJitter(x, y) {\n    renderPass.setUniform('jitter', x, y);\n  }\n\n  function draw(params) {\n    const {\n      blendAmount,\n      light,\n      lightScale,\n      position,\n      previousLight,\n      previousLightScale,\n      previousPosition,\n    } = params;\n\n    renderPass.setUniform('blendAmount', blendAmount);\n    renderPass.setUniform('lightScale', lightScale.x, lightScale.y);\n    renderPass.setUniform('previousLightScale', previousLightScale.x, previousLightScale.y);\n\n    renderPass.setTexture('lightTex', light);\n    renderPass.setTexture('positionTex', position);\n    renderPass.setTexture('previousLightTex', previousLight);\n    renderPass.setTexture('previousPositionTex', previousPosition);\n\n    renderPass.useProgram();\n    fullscreenQuad.draw();\n  }\n\n  return {\n    draw,\n    setJitter,\n    setPreviousCamera,\n  };\n}\n","import textureLinear from './chunks/textureLinear.glsl';\n\nexport default {\nincludes: [textureLinear],\noutputs: ['color'],\nsource: `\n  in vec2 vCoord;\n\n  uniform sampler2D lightTex;\n  uniform sampler2D positionTex;\n\n  uniform vec2 lightScale;\n\n  // Tonemapping functions from THREE.js\n\n  vec3 linear(vec3 color) {\n    return color;\n  }\n  // https://www.cs.utah.edu/~reinhard/cdrom/\n  vec3 reinhard(vec3 color) {\n    return clamp(color / (vec3(1.0) + color), vec3(0.0), vec3(1.0));\n  }\n  // http://filmicworlds.com/blog/filmic-tonemapping-operators/\n  #define uncharted2Helper(x) max(((x * (0.15 * x + 0.10 * 0.50) + 0.20 * 0.02) / (x * (0.15 * x + 0.50) + 0.20 * 0.30)) - 0.02 / 0.30, vec3(0.0))\n  const vec3 uncharted2WhitePoint = 1.0 / uncharted2Helper(vec3(WHITE_POINT));\n  vec3 uncharted2( vec3 color ) {\n    // John Hable's filmic operator from Uncharted 2 video game\n    return clamp(uncharted2Helper(color) * uncharted2WhitePoint, vec3(0.0), vec3(1.0));\n  }\n  // http://filmicworlds.com/blog/filmic-tonemapping-operators/\n  vec3 cineon( vec3 color ) {\n    // optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n    color = max(vec3( 0.0 ), color - 0.004);\n    return pow((color * (6.2 * color + 0.5)) / (color * (6.2 * color + 1.7) + 0.06), vec3(2.2));\n  }\n  // https://knarkowicz.wordpress.com/2016/01/06/aces-filmic-tone-mapping-curve/\n  vec3 acesFilmic( vec3 color ) {\n    return clamp((color * (2.51 * color + 0.03)) / (color * (2.43 * color + 0.59) + 0.14), vec3(0.0), vec3(1.0));\n  }\n\n  #ifdef EDGE_PRESERVING_UPSCALE\n\n  float getMeshId(sampler2D meshIdTex, vec2 vCoord) {\n    return floor(texture(meshIdTex, vCoord).w);\n  }\n\n  vec4 getUpscaledLight(vec2 coord) {\n    float meshId = getMeshId(positionTex, coord);\n\n    vec2 sizef = lightScale * vec2(textureSize(positionTex, 0));\n    vec2 texelf = coord * sizef - 0.5;\n    ivec2 texel = ivec2(texelf);\n    vec2 f = fract(texelf);\n\n    ivec2 texels[] = ivec2[](\n      texel + ivec2(0, 0),\n      texel + ivec2(1, 0),\n      texel + ivec2(0, 1),\n      texel + ivec2(1, 1)\n    );\n\n    float weights[] = float[](\n      (1.0 - f.x) * (1.0 - f.y),\n      f.x * (1.0 - f.y),\n      (1.0 - f.x) * f.y,\n      f.x * f.y\n    );\n\n    vec4 upscaledLight;\n    float sum;\n    for (int i = 0; i < 4; i++) {\n      vec2 pCoord = (vec2(texels[i]) + 0.5) / sizef;\n      float isValid = getMeshId(positionTex, pCoord) == meshId ? 1.0 : 0.0;\n      float weight = isValid * weights[i];\n      upscaledLight += weight * texelFetch(lightTex, texels[i], 0);\n      sum += weight;\n    }\n\n    if (sum > 0.0) {\n      upscaledLight /= sum;\n    } else {\n      upscaledLight = texture(lightTex, lightScale * coord);\n    }\n\n    return upscaledLight;\n  }\n  #endif\n\n  void main() {\n    #ifdef EDGE_PRESERVING_UPSCALE\n      vec4 upscaledLight = getUpscaledLight(vCoord);\n    #else\n      vec4 upscaledLight = texture(lightTex, lightScale * vCoord);\n    #endif\n\n    // alpha channel stores the number of samples progressively rendered\n    // divide the sum of light by alpha to obtain average contribution of light\n\n    // in addition, alpha contains a scale factor for the shadow catcher material\n    // dividing by alpha normalizes the brightness of the shadow catcher to match the background env map.\n    vec3 light = upscaledLight.rgb / upscaledLight.a;\n\n    light *= EXPOSURE;\n\n    light = TONE_MAPPING(light);\n\n    light = pow(light, vec3(1.0 / 2.2)); // gamma correction\n\n    out_color = vec4(light, 1.0);\n  }\n`\n}\n","import fragment from './glsl/toneMap.frag';\nimport { makeRenderPass } from './RenderPass';\nimport * as constants from '../constants';\n\nconst toneMapFunctions = {\n  [constants.LinearToneMapping]: 'linear',\n  [constants.ReinhardToneMapping]: 'reinhard',\n  [constants.Uncharted2ToneMapping]: 'uncharted2',\n  [constants.CineonToneMapping]: 'cineon',\n  [constants.ACESFilmicToneMapping]: 'acesFilmic'\n};\n\nexport function makeToneMapPass(gl, params) {\n  const {\n    fullscreenQuad,\n    toneMappingParams\n  } = params;\n\n  const renderPassConfig = {\n    gl,\n    defines: {\n      TONE_MAPPING: toneMapFunctions[toneMappingParams.toneMapping] || 'linear',\n      WHITE_POINT: toneMappingParams.whitePoint.toExponential(), // toExponential allows integers to be represented as GLSL floats\n      EXPOSURE: toneMappingParams.exposure.toExponential()\n    },\n    vertex: fullscreenQuad.vertexShader,\n    fragment,\n  };\n\n  renderPassConfig.defines.EDGE_PRESERVING_UPSCALE = true;\n  const renderPassUpscale = makeRenderPass(gl, renderPassConfig);\n\n  renderPassConfig.defines.EDGE_PRESERVING_UPSCALE = false;\n  const renderPassNative = makeRenderPass(gl, renderPassConfig);\n\n  function draw(params) {\n    const {\n      light,\n      lightScale,\n      position\n    } = params;\n\n    const renderPass =\n      lightScale.x !== 1 && lightScale.y !== 1 ?\n      renderPassUpscale :\n      renderPassNative;\n\n    renderPass.setUniform('lightScale', lightScale.x, lightScale.y);\n    renderPass.setTexture('lightTex', light);\n    renderPass.setTexture('positionTex', position);\n\n    renderPass.useProgram();\n    fullscreenQuad.draw();\n  }\n\n  return {\n    draw\n  };\n}\n","import { clamp } from './util';\n\n// TileRender is based on the concept of a compute shader's work group.\n\n// Sampling the scene with the RayTracingRenderer can be very slow (<1 fps).\n// This overworks the GPU and tends to lock up the OS, making it unresponsive.\n\n// To fix this, we can split the screen into smaller tiles, and sample the scene one tile at a time\n// The tile size is set such that each tile takes approximatly a constant amount of time to render.\n\n// Since the render time of a tile is dependent on the device, we find the desired tile dimensions by measuring\n// the time it takes to render an arbitrarily-set tile size and adjusting the size according to the benchmark.\n\nexport function makeTileRender(gl) {\n  const desiredMsPerTile = 21;\n\n  let currentTile = -1;\n  let numTiles = 1;\n\n  let tileWidth;\n  let tileHeight;\n\n  let columns;\n  let rows;\n\n  let width = 0;\n  let height = 0;\n\n  let totalElapsedMs;\n\n  // initial number of pixels per rendered tile\n  // based on correlation between system performance and max supported render buffer size\n  // adjusted dynamically according to system performance\n  let pixelsPerTile = pixelsPerTileEstimate(gl);\n\n  function reset() {\n    currentTile = -1;\n    totalElapsedMs = NaN;\n  }\n\n  function setSize(w, h) {\n    width = w;\n    height = h;\n    reset();\n    calcTileDimensions();\n  }\n\n  function calcTileDimensions() {\n    const aspectRatio = width / height;\n\n    // quantize the width of the tile so that it evenly divides the entire window\n    tileWidth = Math.ceil(width / Math.round(width / Math.sqrt(pixelsPerTile * aspectRatio)));\n    tileHeight = Math.ceil(tileWidth / aspectRatio);\n\n    columns = Math.ceil(width / tileWidth);\n    rows = Math.ceil(height / tileHeight);\n    numTiles = columns * rows;\n  }\n\n  function updatePixelsPerTile() {\n    const msPerTile = totalElapsedMs / numTiles;\n\n    const error = desiredMsPerTile - msPerTile;\n\n     // tweak to find balance. higher = faster convergence, lower = less fluctuations to microstutters\n    const strength = 5000;\n\n    // sqrt prevents massive fluctuations in pixelsPerTile for the occasional stutter\n    pixelsPerTile += strength * Math.sign(error) * Math.sqrt(Math.abs(error));\n    pixelsPerTile = clamp(pixelsPerTile, 8192, width * height);\n  }\n\n  function nextTile(elapsedFrameMs) {\n    currentTile++;\n    totalElapsedMs += elapsedFrameMs;\n\n    if (currentTile % numTiles === 0) {\n      if (totalElapsedMs) {\n        updatePixelsPerTile();\n        calcTileDimensions();\n      }\n\n      totalElapsedMs = 0;\n      currentTile = 0;\n    }\n\n    const isLastTile = currentTile === numTiles - 1;\n\n    const x = currentTile % columns;\n    const y = Math.floor(currentTile / columns) % rows;\n\n    return {\n      x: x * tileWidth,\n      y: y * tileHeight,\n      tileWidth,\n      tileHeight,\n      isFirstTile: currentTile === 0,\n      isLastTile,\n    };\n  }\n\n  return {\n    nextTile,\n    reset,\n    setSize,\n  };\n}\n\nfunction pixelsPerTileEstimate(gl) {\n  const maxRenderbufferSize = gl.getParameter(gl.MAX_RENDERBUFFER_SIZE);\n\n  if (maxRenderbufferSize <= 8192) {\n    return 200000;\n  } else if (maxRenderbufferSize === 16384) {\n    return 400000;\n  } else if (maxRenderbufferSize >= 32768) {\n    return 600000;\n  }\n}\n","export default 'data:image/png;base64,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';","import { makeFramebuffer } from './Framebuffer';\nimport { makeFullscreenQuad } from './FullscreenQuad';\nimport { makeGBufferPass } from './GBufferPass';\nimport { makeMaterialBuffer } from './MaterialBuffer';\nimport { mergeMeshesToGeometry } from './mergeMeshesToGeometry';\nimport { makeRayTracePass } from './RayTracePass';\nimport { makeRenderSize } from './RenderSize';\nimport { makeReprojectPass } from './ReprojectPass';\nimport { makeToneMapPass } from './ToneMapPass';\nimport { clamp, numberArraysEqual } from './util';\nimport { makeTileRender } from './TileRender';\nimport { makeDepthTarget, makeTexture } from './Texture';\nimport noiseBase64 from './texture/noise';\nimport {Mesh} from '../scene/Mesh';\nimport {DirectionalLight} from '../scene/DirectionalLight';\nimport {AmbientLight} from '../scene/AmbientLight';\nimport {EnvironmentLight} from '../scene/EnvironmentLight';\nimport {Camera} from '../scene/Camera';\n\nimport {mat4} from 'gl-matrix';\n\n\nfunction prepareRender(renderList) {\n  const meshes = [];\n  const directionalLights = [];\n  const ambientLights = [];\n  const environmentLights = [];\n  for (let i = 0; i < renderList.length; i++) {\n    const item = renderList[i];\n    if (item instanceof Mesh) {\n      meshes.push(item);\n    }\n    else if (item instanceof DirectionalLight) {\n      directionalLights.push(item);\n    }\n    else if (item instanceof AmbientLight) {\n      ambientLights.push(item);\n    }\n    else if (item instanceof EnvironmentLight) {\n      environmentLights.push(item);\n    }\n  }\n\n  return {\n    meshes,\n    directionalLights,\n    ambientLights,\n    environmentLights\n  };\n}\n\nexport function makeRenderingPipeline({\n    gl,\n    optionalExtensions,\n    renderList,\n    background,\n    toneMappingParams,\n    bounces, // number of global illumination bounces\n  }) {\n\n  const maxReprojectedSamples = 20;\n\n  // how many samples to render with uniform noise before switching to stratified noise\n  const numUniformSamples = 4;\n\n  // how many partitions of stratified noise should be created\n  // higher number results in faster convergence over time, but with lower quality initial samples\n  const strataCount = 6;\n\n  // tile rendering can cause the GPU to stutter, throwing off future benchmarks for the preview frames\n  // wait to measure performance until this number of frames have been rendered\n  const previewFramesBeforeBenchmark = 2;\n\n  // used to sample only a portion of the scene to the HDR Buffer to prevent the GPU from locking up from excessive computation\n  const tileRender = makeTileRender(gl);\n\n  const previewSize = makeRenderSize(gl);\n\n  const decomposedScene = prepareRender(renderList);\n  decomposedScene.background = background;\n\n  const mergedMesh = mergeMeshesToGeometry(decomposedScene.meshes);\n\n  const materialBuffer = makeMaterialBuffer(gl, mergedMesh.materials);\n\n  const fullscreenQuad = makeFullscreenQuad(gl);\n\n  const rayTracePass = makeRayTracePass(gl, { bounces, decomposedScene, fullscreenQuad, materialBuffer, mergedMesh, optionalExtensions });\n\n  const reprojectPass = makeReprojectPass(gl, { fullscreenQuad, maxReprojectedSamples });\n\n  const toneMapPass = makeToneMapPass(gl, { fullscreenQuad, toneMappingParams });\n\n  const gBufferPass = makeGBufferPass(gl, { materialBuffer, mergedMesh });\n\n  let ready = false;\n\n  const noiseImage = new Image();\n  noiseImage.src = noiseBase64;\n  noiseImage.onload = () => {\n    rayTracePass.setNoise(noiseImage);\n    ready = true;\n  };\n\n  let frameTime;\n  let elapsedFrameTime;\n  let sampleTime;\n\n  let sampleCount = 0;\n  let numPreviewsRendered = 0;\n\n  let firstFrame = true;\n\n  let sampleRenderedCallback = () => {};\n\n  const lastCamera = new Camera();\n  lastCamera.matrixWorld = mat4.fromTranslation([], [1, 1, 1]);\n\n  let screenWidth = 0;\n  let screenHeight = 0;\n\n  const fullscreenScale = { x: 1, y: 1};\n\n  let lastToneMappedScale = fullscreenScale;\n\n  let hdrBuffer;\n  let hdrBackBuffer;\n  let reprojectBuffer;\n  let reprojectBackBuffer;\n\n  let gBuffer;\n  let gBufferBack;\n\n  let lastToneMappedTexture;\n\n  function initFrameBuffers(width, height) {\n    const makeHdrBuffer = () => makeFramebuffer(gl, {\n      color: { 0: makeTexture(gl, { width, height, storage: 'float', magFilter: gl.LINEAR, minFilter: gl.LINEAR }) }\n    });\n\n    const makeReprojectBuffer = () => makeFramebuffer(gl, {\n        color: { 0: makeTexture(gl, { width, height, storage: 'float', magFilter: gl.LINEAR, minFilter: gl.LINEAR }) }\n      });\n\n    hdrBuffer = makeHdrBuffer();\n    hdrBackBuffer = makeHdrBuffer();\n\n    reprojectBuffer = makeReprojectBuffer();\n    reprojectBackBuffer = makeReprojectBuffer();\n\n    const normalBuffer = makeTexture(gl, { width, height, storage: 'halfFloat' });\n    const faceNormalBuffer = makeTexture(gl, { width, height, storage: 'halfFloat' });\n    const colorBuffer = makeTexture(gl, { width, height, storage: 'byte', channels: 3 });\n    const matProps = makeTexture(gl, { width, height, storage: 'byte', channels: 2 });\n    const depthTarget = makeDepthTarget(gl, width, height);\n\n    const makeGBuffer = () => makeFramebuffer(gl, {\n      color: {\n        [gBufferPass.outputLocs.position]: makeTexture(gl, { width, height, storage: 'float' }),\n        [gBufferPass.outputLocs.normal]: normalBuffer,\n        [gBufferPass.outputLocs.faceNormal]: faceNormalBuffer,\n        [gBufferPass.outputLocs.color]: colorBuffer,\n        [gBufferPass.outputLocs.matProps]: matProps,\n      },\n      depth: depthTarget\n    });\n\n    gBuffer = makeGBuffer();\n    gBufferBack = makeGBuffer();\n\n    lastToneMappedTexture = hdrBuffer.color[rayTracePass.outputLocs.light];\n  }\n\n  function swapReprojectBuffer() {\n    let temp = reprojectBuffer;\n    reprojectBuffer = reprojectBackBuffer;\n    reprojectBackBuffer = temp;\n  }\n\n  function swapGBuffer() {\n    let temp = gBuffer;\n    gBuffer = gBufferBack;\n    gBufferBack = temp;\n  }\n\n  function swapHdrBuffer() {\n    let temp = hdrBuffer;\n    hdrBuffer = hdrBackBuffer;\n    hdrBackBuffer = temp;\n  }\n\n  // Shaders will read from the back buffer and draw to the front buffer\n  // Buffers are swapped after every render\n  function swapBuffers() {\n    swapReprojectBuffer();\n    swapGBuffer();\n    swapHdrBuffer();\n  }\n\n  function setSize(w, h) {\n    screenWidth = w;\n    screenHeight = h;\n\n    tileRender.setSize(w, h);\n    previewSize.setSize(w, h);\n    initFrameBuffers(w, h);\n    firstFrame = true;\n  }\n\n  // called every frame to update clock\n  function time(newTime) {\n    elapsedFrameTime = newTime - frameTime;\n    frameTime = newTime;\n  }\n\n  function areCamerasEqual(cam1, cam2) {\n    return numberArraysEqual(cam1.matrixWorld, cam2.matrixWorld) &&\n      cam1.aspect === cam2.aspect &&\n      cam1.fov === cam2.fov;\n  }\n\n  function updateSeed(width, height, useJitter = true) {\n    rayTracePass.setSize(width, height);\n\n    const jitterX = useJitter ? (Math.random() - 0.5) / width : 0;\n    const jitterY = useJitter ? (Math.random() - 0.5) / height : 0;\n    gBufferPass.setJitter(jitterX, jitterY);\n    rayTracePass.setJitter(jitterX, jitterY);\n    reprojectPass.setJitter(jitterX, jitterY);\n\n    if (sampleCount === 0) {\n      rayTracePass.setStrataCount(1);\n    } else if (sampleCount === numUniformSamples) {\n      rayTracePass.setStrataCount(strataCount);\n    } else {\n      rayTracePass.nextSeed();\n    }\n  }\n\n  function clearBuffer(buffer) {\n    buffer.bind();\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    buffer.unbind();\n  }\n\n  function addSampleToBuffer(buffer, width, height) {\n    buffer.bind();\n\n    gl.blendEquation(gl.FUNC_ADD);\n    gl.blendFunc(gl.ONE, gl.ONE);\n    gl.enable(gl.BLEND);\n\n    gl.viewport(0, 0, width, height);\n    rayTracePass.draw();\n\n    gl.disable(gl.BLEND);\n    buffer.unbind();\n  }\n\n  function newSampleToBuffer(buffer, width, height) {\n    buffer.bind();\n    gl.viewport(0, 0, width, height);\n    rayTracePass.draw();\n    buffer.unbind();\n  }\n\n  function toneMapToScreen(lightTexture, lightScale) {\n    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n    toneMapPass.draw({\n      light: lightTexture,\n      lightScale,\n      position: gBuffer.color[gBufferPass.outputLocs.position],\n    });\n\n    lastToneMappedTexture = lightTexture;\n    lastToneMappedScale = {x: lightScale.x, y: lightScale.y};\n  }\n\n  function renderGBuffer() {\n    gBuffer.bind();\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    gl.viewport(0, 0, screenWidth, screenHeight);\n    gBufferPass.draw();\n    gBuffer.unbind();\n\n    rayTracePass.setGBuffers({\n      position: gBuffer.color[gBufferPass.outputLocs.position],\n      normal: gBuffer.color[gBufferPass.outputLocs.normal],\n      faceNormal: gBuffer.color[gBufferPass.outputLocs.faceNormal],\n      color: gBuffer.color[gBufferPass.outputLocs.color],\n      matProps: gBuffer.color[gBufferPass.outputLocs.matProps]\n    });\n  }\n\n  function renderTile(buffer, x, y, width, height) {\n    gl.scissor(x, y, width, height);\n    gl.enable(gl.SCISSOR_TEST);\n    addSampleToBuffer(buffer, screenWidth, screenHeight);\n    gl.disable(gl.SCISSOR_TEST);\n  }\n\n  function setCameras(camera, lastCamera) {\n    rayTracePass.setCamera(camera);\n    gBufferPass.setCamera(camera);\n    reprojectPass.setPreviousCamera(lastCamera);\n    lastCamera.copy(camera);\n  }\n\n  function drawPreview() {\n    if (sampleCount > 0) {\n      swapBuffers();\n    }\n\n    if (numPreviewsRendered >= previewFramesBeforeBenchmark) {\n      previewSize.adjustSize(elapsedFrameTime);\n    }\n\n    updateSeed(previewSize.width, previewSize.height, false);\n\n    renderGBuffer();\n\n    rayTracePass.bindTextures();\n    newSampleToBuffer(hdrBuffer, previewSize.width, previewSize.height);\n\n    reprojectBuffer.bind();\n    gl.viewport(0, 0, previewSize.width, previewSize.height);\n    reprojectPass.draw({\n      blendAmount: 1.0,\n      light: hdrBuffer.color[0],\n      lightScale: previewSize.scale,\n      position: gBuffer.color[gBufferPass.outputLocs.position],\n      previousLight: lastToneMappedTexture,\n      previousLightScale: lastToneMappedScale,\n      previousPosition: gBufferBack.color[gBufferPass.outputLocs.position],\n    });\n    reprojectBuffer.unbind();\n\n    toneMapToScreen(reprojectBuffer.color[0], previewSize.scale);\n\n    swapBuffers();\n  }\n\n  function drawTile() {\n    const { x, y, tileWidth, tileHeight, isFirstTile, isLastTile } = tileRender.nextTile(elapsedFrameTime);\n\n    if (isFirstTile) {\n\n      if (sampleCount === 0) { // previous rendered image was a preview image\n        clearBuffer(hdrBuffer);\n        reprojectPass.setPreviousCamera(lastCamera);\n      } else {\n        sampleRenderedCallback(sampleCount, frameTime - sampleTime || NaN);\n        sampleTime = frameTime;\n      }\n\n      updateSeed(screenWidth, screenHeight, true);\n      renderGBuffer();\n      rayTracePass.bindTextures();\n    }\n\n    renderTile(hdrBuffer, x, y, tileWidth, tileHeight);\n\n    if (isLastTile) {\n      sampleCount++;\n\n      let blendAmount = clamp(1.0 - sampleCount / maxReprojectedSamples, 0, 1);\n      blendAmount *= blendAmount;\n\n      if (blendAmount > 0.0) {\n        reprojectBuffer.bind();\n        gl.viewport(0, 0, screenWidth, screenHeight);\n        reprojectPass.draw({\n          blendAmount,\n          light: hdrBuffer.color[0],\n          lightScale: fullscreenScale,\n          position: gBuffer.color[gBufferPass.outputLocs.position],\n          previousLight: reprojectBackBuffer.color[0],\n          previousLightScale: previewSize.scale,\n          previousPosition: gBufferBack.color[gBufferPass.outputLocs.position],\n        });\n        reprojectBuffer.unbind();\n\n        toneMapToScreen(reprojectBuffer.color[0], fullscreenScale);\n      } else {\n        toneMapToScreen(hdrBuffer.color[0], fullscreenScale);\n      }\n    }\n  }\n\n  function draw(camera) {\n    if (!ready) {\n      return;\n    }\n\n    if (!areCamerasEqual(camera, lastCamera)) {\n      setCameras(camera, lastCamera);\n\n      if (firstFrame) {\n        firstFrame = false;\n      } else {\n        drawPreview(camera, lastCamera);\n        numPreviewsRendered++;\n      }\n      tileRender.reset();\n      sampleCount = 0;\n    } else {\n      drawTile();\n      numPreviewsRendered = 0;\n    }\n  }\n\n  // debug draw call to measure performance\n  // use full resolution buffers every frame\n  // reproject every frame\n  function drawFull(camera) {\n    if (!ready) {\n      return;\n    }\n\n    swapGBuffer();\n    swapReprojectBuffer();\n\n    if (!areCamerasEqual(camera, lastCamera)) {\n      sampleCount = 0;\n      clearBuffer(hdrBuffer);\n    } else {\n      sampleCount++;\n    }\n\n    setCameras(camera, lastCamera);\n\n    updateSeed(screenWidth, screenHeight, true);\n\n    renderGBuffer(camera);\n\n    rayTracePass.bindTextures();\n    addSampleToBuffer(hdrBuffer, screenWidth, screenHeight);\n\n    reprojectBuffer.bind();\n    gl.viewport(0, 0, screenWidth, screenHeight);\n    reprojectPass.draw({\n      blendAmount: 1.0,\n      light: hdrBuffer.color[0],\n      lightScale: fullscreenScale,\n      position: gBuffer.color[gBufferPass.outputLocs.position],\n      previousLight: lastToneMappedTexture,\n      previousLightScale: lastToneMappedScale,\n      previousPosition: gBufferBack.color[gBufferPass.outputLocs.position],\n    });\n    reprojectBuffer.unbind();\n\n    toneMapToScreen(reprojectBuffer.color[0], fullscreenScale);\n  }\n\n  return {\n    draw,\n    drawFull,\n    setSize,\n    time,\n    getTotalSamplesRendered() {\n      return sampleCount;\n    },\n    set onSampleRendered(cb) {\n      sampleRenderedCallback = cb;\n    },\n    get onSampleRendered() {\n      return sampleRenderedCallback;\n    }\n  };\n}\n","import { loadExtensions } from './renderer/glUtil';\nimport { makeRenderingPipeline } from './renderer/RenderingPipeline';\nimport * as constants from './constants';\n\nconst glRequiredExtensions = [\n  'EXT_color_buffer_float', // enables rendering to float buffers\n  'EXT_float_blend',\n];\n\nconst glOptionalExtensions = [\n  'OES_texture_float_linear', // enables gl.LINEAR texture filtering for float textures,\n];\n\nexport function RayTracingRenderer(params = {}) {\n  const canvas = params.canvas || document.createElement('canvas');\n\n  const gl = canvas.getContext('webgl2', {\n    alpha: false,\n    depth: true,\n    stencil: false,\n    antialias: false,\n    powerPreference: 'high-performance',\n    failIfMajorPerformanceCaveat: true\n  });\n\n  loadExtensions(gl, glRequiredExtensions);\n  const optionalExtensions = loadExtensions(gl, glOptionalExtensions);\n\n  let pipeline = null;\n  const size = {width: 0, height: 0};\n  let pixelRatio = 1;\n\n  let oldRenderList = [];\n\n  const module = {\n    bounces: 2,\n    domElement: canvas,\n    maxHardwareUsage: false,\n    needsUpdate: true,\n    onSampleRendered: null,\n    renderWhenOffFocus: true,\n    toneMapping: constants.ACESFilmicToneMapping,\n    toneMappingExposure: 1,\n    toneMappingWhitePoint: 1,\n  };\n\n  function initRenderList(renderList, background) {\n    const toneMappingParams = {\n      exposure: module.toneMappingExposure,\n      whitePoint: module.toneMappingWhitePoint,\n      toneMapping: module.toneMapping\n    };\n\n    const bounces = module.bounces;\n\n    pipeline = makeRenderingPipeline({gl, optionalExtensions, renderList, background, toneMappingParams, bounces});\n\n    pipeline.onSampleRendered = (...args) => {\n      if (module.onSampleRendered) {\n        module.onSampleRendered(...args);\n      }\n    };\n\n    module.setSize(size.width, size.height);\n    module.needsUpdate = false;\n  }\n\n  module.setSize = (width, height, updateStyle = true) => {\n    size.width = width;\n    size.height = height;\n\n    canvas.width = size.width * pixelRatio;\n    canvas.height = size.height * pixelRatio;\n\n    if (updateStyle) {\n      canvas.style.width = `${ size.width }px`;\n      canvas.style.height = `${ size.height }px`;\n    }\n\n    if (pipeline) {\n      pipeline.setSize(size.width * pixelRatio, size.height * pixelRatio);\n    }\n  };\n\n  module.getSize = () => {\n    return {\n      width: size.width,\n      height: size.height\n    };\n  };\n\n  module.setPixelRatio = (pr) => {\n    if (!pr) {\n      return;\n    }\n    pixelRatio = pr;\n    module.setSize(size.width, size.height, false);\n  };\n\n  module.getPixelRatio = () => pixelRatio;\n\n  module.getTotalSamplesRendered = () => {\n    if (pipeline) {\n      return pipeline.getTotalSamplesRendered();\n    }\n  };\n\n  let isValidTime = 1;\n  let currentTime = NaN;\n  let syncWarning = false;\n\n  function restartTimer() {\n    isValidTime = NaN;\n  }\n\n  module.sync = (t) => {\n    // the first call to the callback of requestAnimationFrame does not have a time parameter\n    // use performance.now() in this case\n    currentTime = t || performance.now();\n  };\n\n  let lastFocus = false;\n\n  function isSameRenderList(a, b) {\n    if (a.length !== b.length) {\n      return false;\n    }\n    for (let i = 0; i < a.length; i++) {\n      if (a[i] !== b[i]) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  module.render = (renderList, camera, background) => {\n    if (!module.renderWhenOffFocus) {\n      const hasFocus = document.hasFocus();\n      if (!hasFocus) {\n        lastFocus = hasFocus;\n        return;\n      } else if (hasFocus && !lastFocus) {\n        lastFocus = hasFocus;\n        restartTimer();\n      }\n    }\n\n    if (module.needsUpdate || !isSameRenderList(oldRenderList, renderList)) {\n      initRenderList(renderList, background);\n      oldRenderList = renderList.slice();\n    }\n\n    if (isNaN(currentTime)) {\n      if (!syncWarning) {\n        console.warn('Ray Tracing Renderer warning: For improved performance, please call renderer.sync(time) before render.render(scene, camera), with the time parameter equalling the parameter passed to the callback of requestAnimationFrame');\n        syncWarning = true;\n      }\n\n      currentTime = performance.now(); // less accurate than requestAnimationFrame's time parameter\n    }\n\n    pipeline.time(isValidTime * currentTime);\n\n    isValidTime = 1;\n    currentTime = NaN;\n\n\n    if(module.maxHardwareUsage) {\n      // render new sample for the entire screen\n      pipeline.drawFull(camera);\n    } else {\n      // render new sample for a tiled subset of the screen\n      pipeline.draw(camera);\n    }\n  };\n\n  // Assume module.render is called using requestAnimationFrame.\n  // This means that when the user is on a different browser tab, module.render won't be called.\n  // Since the timer should not measure time when module.render is inactive,\n  // the timer should be reset when the user switches browser tabs\n  document.addEventListener('visibilitychange', restartTimer);\n\n  module.dispose = () => {\n    document.removeEventListener('visibilitychange', restartTimer);\n    pipeline = null;\n  };\n\n  return module;\n}\n\nRayTracingRenderer.isSupported = () => {\n  const gl = document.createElement('canvas')\n    .getContext('webgl2', {\n      failIfMajorPerformanceCaveat: true\n    });\n\n  if (!gl) {\n    return false;\n  }\n\n  const extensions = loadExtensions(gl, glRequiredExtensions);\n  for (let e in extensions) {\n    if (!extensions[e]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n","import { Texture } from '../scene/Texture';\n\nconst toChar = String.fromCharCode;\n\nconst MINELEN = 8;\nconst MAXELEN = 0x7fff;\n\nfunction setToPixels(rgbe, buffer, offset) {\n  buffer[offset] = rgbe[0];\n  buffer[offset + 1] = rgbe[1];\n  buffer[offset + 2] = rgbe[2];\n  buffer[offset + 3] = rgbe[3];\n  return buffer;\n}\n\nfunction uint82string(array, offset, size) {\n    let str = '';\n    for (let i = offset; i < size; i++) {\n        str += toChar(array[i]);\n    }\n    return str;\n}\n\nfunction copyrgbe(s, t) {\n  t[0] = s[0];\n  t[1] = s[1];\n  t[2] = s[2];\n  t[3] = s[3];\n}\n\n// TODO : check\nfunction oldReadColors(scan, buffer, offset, xmax) {\n  let rshift = 0, x = 0, len = xmax;\n  while (len > 0) {\n    scan[x][0] = buffer[offset++];\n    scan[x][1] = buffer[offset++];\n    scan[x][2] = buffer[offset++];\n    scan[x][3] = buffer[offset++];\n    if (scan[x][0] === 1 && scan[x][1] === 1 && scan[x][2] === 1) {\n      // exp is count of repeated pixels\n      for (let i = (scan[x][3] << rshift) >>> 0; i > 0; i--) {\n        copyrgbe(scan[x-1], scan[x]);\n        x++;\n        len--;\n      }\n      rshift += 8;\n    } else {\n      x++;\n      len--;\n      rshift = 0;\n    }\n  }\n  return offset;\n}\n\nfunction readColors(scan, buffer, offset, xmax) {\n    if ((xmax < MINELEN) | (xmax > MAXELEN)) {\n      return oldReadColors(scan, buffer, offset, xmax);\n    }\n    let i = buffer[offset++];\n    if (i != 2) {\n      return oldReadColors(scan, buffer, offset - 1, xmax);\n    }\n    scan[0][1] = buffer[offset++];\n    scan[0][2] = buffer[offset++];\n\n    i = buffer[offset++];\n    if ((((scan[0][2] << 8) >>> 0) | i) >>> 0 !== xmax) {\n      return null;\n    }\n    for (let i = 0; i < 4; i++) {\n      for (let x = 0; x < xmax;) {\n        let code = buffer[offset++];\n        if (code > 128) {\n          code = (code & 127) >>> 0;\n          let val = buffer[offset++];\n          while (code--) {\n            scan[x++][i] = val;\n          }\n        } else {\n          while (code--) {\n            scan[x++][i] = buffer[offset++];\n          }\n        }\n      }\n    }\n    return offset;\n}\n\nexport function parseRGBE(arrayBuffer) {\n  const data = new Uint8Array(arrayBuffer);\n  const size = data.length;\n  if (uint82string(data, 0, 2) !== '#?') {\n    return;\n  }\n  let i;\n  // find empty line, next line is resolution info\n  for (i = 2; i < size; i++) {\n    if (toChar(data[i]) === '\\n' && toChar(data[i+1]) === '\\n') {\n      break;\n    }\n  }\n  if (i >= size) { // not found\n    return;\n  }\n  // find resolution info line\n  i += 2;\n  let str = '';\n  for (; i < size; i++) {\n    let _char = toChar(data[i]);\n    if (_char === '\\n') {\n      break;\n    }\n    str += _char;\n  }\n  // -Y M +X N\n  let tmp = str.split(' ');\n  let height = parseInt(tmp[1]);\n  let width = parseInt(tmp[3]);\n  if (!width || !height) {\n      return;\n  }\n\n  // read and decode actual data\n  let offset = i + 1;\n  let scanline = [];\n  // memzero\n  for (let x = 0; x < width; x++) {\n    scanline[x] = [];\n    for (let j = 0; j < 4; j++) {\n      scanline[x][j] = 0;\n    }\n  }\n  let pixels = new Float32Array(width * height * 4);\n  let offset2 = 0;\n  for (let y = 0; y < height; y++) {\n    offset = readColors(scanline, data, offset, width);\n    if (!offset) {\n      return null;\n    }\n    for (let x = 0; x < width; x++) {\n      setToPixels(scanline[x], pixels, offset2);\n      offset2 += 4;\n    }\n  }\n\n  return new Texture({\n    width,\n    height,\n    data: pixels\n  });\n}\n\nexport function loadRGBE(url) {\n  return fetch(url).then(res => res.arrayBuffer()).then(ab => {\n    return parseRGBE(ab);\n  });\n}","import {Mesh} from '../scene/Mesh';\nimport {StandardMaterial} from '../scene/StandardMaterial';\nimport {Attribute, Geometry} from '../scene/Geometry';\nimport {Texture} from '../scene/Texture';\nimport {DirectionalLight} from '../scene/DirectionalLight';\nimport {AmbientLight} from '../scene/AmbientLight';\nimport {Camera} from '../scene/Camera';\n\nfunction convertTexture(threeTexture) {\n  if (!threeTexture) {\n    return;\n  }\n  return new Texture(threeTexture.image);\n}\n\nfunction convertMaterial(threeMaterial) {\n  const material = new StandardMaterial();\n  material.color = threeMaterial.color.toArray();\n  material.emissive = threeMaterial.emissive && threeMaterial.emissive.toArray();\n  material.transparent = threeMaterial.transparent;\n  material.roughness = threeMaterial.roughness;\n  material.metalness = threeMaterial.metalness;\n  material.emissiveIntensity = threeMaterial.emissiveIntensity;\n\n  material.normalScale = threeMaterial.normalScale && threeMaterial.normalScale.toArray();\n\n  material.map = convertTexture(threeMaterial.map);\n  material.emissiveMap = convertTexture(threeMaterial.emissiveMap);\n  material.roughnessMap = convertTexture(threeMaterial.roughnessMap);\n  material.metalnessMap = convertTexture(threeMaterial.metalnessMap);\n\n  return material;\n}\n\nfunction convertGeometry(threeGeometry) {\n  const positionAttrb = threeGeometry.getAttribute('position');\n  const normalAttrb = threeGeometry.getAttribute('normal');\n  const uvAttrb = threeGeometry.getAttribute('uv');\n  const indexAttrb = threeGeometry.getIndex();\n  return new Geometry({\n    position: positionAttrb && new Attribute(positionAttrb.array, positionAttrb.itemSize),\n    normal: normalAttrb && new Attribute(normalAttrb.array, normalAttrb.itemSize),\n    uv: uvAttrb && new Attribute(uvAttrb.array, uvAttrb.itemSize),\n    indices: indexAttrb && new Attribute(indexAttrb.array, indexAttrb.itemSize),\n  });\n}\n\nexport function fromTHREEScene(scene) {\n  const meshes = [];\n  const lights = [];\n\n  scene.updateMatrixWorld(true);\n  scene.traverse(child => {\n    if (child.isMesh) {\n      if (!child.geometry) {\n        console.warn(child, 'must have a geometry property');\n      }\n      else if (!(child.material.isMeshStandardMaterial)) {\n        console.warn(child, 'must use MeshStandardMaterial in order to be rendered.');\n      } else {\n        const mesh = new Mesh(\n          convertGeometry(child.geometry),\n          convertMaterial(child.material)\n        );\n        mesh.matrixWorld = new Float32Array(child.matrixWorld.elements);\n        meshes.push(mesh);\n      }\n    }\n    else if (child.isDirectionalLight) {\n      lights.push(new DirectionalLight(\n        child.position.clone().sub(child.target.position).toArray(),\n        child.color.toArray(),\n        child.intensity\n      ));\n    }\n    else if (child.isAmbientLight) {\n      lights.push(new AmbientLight(\n        child.color.toArray(),\n        child.intensity\n      ));\n    }\n  });\n\n  const background = scene.background && (\n    scene.background.isColor\n      ? scene.background.toArray()\n      : new Texture({\n        image: {\n          data: scene.background.image.data,\n          width: scene.background.image.width,\n          height: scene.background.image.height\n        }\n      })\n    );\n\n  return {\n    background: background,\n    renderList: meshes.concat(lights)\n  };\n}\n\nexport function fromTHREECamera(threeCamera, aperture) {\n  const camera = new Camera(threeCamera.fov, threeCamera.aspect, threeCamera.near, threeCamera.far);\n  threeCamera.updateWorldMatrix(true, false);\n  camera.matrixWorld = threeCamera.matrixWorld.elements.slice();\n  if (aperture) {\n    camera.aperture = aperture;\n  }\n  return camera;\n}"],"names":["glMatrix.ARRAY_TYPE","create","SceneNode","matrixWorld","mat4","Camera","fov","aspect","near","far","zoom","focus","aperture","source","Math","PI","DirectionalLight","direction","color","intensity","softness","AmbientLight","EnvironmentLight","map","Mesh","geometry","material","StandardMaterial","roughness","metalness","emissive","emissiveIntensity","emissiveMap","normalMap","normalScale","roughnessMap","metalnessMap","transparent","solid","shadowCaster","Texture","image","flipY","Attribute","array","itemSize","out","vertexIndex","offset","i","length","Geometry","data","position","normal","uv","indices","materialMeshIndex","loadExtensions","gl","extensions","supported","name","getExtension","compileShader","type","shader","createShader","shaderSource","success","getShaderParameter","COMPILE_STATUS","output","split","x","join","console","log","getShaderInfoLog","createProgram","vertexShader","fragmentShader","transformVaryings","transformBufferMode","program","attachShader","transformFeedbackVaryings","linkProgram","detachShader","getProgramParameter","LINK_STATUS","getProgramInfoLog","getUniforms","uniforms","count","ACTIVE_UNIFORMS","getActiveUniform","location","getUniformLocation","getAttributes","attributes","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","makeFramebuffer","depth","framebuffer","createFramebuffer","bind","bindFramebuffer","FRAMEBUFFER","unbind","init","drawBuffers","Number","undefined","error","tex","framebufferTexture2D","COLOR_ATTACHMENT0","target","texture","push","framebufferRenderbuffer","DEPTH_ATTACHMENT","typeMap","makeUniformSetter","uniformInfo","needsUpload","uniform","v0","v1","v2","v3","failedUnis","Set","setUniform","uni","has","warn","add","initTypeMap","upload","pop","glMethod","matrix","transpose","values","FLOAT","glName","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","INT","INT_VEC2","INT_VEC3","INT_VEC4","SAMPLER_2D","SAMPLER_2D_ARRAY","FLOAT_MAT2","glNameMatrix","FLOAT_MAT3","FLOAT_MAT4","numComponents","rows","columns","makeRenderPass","params","fragment","vertex","vertexCompiled","WebGLShader","makeVertexShader","fragmentCompiled","makeFragmentShader","makeRenderPassFromProgram","outputLocs","outputs","getOutputLocations","defines","makeShaderStage","VERTEX_SHADER","FRAGMENT_SHADER","uniformSetter","textures","nextTexUnit","setTexture","unit","bindTextures","activeTexture","TEXTURE0","bindTexture","useProgram","autoBindTextures","attribLocs","str","addDefines","addOutputs","includes","addIncludes","value","locations","include","makeFullscreenQuad","vao","createVertexArray","bindVertexArray","bindBuffer","ARRAY_BUFFER","createBuffer","bufferData","Float32Array","STATIC_DRAW","posLoc","enableVertexAttribArray","vertexAttribPointer","draw","drawArrays","TRIANGLES","constants","materialBuffer","makeGBufferPass","mergedMesh","renderPass","diffuseMap","pbrMap","elementCount","uploadAttributes","jitterX","jitterY","setJitter","y","currentCamera","setCamera","camera","calcCamera","projView","projectionMatrix","matrixWorldInverse","enable","DEPTH_TEST","drawElements","UNSIGNED_INT","disable","setAttribute","aPosition","aNormal","aUv","aMaterialMeshIndex","ELEMENT_ARRAY_BUFFER","bufferAttribute","Int32Array","vertexAttribIPointer","ThinMaterial","ThickMaterial","ShadowCatcherMaterial","LinearToneMapping","ReinhardToneMapping","Uncharted2ToneMapping","CineonToneMapping","ACESFilmicToneMapping","makeUniformBuffer","blockName","blockIndex","getUniformBlockIndex","blockSize","getActiveUniformBlockParameter","UNIFORM_BLOCK_DATA_SIZE","getUniformBlockInfo","buffer","UNIFORM_BUFFER","DataView","ArrayBuffer","set","size","stride","setData","BOOL","index","bufferSubData","bindBufferBase","UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES","getActiveUniforms","UNIFORM_OFFSET","UNIFORM_ARRAY_STRIDE","dataView","setter","components","l","min","k","clamp","max","shuffle","arr","j","floor","random","numberArraysEqual","a","b","eps","abs","makeTexture","width","height","channels","storage","gammaCorrection","wrapS","CLAMP_TO_EDGE","wrapT","minFilter","NEAREST","magFilter","createTexture","dataArray","Array","isArray","TEXTURE_2D_ARRAY","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","getTextureFormat","format","internalFormat","texStorage3D","layerWidth","layerHeight","pixelStorei","UNPACK_FLIP_Y_WEBGL","texSubImage3D","texStorage2D","texSubImage2D","makeDepthTarget","createRenderbuffer","RENDERBUFFER","bindRenderbuffer","renderbufferStorage","DEPTH_COMPONENT24","getFormat","RED","RG","RGB","RGBA","isByteArray","Uint8Array","HTMLImageElement","HTMLCanvasElement","ImageData","isFloatArray","R8","RG8","SRGB8","RGB8","SRGB8_ALPHA8","RGBA8","UNSIGNED_BYTE","R32F","RG32F","RGB32F","RGBA32F","R16F","RG16F","RGB16F","RGBA16F","R8_SNORM","RG8_SNORM","RGB8_SNORM","RGBA8_SNORM","getTexturesFromMaterials","meshes","textureNames","textureMap","texturesFromMaterials","mergeTexturesFromMaterials","materials","textureName","isTextureLoaded","makeMaterialBuffer","maps","m","slice","shadowCatcher","makeTextureArray","relativeSizes","diffuseMapSize","diffuseMapIndex","normalMapSize","normalMapIndex","pbrMapSize","roughnessMapIndex","metalnessMapIndex","NUM_MATERIALS","NUM_DIFFUSE_MAPS","NUM_NORMAL_MAPS","NUM_DIFFUSE_NORMAL_MAPS","NUM_PBR_MAPS","materialBufferChunk","uploadToUniformBuffer","images","t","maxImageSize","maxSize","LINEAR","interleave","concat","maxLength","interleaved","c","mergeMeshesToGeometry","vertexCount","indexCount","geometryAndMaterialIndex","materialIndexMap","Map","mesh","addFlatGeometryIndices","transformGeometry","computeGeometryNormals","vec3","materialIndex","get","mergeGeometry","from","keys","positionAttrib","normalAttrib","uvAttrib","indexAttrib","Uint32Array","materialMeshIndexAttrib","mergedGeometry","currentVertex","currentIndex","currentMesh","forEach","attr","meshIndices","newGeometry","inverseTransposeMatrix","positions","normals","p1","p2","p3","v21","v32","n","len","i1","i2","i3","f","partition","compare","left","right","swap","nthElement","minIndex","minValue","Box3","Infinity","bvhAccel","primitiveInfo","makePrimitiveInfo","node","recursiveBuild","flattenBvh","bvh","flat","isBounds","splitAxisMap","z","maxDepth","traverse","primitives","p","faceNormal","bounds","splitAxis","child0","child1","floatView","intView","e0","e1","i0","getItem","info","center","start","end","union","nPrimitives","makeLeafNode","centroidBounds","dim","maximumExtent","mid","buckets","boxOffset","cost","b0","b1","count0","count1","surfaceArea","minCost","minCostSplitBucket","makeInteriorNode","box3","v","rgbeToFloat","texels","floatBuffer","expTable","pow","r","g","e","DEFAULT_MAP_RESOLUTION","generateBackgroundMapFromSceneBackground","background","backgroundImage","generateSolidMap","generateEnvMapFromSceneComponents","directionalLights","ambientLights","environmentLights","envImage","initializeEnvMap","light","addAmbientLightToEnvMap","addDirectionalLightToEnvMap","environmentLight","setBufferToColor","part","component","lightDirection","sphericalCoords","eulerToSpherical","theta","EPS","phi","addLightAtCoordinates","originCoords","xTexels","yTexels","threshold","findThreshold","useThreshold","intensityFromAngleFunction","getIntensityFromAngleDifferentialThresholded","getIntensityFromAngleDifferential","begunAddingContributions","currentCoords","radius","encounteredInThisRow","bufferIndex","equirectangularToSpherical","falloff","step","maxSteps","angle","getFalloffAtAngle","deltaPhi","getAngleDelta","deltaTheta","angleBetweenSphericals","angleA","angleB","diff","originVector","currentVector","sphericalToEuler","sqrt","acos","softnessCoefficient","atan2","sinPhiRadius","sin","cos","envMapDistribution","cdfImage","cdf","sinTheta","luminance","rowIntegral","integral","channel","val","unrollLoop","indexName","limit","code","unrolled","rayTraceCore","textureLinear","intersect","surfaceInteractionDirect","envMap","bsdf","sample","sampleMaterial","sampleGlass","sampleShadowCatcher","BOUNCES","makeStratifiedSampler","strataCount","dimensions","strata","restart","next","stratum","makeStratifiedSamplerCombined","listOfDimensions","strataObjs","combined","nums","num","makeRayTracePass","bounces","decomposedScene","fullscreenQuad","optionalExtensions","samplingDimensions","samples","makeRenderPassFromScene","setSize","setNoise","noiseImage","REPEAT","tan","setGBuffers","matProps","nextSeed","setStrataCount","OES_texture_float_linear","materialIndices","flattenedBvh","numTris","BVH_COLUMNS","textureDimensionsFromArray","columnsLog","INDEX_COLUMNS","VERTEX_COLUMNS","STACK_SIZE","USE_GLASS","some","USE_SHADOW_CATCHER","SAMPLING_DIMENSIONS","reduce","makeDataTexture","envImageTextureObject","backgroundImageTextureObject","distribution","round","log2","ceil","textureDim","padArray","typedArray","newArray","constructor","makeRenderSize","desiredMsPerFrame","fullWidth","fullHeight","renderWidth","renderHeight","scale","pixelsPerFrame","pixelsPerFrameEstimate","w","h","calcDimensions","aspectRatio","adjustSize","elapsedFrameMs","strength","maxRenderbufferSize","getParameter","MAX_RENDERBUFFER_SIZE","makeReprojectPass","maxReprojectedSamples","MAX_SAMPLES","toFixed","setPreviousCamera","previousCamera","blendAmount","lightScale","previousLight","previousLightScale","previousPosition","toneMapFunctions","makeToneMapPass","toneMappingParams","renderPassConfig","TONE_MAPPING","toneMapping","WHITE_POINT","whitePoint","toExponential","EXPOSURE","exposure","EDGE_PRESERVING_UPSCALE","renderPassUpscale","renderPassNative","makeTileRender","desiredMsPerTile","currentTile","numTiles","tileWidth","tileHeight","totalElapsedMs","pixelsPerTile","pixelsPerTileEstimate","reset","NaN","calcTileDimensions","updatePixelsPerTile","msPerTile","sign","nextTile","isLastTile","isFirstTile","prepareRender","renderList","item","makeRenderingPipeline","numUniformSamples","previewFramesBeforeBenchmark","tileRender","previewSize","rayTracePass","reprojectPass","toneMapPass","gBufferPass","ready","Image","src","noiseBase64","onload","frameTime","elapsedFrameTime","sampleTime","sampleCount","numPreviewsRendered","firstFrame","sampleRenderedCallback","lastCamera","screenWidth","screenHeight","fullscreenScale","lastToneMappedScale","hdrBuffer","hdrBackBuffer","reprojectBuffer","reprojectBackBuffer","gBuffer","gBufferBack","lastToneMappedTexture","initFrameBuffers","makeHdrBuffer","makeReprojectBuffer","normalBuffer","faceNormalBuffer","colorBuffer","depthTarget","makeGBuffer","swapReprojectBuffer","temp","swapGBuffer","swapHdrBuffer","swapBuffers","time","newTime","areCamerasEqual","cam1","cam2","updateSeed","useJitter","clearBuffer","clear","COLOR_BUFFER_BIT","addSampleToBuffer","blendEquation","FUNC_ADD","blendFunc","ONE","BLEND","viewport","newSampleToBuffer","toneMapToScreen","lightTexture","drawingBufferWidth","drawingBufferHeight","renderGBuffer","DEPTH_BUFFER_BIT","renderTile","scissor","SCISSOR_TEST","setCameras","copy","drawPreview","drawTile","drawFull","getTotalSamplesRendered","onSampleRendered","cb","glRequiredExtensions","glOptionalExtensions","RayTracingRenderer","canvas","document","createElement","getContext","alpha","stencil","antialias","powerPreference","failIfMajorPerformanceCaveat","pipeline","pixelRatio","oldRenderList","module","domElement","maxHardwareUsage","needsUpdate","renderWhenOffFocus","toneMappingExposure","toneMappingWhitePoint","initRenderList","updateStyle","style","getSize","setPixelRatio","pr","getPixelRatio","isValidTime","currentTime","syncWarning","restartTimer","sync","performance","now","lastFocus","isSameRenderList","render","hasFocus","isNaN","addEventListener","dispose","removeEventListener","isSupported","toChar","String","fromCharCode","MINELEN","MAXELEN","setToPixels","rgbe","uint82string","copyrgbe","s","oldReadColors","scan","xmax","rshift","readColors","parseRGBE","arrayBuffer","_char","tmp","parseInt","scanline","pixels","offset2","loadRGBE","url","fetch","then","res","ab","convertTexture","threeTexture","convertMaterial","threeMaterial","toArray","convertGeometry","threeGeometry","positionAttrb","getAttribute","normalAttrb","uvAttrb","indexAttrb","getIndex","fromTHREEScene","scene","lights","updateMatrixWorld","child","isMesh","isMeshStandardMaterial","elements","isDirectionalLight","clone","sub","isAmbientLight","isColor","fromTHREECamera","threeCamera","updateWorldMatrix"],"mappings":"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G,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;EACrD,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;EACrD,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;EACrD,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;EACrD,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;EACrD,EAAE,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;EACtD,EAAE,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;EACtD,EAAE,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;EACtD,EAAE,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;EACtD,EAAE,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;EACtD,EAAE,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;EACtD,EAAE,OAAO,GAAG,CAAC;EACb,CAAC;EAmFD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;EACO,SAAS,QAAQ,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE;EACpC,EAAE,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;EAChB,MAAM,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;EAChB,MAAM,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;EAChB,MAAM,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;EACjB,EAAE,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;EAChB,MAAM,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;EAChB,MAAM,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;EAChB,MAAM,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;EACjB,EAAE,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;EAChB,MAAM,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;EAChB,MAAM,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC;EACjB,MAAM,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;EAClB,EAAE,IAAI,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC;EACjB,MAAM,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC;EACjB,MAAM,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC;EACjB,MAAM,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;AAClB;EACA,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;EACf,MAAM,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;EACf,MAAM,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;EACf,MAAM,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;EAChB,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;EACrD,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;EACrD,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;EACrD,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;EACrD,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;EACZ,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;EACZ,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;EACZ,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;EACZ,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;EACrD,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;EACrD,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;EACrD,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;EACrD,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;EACZ,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;EACZ,EAAE,EAAE,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;EACb,EAAE,EAAE,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;EACb,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;EACrD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"}